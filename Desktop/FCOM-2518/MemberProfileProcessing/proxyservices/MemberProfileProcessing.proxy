<?xml version="1.0" encoding="UTF-8"?>
<xml-fragment xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:env="http://www.bea.com/wli/config/env" xmlns:con="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/typesystem/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config" xmlns:http="http://www.bea.com/wli/sb/transports/http" xmlns:aler="http://www.bea.com/wli/monitoring/alert" xmlns:con4="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con5="http://www.bea.com/wli/sb/pipeline/config">
  <ser:coreEntry isProxy="true" isEnabled="true" isAutoPublish="false" isTracingEnabled="false">
    <ser:description>This service calls the Seibel webservice to insert a new member profile details, to update a member profile details and to update a member profile for promotion into Siebel loyalty system.</ser:description>
    <ser:binding type="SOAP" isSoap12="false" xsi:type="con3:SoapBindingType" xmlns:con3="http://www.bea.com/wli/sb/services/bindings/config">
      <con3:wsdl ref="PortalInterfaces/wsdl/profileProcessing"/>
      <con3:port>
        <con3:name>profileProcessingSOAP</con3:name>
        <con3:namespace>http://com.finnair/profileProcessing/</con3:namespace>
      </con3:port>
      <con3:selector type="SOAP body"/>
      <con3:WSI-compliant>false</con3:WSI-compliant>
    </ser:binding>
    <ser:monitoring isEnabled="true">
      <ser:aggregationInterval>2880</ser:aggregationInterval>
      <ser:pipelineMonitoringLevel>Pipeline</ser:pipelineMonitoringLevel>
    </ser:monitoring>
    <ser:reporting>true</ser:reporting>
    <ser:logging isEnabled="true">
      <ser:logLevel>debug</ser:logLevel>
    </ser:logging>
    <ser:sla-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:sla-alerting>
    <ser:pipeline-alerting isEnabled="true">
      <ser:alertLevel>normal</ser:alertLevel>
    </ser:pipeline-alerting>
    <ser:ws-policy>
      <ser:binding-mode>wsdl-policy-attachments</ser:binding-mode>
    </ser:ws-policy>
    <ser:throttling enabled="false">
      <ser:capacity>0</ser:capacity>
      <ser:maxQueueLength>0</ser:maxQueueLength>
      <ser:timeToLive>0</ser:timeToLive>
    </ser:throttling>
    <ser:messageTracing enabled="false">
      <ser:detailsLevel>Terse</ser:detailsLevel>
      <ser:maxSize>8192</ser:maxSize>
    </ser:messageTracing>
  </ser:coreEntry>
  <ser:endpointConfig>
    <tran:provider-id>http</tran:provider-id>
    <tran:inbound>true</tran:inbound>
    <tran:URI>
      <env:value>/MemberProfileProcessing/proxyservices/MemberProfileProcessing</env:value>
    </tran:URI>
    <tran:inbound-properties/>
    <tran:all-headers>false</tran:all-headers>
    <tran:user-header>enrollmentChannel</tran:user-header>
    <tran:provider-specific>
      <http:inbound-properties/>
    </tran:provider-specific>
  </ser:endpointConfig>
  <ser:router errorHandler="_onErrorHandler-8963622514322013752-7c9f2332.12a45f93d1a.-7fe5">
    <con3:pipeline name="LinkMemberToPromotion Gateway_request" type="request" xmlns:con3="http://www.bea.com/wli/sb/pipeline/config">
      <con3:stage name="Input Request Logging">
        <con:comment xmlns:con="http://www.bea.com/wli/sb/pipeline/config">This will log the input service request.</con:comment>
        <con:context xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
          <con4:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7eb5</con2:id>
            <con1:logLevel>info</con1:logLevel>
            <con1:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
            </con1:expr>
            <con1:message>Input Request Logging</con1:message>
          </con1:log>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-2873641054946293496-680bf8b5.12b28ddc85a.-7f66</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($body/prof:LinkMemberToPromotion//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/@ProfileType) != "1"</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:Error>
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-2873641054946293496-680bf8b5.12b28ddc85a.-7f65</con4:id>
                  <con2:errCode>90</con2:errCode>
                  <con2:message>Invalid Profile Type</con2:message>
                </con2:Error>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
        </con:actions>
      </con3:stage>
      <con3:stage name="Request Validation">
        <con3:comment>This will validate the incoming request</con3:comment>
        <con3:context>
          <con:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/"/>
          <con:varNsDecl prefix="com" namespace="http://com.finnair"/>
        </con3:context>
        <con3:actions>
          <con2:validate>
            <con:id>_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7e58</con:id>
            <con2:schema ref="PortalInterfaces/schema/AMA_UpdateRQ"/>
            <con2:schemaElement xmlns:com="http://com.finnair">com:AMA_UpdateRQ</con2:schemaElement>
            <con2:varName>body</con2:varName>
            <con2:location>
              <con:xpathText>.//com:AMA_UpdateRQ</con:xpathText>
            </con2:location>
            <con2:resultVarName/>
          </con2:validate>
        </con3:actions>
      </con3:stage>
      <con2:stage name="Portal To AYRESEnrollPromotion" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/pipeline/config">
        <con2:comment>This stage saves the unique id and transforms the incoming request.</con2:comment>
        <con2:context>
          <con4:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
        </con2:context>
        <con2:actions>
          <con4:assign varName="MemberNumber" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3525837289851415380-5b4e4341.12a4b35ae38.-7f35</con2:id>
            <con4:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body/prof:LinkMemberToPromotion//com:AMA_UpdateRQ/com:UniqueID/@ID</con:xqueryText>
            </con4:expr>
          </con4:assign>
          <con4:replace varName="body" contents-only="false" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3525837289851415380-5b4e4341.12a4b35ae38.-7f34</con2:id>
            <con4:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./*</con:xpathText>
            </con4:location>
            <con4:expr>
              <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                <con:resource ref="MemberProfileProcessing/transformations/XQ_Req_LinkMemberToPromotion"/>
                <con:param name="LinkMemberToPromotion">
                  <con:path>$body/*</con:path>
                </con:param>
              </con:xqueryTransform>
            </con4:expr>
          </con4:replace>
        </con2:actions>
      </con2:stage>
    </con3:pipeline>
    <con5:pipeline type="response" name="AMAOTAPAS12.2_response">
      <con5:stage name="SetVersionToResponse">
        <con5:context/>
        <con5:actions>
          <con2:replace varName="body" contents-only="true">
            <con:id>_ActionId-241346713932786510--3026e696.1411c0b110c.-7f64</con:id>
            <con2:location>
              <con:xpathText>//@Version[1]</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText>$Version</con:xqueryText>
            </con2:expr>
          </con2:replace>
        </con5:actions>
      </con5:stage>
    </con5:pipeline>
    <con3:pipeline name="InsertNewMember Gateway_response" type="response" xmlns:con3="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Response Transformation" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
        <con:comment>If the whole proces is a success then it will change the response body to Portal Specific Response.</con:comment>
        <con:context>
          <con4:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con2:ifThenElse>
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-2213640281224819431-30cc04e1.12a3b655063.-7ee3</con3:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($body/FPApplRS/Error/@value)="" or data($body/FPApplRS/Error/@value)="103"</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:replace varName="body" contents-only="false">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7fcd</con3:id>
                  <con2:location>
                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./*</con:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                      <con:resource ref="MemberProfileProcessing/transformations/XQ_Res_InsertNewMember"/>
                      <con:param name="MemberNumber">
                        <con:path>$MemberNumber</con:path>
                      </con:param>
                    </con:xqueryTransform>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
        </con:actions>
      </con:stage>
      <con3:stage name="Response Logging">
        <con3:comment>This will log the final response of the service operation</con3:comment>
        <con3:context>
          <con:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/"/>
          <con:varNsDecl prefix="com" namespace="http://com.finnair"/>
        </con3:context>
        <con3:actions>
          <con:log xmlns:con="http://www.bea.com/wli/sb/stages/logging/config">
            <con1:id xmlns:con1="http://www.bea.com/wli/sb/stages/config">_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7df9</con1:id>
            <con:logLevel>debug</con:logLevel>
            <con:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
            </con:expr>
            <con:message>Final Response Logging</con:message>
          </con:log>
        </con3:actions>
      </con3:stage>
      <con3:stage name="Monitoring">
        <con3:comment/>
        <con3:context>
          <con:varNsDecl prefix="com" namespace="http://com.finnair"/>
          <con:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/"/>
        </con3:context>
        <con3:actions>
          <con4:route xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
            <con:id>_ActionId-4449486212243904989-7fb4642e.136100f27e0.-7fe4</con:id>
            <con4:service ref="GoogleAnalytics/businessservice/Monitoring" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con4:operation>monitor</con4:operation>
            <con4:outboundTransform>
              <con2:replace varName="body" contents-only="true">
                <con:id>_ActionId-4449486212243904989-7fb4642e.136100f27e0.-7fe3</con:id>
                <con2:location>
                  <con:xpathText>.</con:xpathText>
                </con2:location>
                <con2:expr>
                  <con:xqueryTransform>
                    <con:resource ref="GoogleAnalytics/transformations/XQ_Req_Monitoring"/>
                    <con:param name="startTimestamp">
                      <con:path>$startTimestamp</con:path>
                    </con:param>
                    <con:param name="inbound">
                      <con:path>$inbound</con:path>
                    </con:param>
                  </con:xqueryTransform>
                </con2:expr>
              </con2:replace>
            </con4:outboundTransform>
          </con4:route>
        </con3:actions>
      </con3:stage>
    </con3:pipeline>
    <con5:pipeline type="response" name="Opt-out Gateway_response">
      <con5:stage name="Create response">
        <con5:context>
          <con:varNsDecl namespace="http://com.finnair/profileProcessing/" prefix="prof"/>
        </con5:context>
        <con5:actions>
          <con2:ifThenElse>
            <con:id>_ActionId-575701662507721275--12b291c0.14196ea8a25.-7d9d</con:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText>fn:not(fn:exists($errorCode))</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="errorMessage">
                  <con:id>_ActionId-575701662507721275--12b291c0.14196ea8a25.-7d9b</con:id>
                  <con2:expr>
                    <con:xqueryText>"ok"</con:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:assign varName="errorCode">
                  <con:id>_ActionId-575701662507721275--12b291c0.14196ea8a25.-7d7e</con:id>
                  <con2:expr>
                    <con:xqueryText>"0"</con:xqueryText>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:assign varName="optOutResponse">
            <con:id>_ActionId-575701662507721275--12b291c0.14196ea8a25.-7d44</con:id>
            <con2:expr>
              <con:xqueryTransform>
                <con:resource ref="MemberProfileProcessing/transformations/XQ_Res_OptOut"/>
                <con:param name="ErrorMessage">
                  <con:path>$errorMessage</con:path>
                </con:param>
                <con:param name="ErrorCode">
                  <con:path>$errorCode</con:path>
                </con:param>
              </con:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con:id>_ActionId-575701662507721275--12b291c0.14196ea8a25.-7d27</con:id>
            <con2:expr>
              <con:xqueryText>$optOutResponse</con:xqueryText>
            </con2:expr>
          </con2:replace>
        </con5:actions>
      </con5:stage>
      <con5:stage name="Monitoring">
        <con5:comment/>
        <con5:context>
          <con:varNsDecl prefix="com" namespace="http://com.finnair"/>
          <con:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/"/>
        </con5:context>
        <con5:actions>
          <con4:route xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
            <con:id>_ActionId-8747118900741786136--75660ad1.141926cd65e.-7e27</con:id>
            <con4:service ref="GoogleAnalytics/businessservice/Monitoring" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con4:operation>monitor</con4:operation>
            <con4:outboundTransform>
              <con2:replace varName="body" contents-only="true">
                <con:id>_ActionId-8747118900741786136--75660ad1.141926cd65e.-7e26</con:id>
                <con2:location>
                  <con:xpathText>.</con:xpathText>
                </con2:location>
                <con2:expr>
                  <con:xqueryTransform>
                    <con:resource ref="GoogleAnalytics/transformations/XQ_Req_Monitoring"/>
                    <con:param name="startTimestamp">
                      <con:path>$startTimestamp</con:path>
                    </con:param>
                    <con:param name="inbound">
                      <con:path>$inbound</con:path>
                    </con:param>
                  </con:xqueryTransform>
                </con2:expr>
              </con2:replace>
            </con4:outboundTransform>
          </con4:route>
        </con5:actions>
      </con5:stage>
    </con5:pipeline>
    <con3:pipeline name="UpdateProfile Gateway_request" type="request" xmlns:con3="http://www.bea.com/wli/sb/pipeline/config">
      <con3:stage name="Input Request Logging">
        <con:comment xmlns:con="http://www.bea.com/wli/sb/pipeline/config">This will log the input service request.</con:comment>
        <con:context xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
          <con4:userNsDecl prefix="ayr" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:userNsDecl prefix="asi" namespace="http://siebel.com/asi/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:userNsDecl prefix="ayr1" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20â€“%20Long%20Portal" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con5:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
          <con5:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
          <con2:assign varName="startTimestamp">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-4449486212243904989-7fb4642e.136100f27e0.-7fe2</con4:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">current-dateTime()</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7eb6</con2:id>
            <con1:logLevel>info</con1:logLevel>
            <con1:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
            </con1:expr>
            <con1:message>Input Request Logging</con1:message>
          </con1:log>
          <con2:assign varName="temp">
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-530140766071300154-77102151.137fe661869.-7fd7</con5:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-2873641054946293496-680bf8b5.12b28ddc85a.-7f68</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($body/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/@ProfileType) != "1"</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:Error>
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-2873641054946293496-680bf8b5.12b28ddc85a.-7f67</con4:id>
                  <con2:errCode>90</con2:errCode>
                  <con2:message>Invalid Profile Type</con2:message>
                </con2:Error>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
        </con:actions>
      </con3:stage>
      <con3:stage name="Request Validation">
        <con3:comment>This will validate the incoming request</con3:comment>
        <con3:context>
          <con:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/"/>
          <con:varNsDecl prefix="com" namespace="http://com.finnair"/>
        </con3:context>
        <con3:actions>
          <con2:validate>
            <con:id>_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7e65</con:id>
            <con2:schema ref="PortalInterfaces/schema/AMA_UpdateRQ"/>
            <con2:schemaElement xmlns:com="http://com.finnair">com:AMA_UpdateRQ</con2:schemaElement>
            <con2:varName>body</con2:varName>
            <con2:location>
              <con:xpathText>.//com:AMA_UpdateRQ</con:xpathText>
            </con2:location>
            <con2:resultVarName/>
          </con2:validate>
        </con3:actions>
      </con3:stage>
      <con3:stage name="Email Validation">
        <con3:comment/>
        <con3:context>
          <con:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/"/>
          <con:varNsDecl prefix="com" namespace="http://com.finnair"/>
        </con3:context>
        <con3:actions>
          <con2:assign varName="Email">
            <con:id>_ActionId-3502553873978082500--7a0d0b2c.131f4dc8dfa.-7f26</con:id>
            <con2:expr>
              <con:xqueryText>$body/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Email/text()</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con:id>_ActionId-3502553873978082500--7a0d0b2c.131f4dc8dfa.-7f25</con:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText>matches($Email,'.*.+@.{2,}\..{2,}')</con:xqueryText>
              </con2:condition>
              <con2:actions/>
            </con2:case>
            <con2:default>
              <con2:Error>
                <con:id>_ActionId-3502553873978082500--7a0d0b2c.131f4dc8dfa.-7f24</con:id>
                <con2:errCode>11</con2:errCode>
                <con2:message>Invalid email</con2:message>
              </con2:Error>
            </con2:default>
          </con2:ifThenElse>
        </con3:actions>
      </con3:stage>
      <con3:stage name="PinCode Validation">
        <con3:comment/>
        <con3:context>
          <con:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/"/>
          <con:varNsDecl prefix="com" namespace="http://com.finnair"/>
        </con3:context>
        <con3:actions>
          <con2:ifThenElse>
            <con:id>_ActionId-2327502807177402847--7e689091.12f8baca7df.-7fd5</con:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText>$body/prof:UpdateProfile/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:UserID/@PinNumber!=""</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con:assign varName="PinCode" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
                  <con1:id xmlns:con1="http://www.bea.com/wli/sb/stages/config">_ActionId-2327502807177402847--7e689091.12f8baca7df.-7fd4</con1:id>
                  <con:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">data($body/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:UserID/@PinNumber)</con5:xqueryText>
                  </con:expr>
                </con:assign>
                <con:assign varName="NormalizePinCode" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
                  <con1:id xmlns:con1="http://www.bea.com/wli/sb/stages/config">_ActionId-2327502807177402847--7e689091.12f8baca7df.-7fd3</con1:id>
                  <con:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data(fn:normalize-space($PinCode))</con:xqueryText>
                  </con:expr>
                </con:assign>
                <con:assign varName="CharacterCount" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
                  <con1:id xmlns:con1="http://www.bea.com/wli/sb/stages/config">_ActionId-2327502807177402847--7e689091.12f8baca7df.-7fd2</con1:id>
                  <con:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn:count(fn:tokenize($NormalizePinCode,fn:substring($NormalizePinCode,1,1))) - 1</con:xqueryText>
                  </con:expr>
                </con:assign>
                <con:assign varName="ValidationStatus" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
                  <con1:id xmlns:con1="http://www.bea.com/wli/sb/stages/config">_ActionId-2327502807177402847--7e689091.12f8baca7df.-7fd1</con1:id>
                  <con:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">if(fn:contains($PinCode,data($body/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:PersonName/com:GivenName)) or fn:contains($PinCode,data($body/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:PersonName/com:Surname)) or (fn:string-length($PinCode)&lt;=5) or fn:contains($PinCode," ") or (fn:string-length($NormalizePinCode)=$CharacterCount cast as xs:integer))then "No"
else "Yes"</con5:xqueryText>
                  </con:expr>
                </con:assign>
                <con:ifThenElse xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
                  <con1:id xmlns:con1="http://www.bea.com/wli/sb/stages/config">_ActionId-2327502807177402847--7e689091.12f8baca7df.-7fd0</con1:id>
                  <con:case>
                    <con:condition>
                      <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$ValidationStatus="Yes"</con:xqueryText>
                    </con:condition>
                    <con:actions/>
                  </con:case>
                  <con:default>
                    <con:Error>
                      <con1:id xmlns:con1="http://www.bea.com/wli/sb/stages/config">_ActionId-2327502807177402847--7e689091.12f8baca7df.-7fcf</con1:id>
                      <con:errCode>21</con:errCode>
                      <con:message>Create failed in PinCode validation</con:message>
                    </con:Error>
                  </con:default>
                </con:ifThenElse>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
        </con3:actions>
      </con3:stage>
      <con3:stage name="CreatePayload">
        <con3:comment>This will create Payload for the empty fields.</con3:comment>
        <con3:context>
          <con:userNsDecl prefix="ayr" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal"/>
          <con:userNsDecl prefix="asi" namespace="http://siebel.com/asi/"/>
          <con:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/"/>
          <con:varNsDecl prefix="com" namespace="http://com.finnair"/>
        </con3:context>
        <con3:actions>
          <con2:replace varName="body" contents-only="false">
            <con:id>_ActionId-97455854302856026-176db4de.12a8dd9cefc.-7fb5</con:id>
            <con2:location>
              <con:xpathText>./*</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryTransform>
                <con:resource ref="MemberProfileProcessing/transformations/createPayload"/>
                <con:param name="aMA_UpdateRQ1">
                  <con:path>$body//com:AMA_UpdateRQ</con:path>
                </con:param>
              </con:xqueryTransform>
            </con2:expr>
          </con2:replace>
          <con4:log xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7deb</con5:id>
            <con4:logLevel>info</con4:logLevel>
            <con4:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
            </con4:expr>
            <con4:message>Logging CreatePayload Request</con4:message>
          </con4:log>
        </con3:actions>
      </con3:stage>
      <con:stage name="Portal To AYLoyMemberPortal" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
        <con:comment>Transformation for AYLoyMemberPortal.QueryByExampleFullMember</con:comment>
        <con:context>
          <con4:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con2:replace varName="body" contents-only="true">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-1987456877628131841--3a2b7d0e.12bf667a2ff.-7eec</con4:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count(./prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address))
where
data(./prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/@DefaultInd)="1" or data(./prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/@DefaultInd)="true"
return

./prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/@DefaultInd</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">"1"</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="Request">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7fa2</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="MemberNumber">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f24</con4:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:UniqueID/@ID</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con1:replace varName="body" contents-only="false" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7fa0</con2:id>
            <con1:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./*</con:xpathText>
            </con1:location>
            <con1:expr>
              <con6:xqueryTransform xmlns:con6="http://www.bea.com/wli/sb/stages/config">
                <con6:resource ref="MemberProfileProcessing/transformations/XQ_Req_UpdateProfile"/>
                <con6:param name="memberNumber">
                  <con6:path>data($body/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:UniqueID/@ID)</con6:path>
                </con6:param>
              </con6:xqueryTransform>
            </con1:expr>
          </con1:replace>
        </con:actions>
      </con:stage>
      <con:stage name="Retrieving Full Details of MemberID" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
        <con:comment>Callout to AYLoyMemberPortal.QueryByExampleFullMember</con:comment>
        <con:context>
          <con4:userNsDecl prefix="ay" namespace="http://www.siebel.com/xml/AY%20LOY%20Member%20Int" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="ayr" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="asi" namespace="http://siebel.com/asi/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con1:variable name="Siebel" path="$Siebel">
            <con1:service operation="QuerybyExampleFullMember">
              <con1:business ref="MemberProfileProcessing/businessservices/AYLoyMemberPortal"/>
            </con1:service>
          </con1:variable>
        </con:context>
        <con:actions>
          <con2:wsCallout>
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f9f</con3:id>
            <con2:service ref="MemberProfileProcessing/businessservices/AYLoyMemberPortal" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con2:operation>QuerybyExampleFullMember</con2:operation>
            <con2:request>
              <con2:body wrapped="true">$body</con2:body>
            </con2:request>
            <con2:response>
              <con2:body wrapped="true">body</con2:body>
            </con2:response>
            <con2:requestTransform>
              <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7dea</con5:id>
                <con4:logLevel>info</con4:logLevel>
                <con4:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                </con4:expr>
                <con4:message>Logging QuerybyExampleFullMember Request</con4:message>
              </con4:log>
              <con2:delete varName="header">
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-2041694110763451302--16168512.131fb1161ef.-7f33</con4:id>
                <con2:location>
                  <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./*</con:xpathText>
                </con2:location>
              </con2:delete>
            </con2:requestTransform>
            <con2:responseTransform>
              <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7de9</con5:id>
                <con4:logLevel>debug</con4:logLevel>
                <con4:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                </con4:expr>
                <con4:message>Logging QuerybyExampleFullMember Request To QuerybyExampleFullMember Response.</con4:message>
              </con4:log>
              <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-6776922166680324599-476c80c1.12a54eb81c8.-7f75</con2:id>
                <con1:case>
                  <con1:condition>
                    <con:xqueryConditionExpr xmlns:con="http://www.bea.com/wli/sb/stages/config">
                      <con:unaryExpr>
                        <con:path>$body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember</con:path>
                      </con:unaryExpr>
                    </con:xqueryConditionExpr>
                  </con1:condition>
                  <con1:actions/>
                </con1:case>
                <con1:case>
                  <con1:condition>
                    <con2:xqueryConditionExpr xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                      <con2:boolExpr operator="and">
                        <con2:unaryExpr negative="true">
                          <con2:path>$body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember</con2:path>
                        </con2:unaryExpr>
                        <con2:unaryExpr>
                          <con2:path>fn:local-name($body/*[1])='Fault'</con2:path>
                        </con2:unaryExpr>
                      </con2:boolExpr>
                    </con2:xqueryConditionExpr>
                  </con1:condition>
                  <con1:actions>
                    <con1:Error>
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-6776922166680324599-476c80c1.12a54eb81c8.-7f74</con2:id>
                      <con1:errCode>60</con1:errCode>
                      <con1:message>Invalid Member ID</con1:message>
                    </con1:Error>
                  </con1:actions>
                </con1:case>
                <con1:case>
                  <con1:condition>
                    <con2:xqueryConditionExpr xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                      <con2:boolExpr operator="and">
                        <con2:unaryExpr negative="true">
                          <con2:path>$body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember</con2:path>
                        </con2:unaryExpr>
                        <con2:unaryExpr>
                          <con2:path>fn:local-name($body/*[1])!='Fault'</con2:path>
                        </con2:unaryExpr>
                      </con2:boolExpr>
                    </con2:xqueryConditionExpr>
                  </con1:condition>
                  <con1:actions>
                    <con1:Error>
                      <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-6776922166680324599-476c80c1.12a54eb81c8.-7f73</con2:id>
                      <con1:errCode>61</con1:errCode>
                      <con1:message>No Profile</con1:message>
                    </con1:Error>
                  </con1:actions>
                </con1:case>
              </con1:ifThenElse>
            </con2:responseTransform>
          </con2:wsCallout>
        </con:actions>
      </con:stage>
      <con:stage name="Portal To Synchronise I" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
        <con:comment>Miscellaneous Transformation</con:comment>
        <con:context>
          <con3:varNsDecl prefix="ayr" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con3:varNsDecl prefix="asi" namespace="http://siebel.com/asi/" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="ayr1" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20â€“%20Long%20Portal" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con5:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
          <con5:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
          <con1:variable name="Siebel" path="$Siebel">
            <con1:service operation="QuerybyExampleFullMember">
              <con1:business ref="MemberProfileProcessing/businessservices/AYLoyMemberPortal"/>
            </con1:service>
          </con1:variable>
          <con1:variable name="a" path="$a">
            <con1:service>
              <con1:business ref="MemberProfileProcessing/businessservices/AYLoyMemberPortal"/>
            </con1:service>
          </con1:variable>
        </con:context>
        <con:actions>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f9d</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:MemberNumber</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$MemberNumber</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="MF">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f9c</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">if (data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/@Gender) = "Male") then ("M")
else if (data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/@Gender) = "Female") then ("F")
else $body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:MF/text()</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f9b</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:MF</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$MF</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-4449486212243904989-7fb4642e.136100f27e0.-7e04</con4:id>
            <con2:case>
              <con2:condition>
                <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">string-length($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:MM/text()) = 0</con6:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="MM">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-4449486212243904989-7fb4642e.136100f27e0.-7e03</con4:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">if (data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/@Gender) = "Male") then ("Mr.")
else if (data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/@Gender) = "Female") then ("Ms.")
else $body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:MM/text()</con:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:replace varName="body" contents-only="true">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-4449486212243904989-7fb4642e.136100f27e0.-7e02</con4:id>
                  <con2:location>
                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:MM</con:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$MM</con:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:assign varName="PrimaryDateofBirth">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f9a</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">if(data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/@BirthDate)!="") then 
fn:concat(
fn:substring(data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/@BirthDate),6,2),
"/",
fn:substring(data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/@BirthDate),9,2),
"/",
fn:substring(data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/@BirthDate),1,4),
" ",
fn:substring(data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/@BirthDate),12)
)

else

data($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:PrimaryDateofBirth)</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f99</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:BirthDate</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PrimaryDateofBirth</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="PrimaryContactFirstName">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f98</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">if(data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:PersonName/com:GivenName)!="") then
data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:PersonName/com:GivenName)

else

data($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:PrimaryContactFirstName)</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f97</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:PrimaryContactFirstName</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PrimaryContactFirstName</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7238953409985074563-2a81867e.12d73402cbf.-7eac</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:PersonName/com:MiddleName) !=""</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="ContactMiddleName">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7238953409985074563-2a81867e.12d73402cbf.-7eab</con4:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:PersonName/com:MiddleName)</con:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:replace varName="body" contents-only="true">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7238953409985074563-2a81867e.12d73402cbf.-7eaa</con4:id>
                  <con2:location>
                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:MiddleName</con:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$ContactMiddleName</con:xqueryText>
                  </con2:expr>
                </con2:replace>
                <con2:replace varName="body" contents-only="true">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-8208163558734183223--23c5d042.13e401d18ee.-7f74</con5:id>
                  <con2:location>
                    <con5:xpathText xmlns:con5="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:PrimaryContactMiddleName</con5:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$ContactMiddleName</con5:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:replace varName="body" contents-only="true">
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7238953409985074563-2a81867e.12d73402cbf.-7ea9</con4:id>
                <con2:location>
                  <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:MiddleName</con:xpathText>
                </con2:location>
                <con2:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">""</con:xqueryText>
                </con2:expr>
              </con2:replace>
            </con2:default>
          </con2:ifThenElse>
          <con2:assign varName="PrimaryContactLastName">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f94</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">if(data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:PersonName/com:Surname)!="") then
data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:PersonName/com:Surname)
else
data($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:PrimaryContactLastName)</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f93</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:PrimaryContactLastName</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PrimaryContactLastName</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f26</con4:id>
            <con2:case>
              <con2:condition>
                <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                  <con4:boolExpr operator="and">
                    <con4:compExpr operator="=">
                      <con4:leftPath>data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Telephone/@PhoneLocationType)</con4:leftPath>
                      <con4:rightPath>"6"</con4:rightPath>
                    </con4:compExpr>
                    <con4:compExpr operator="=">
                      <con4:leftPath>data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Telephone/@PhoneTechType)</con4:leftPath>
                      <con4:rightPath>"5"</con4:rightPath>
                    </con4:compExpr>
                  </con4:boolExpr>
                </con4:xqueryConditionExpr>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="AlternateSMS">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f25</con3:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config"><![CDATA[<ayr:ListOfLoyCommunicationSms>
                           <ayr:LoyCommunicationSms>
                              <ayr:Id>0</ayr:Id>
                              <ayr:AlternateSMS>{data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Telephone[1]/@PhoneNumber)}</ayr:AlternateSMS>
                              <ayr:AlternateSMSMediumType>SMS</ayr:AlternateSMSMediumType>
                              <ayr:AlternateSMSName>Home</ayr:AlternateSMSName>
                              <ayr:AlternateSMSPersonId>{$body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:Id/text()}</ayr:AlternateSMSPersonId>
                           </ayr:LoyCommunicationSms>
                        </ayr:ListOfLoyCommunicationSms>]]></con:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:replace varName="body" contents-only="false">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f24</con4:id>
                  <con2:location>
                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfLoyCommunicationSms</con:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$AlternateSMS</con:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5886473718478157716-1f1f0af9.12b4238040e.-7fb7</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Email/@EmailType) = "1"</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="AlternateEmailAddress">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5886473718478157716-1f1f0af9.12b4238040e.-7fb6</con3:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Email/text()</con:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:assign varName="CommunicationAddress">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5886473718478157716-1f1f0af9.12b4238040e.-7fb4</con4:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config"><![CDATA[<ayr:ListOfCommunicationAddress>
                           <ayr:CommunicationAddress>
                              <ayr:Id>0</ayr:Id>
                              <ayr:AlternateEmailAddress>{$AlternateEmailAddress}</ayr:AlternateEmailAddress>
                              <ayr:CommunicationAddressMediumType>Email</ayr:CommunicationAddressMediumType>
                              <ayr:CommunicationAddressName>Home</ayr:CommunicationAddressName>
                              <ayr:CommunicationAddressPersonId>{data($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:PrimaryContactId)}</ayr:CommunicationAddressPersonId>
                           </ayr:CommunicationAddress>
                        </ayr:ListOfCommunicationAddress>]]></con:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:replace varName="body" contents-only="false">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5886473718478157716-1f1f0af9.12b4238040e.-7fb5</con3:id>
                  <con2:location>
                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfCommunicationAddress</con:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$CommunicationAddress</con:xqueryText>
                  </con2:expr>
                </con2:replace>
                <con2:replace varName="body" contents-only="true">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-8208163558734183223--23c5d042.13e401d18ee.-7fae</con5:id>
                  <con2:location>
                    <con5:xpathText xmlns:con5="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:EmailAddress</con5:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$AlternateEmailAddress</con5:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:ifThenElse>
            <con5:comment xmlns:con5="http://www.bea.com/wli/sb/stages/config">check  for pending member</con5:comment>
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-8208163558734183223--23c5d042.13e401d18ee.-7d8a</con5:id>
            <con2:case>
              <con2:condition>
                <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">data($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:Status) = "Pending"</con5:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:replace varName="body" contents-only="true">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-8208163558734183223--23c5d042.13e401d18ee.-7d88</con5:id>
                  <con2:location>
                    <con5:xpathText xmlns:con5="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:LastName</con5:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$PrimaryContactLastName</con5:xqueryText>
                  </con2:expr>
                </con2:replace>
                <con2:replace varName="body" contents-only="true">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-8208163558734183223--23c5d042.13e401d18ee.-7d86</con5:id>
                  <con2:location>
                    <con5:xpathText xmlns:con5="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:FirstName</con5:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$PrimaryContactFirstName</con5:xqueryText>
                  </con2:expr>
                </con2:replace>
                <con2:assign varName="ReturnBasicRequest">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-8208163558734183223--23c5d042.13e401d18ee.-7a80</con5:id>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$body</con5:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:replace varName="ReturnBasicRequest">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-8810514092890854840-3fa5ec5e.13e46d47fd3.-7fae</con5:id>
                  <con2:location>
                    <con5:xpathText xmlns:con5="http://www.bea.com/wli/sb/stages/config">./*</con5:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con5:xqueryTransform xmlns:con5="http://www.bea.com/wli/sb/stages/config">
                      <con5:resource ref="MemberProfileProcessing/transformations/XQ_Req_ReturnBasicMemData"/>
                      <con5:param name="UpdateMember">
                        <con5:path>$Request/*</con5:path>
                      </con5:param>
                    </con5:xqueryTransform>
                  </con2:expr>
                </con2:replace>
                <con2:wsCallout xmlns:con="http://www.bea.com/wli/sb/stages/config">
                  <con:id>_ActionId-8208163558734183223--23c5d042.13e401d18ee.-7c06</con:id>
                  <con2:service ref="MemberProfileProcessing/businessservices/AYRESNewMember" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con2:operation>ReturnBasicMembData</con2:operation>
                  <con2:request>
                    <con2:body wrapped="true">$ReturnBasicRequest</con2:body>
                  </con2:request>
                  <con2:response>
                    <con2:body wrapped="true">ReturnBasicRequest</con2:body>
                  </con2:response>
                  <con2:requestTransform>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                      <con:id>_ActionId-8208163558734183223--23c5d042.13e401d18ee.-7c0b</con:id>
                      <con4:logLevel>info</con4:logLevel>
                      <con4:expr>
                        <con:xqueryText>$ReturnBasicRequest</con:xqueryText>
                      </con4:expr>
                      <con4:message>Logging Portal To ReturnBasicMembData Request.</con4:message>
                    </con4:log>
                    <con2:delete varName="header">
                      <con:id>_ActionId-8208163558734183223--23c5d042.13e401d18ee.-7c0a</con:id>
                      <con2:location>
                        <con:xpathText>./*</con:xpathText>
                      </con2:location>
                    </con2:delete>
                  </con2:requestTransform>
                  <con2:responseTransform>
                    <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                      <con:id>_ActionId-8208163558734183223--23c5d042.13e401d18ee.-7c09</con:id>
                      <con4:logLevel>debug</con4:logLevel>
                      <con4:expr>
                        <con:xqueryText>$ReturnBasicRequest</con:xqueryText>
                      </con4:expr>
                      <con4:message>Logging ReturnBasicMembData To ReturnBasicMembData Response.</con4:message>
                    </con4:log>
                    <con2:ifThenElse>
                      <con:id>_ActionId-8208163558734183223--23c5d042.13e401d18ee.-7c08</con:id>
                      <con2:case>
                        <con2:condition>
                          <con:xqueryText>fn:local-name($body/*[1])='Fault'</con:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con2:Error>
                            <con:id>_ActionId-8208163558734183223--23c5d042.13e401d18ee.-7c07</con:id>
                            <con2:errCode>50</con2:errCode>
                            <con2:message>Error While Creating New Member</con2:message>
                          </con2:Error>
                        </con2:actions>
                      </con2:case>
                    </con2:ifThenElse>
                  </con2:responseTransform>
                </con2:wsCallout>
                <con2:replace varName="body" contents-only="true">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-8208163558734183223--23c5d042.13e401d18ee.-7b09</con5:id>
                  <con2:location>
                    <con5:xpathText xmlns:con5="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:PNRName</con5:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$ReturnBasicRequest/asi:ReturnBasicMembDataResponse/PNRName/text()</con5:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:assign varName="AYeMailReturnedFlg">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3122313469915818379-1500b768.12db6a52fc0.-7ef2</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">if (data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Email) = "") then ("Y")
elseif(data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Email)!=data($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:AYeMailReturnedFlg)) then ("N")
else data($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:AYeMailReturnedFlg)</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3122313469915818379-1500b768.12db6a52fc0.-7ef1</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:AYeMailReturnedFlg</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$AYeMailReturnedFlg</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="PersonalCountryHomeCode">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-2385067979177050521--161dee9c.12ec2173acb.-7f2f</con4:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to 2)
where $Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/@UseType="13"

return

data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/com:CountryName/@Code)</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="dvmTable">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-2385067979177050521--161dee9c.12ec2173acb.-7f22</con3:id>
            <con2:expr>
              <con6:xqueryTransform xmlns:con6="http://www.bea.com/wli/sb/stages/config">
                <con6:resource ref="Common/transformations/CountryCodesToCRM_DVM"/>
              </con6:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-2385067979177050521--161dee9c.12ec2173acb.-7f2e</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($PersonalCountryHomeCode)!=""</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="PersonalCountryHome">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-2385067979177050521--161dee9c.12ec2173acb.-7f2d</con4:id>
                  <con2:expr>
                    <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                      <con:resource ref="MemberProfileProcessing/transformations/InsertDVM"/>
                      <con:param name="sourceValue">
                        <con:path>$PersonalCountryHomeCode</con:path>
                      </con:param>
                      <con:param name="sourceColumnName">
                        <con:path>"CountryCode"</con:path>
                      </con:param>
                      <con:param name="targetColumnName">
                        <con:path>"CountryName"</con:path>
                      </con:param>
                      <con:param name="defaultValue">
                        <con:path>""</con:path>
                      </con:param>
                      <con:param name="dvmTable">
                        <con:path>$dvmTable</con:path>
                      </con:param>
                    </con:xqueryTransform>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:assign varName="PersonalCountryJobCode">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-2385067979177050521--161dee9c.12ec2173acb.-7f2c</con4:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to 2)
where $Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/@UseType="14"

return

data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/com:CountryName/@Code)</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-2385067979177050521--161dee9c.12ec2173acb.-7f2b</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($PersonalCountryJobCode)!=""</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="PersonalCountryJob">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-2385067979177050521--161dee9c.12ec2173acb.-7f2a</con4:id>
                  <con2:expr>
                    <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                      <con:resource ref="MemberProfileProcessing/transformations/InsertDVM"/>
                      <con:param name="sourceValue">
                        <con:path>$PersonalCountryJobCode</con:path>
                      </con:param>
                      <con:param name="sourceColumnName">
                        <con:path>"CountryCode"</con:path>
                      </con:param>
                      <con:param name="targetColumnName">
                        <con:path>"CountryName"</con:path>
                      </con:param>
                      <con:param name="defaultValue">
                        <con:path>""</con:path>
                      </con:param>
                      <con:param name="dvmTable">
                        <con:path>$dvmTable</con:path>
                      </con:param>
                    </con:xqueryTransform>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:assign varName="EmptyIndicator">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f8d</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address))
let $path1:=$Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]
where $Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/@DefaultInd="1"
return
if(data($path1/com:CityName)="" and data($path1/com:PostalCode)="" and data($path1/com:StateProv)="" and data($path1/com:CountryName/@Code)="" and data($path1/com:CompanyName)="" and data($path1/com:AddressLine[1])="" and data($path1/com:AddressLine[2])="" and data($path1/com:AddressLine[3])="" and data($path1/com:County)="" and data($path1/@Description)="") then ("empty")
else "nonempty"</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="HomeIndicatora">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6625452680328267833--27ab29d7.139f7783410.-7fea</con4:id>
            <con2:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address))
let $path1:=$Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]
where $Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/@UseType="13"
return
for $var1 in ( 1 to fn:count($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress))
let $path:=$body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var1]

where $body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var1]/ayr:AddressType="Home"
return
if(data($path/ayr:PersonalCity)!=data($path1/com:CityName) or data($path/ayr:PersonalPostalCode)!=data($path1/com:PostalCode) or data($path/ayr:PersonalProvince)!=data($path1/com:StateProv) or data($path/ayr:PersonalCountry)!=data($PersonalCountryHome) or data($path/ayr:PersonalStreetAddress)!=data($path1/com:AddressLine[1])
		or (
			exists($path1/@Description) and data($path/ayr:PersonalStreetAddress2)!=data($path1/@Description)
			or
			exists($path1/com:AddressLine[2]) and data($path/ayr:PersonalStreetAddress2)!=data($path1/com:AddressLine[2])
		)
	) then ($var1)
 else (0)</con6:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="JobIndicatora">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6625452680328267833--27ab29d7.139f7783410.-7fe9</con4:id>
            <con2:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address))
let $path1:=$Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]
where $Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/@UseType="14"
return
for $var1 in ( 1 to fn:count($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress))
let $path:=$body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var1]
where $body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var1]/ayr:AddressType="Job"
return
if(data($path/ayr:PersonalCity)!=data($path1/com:CityName) or data($path/ayr:PersonalPostalCode)!=data($path1/com:PostalCode) or data($path/ayr:PersonalProvince)!=data($path1/com:StateProv) or data($path/ayr:PersonalCountry)!=data($PersonalCountryJob) or data($path/ayr:PersonalStreetAddress)!=data($path1/com:AddressLine)
		or (
			exists($path1/@Description) and data($path/ayr:PersonalStreetAddress2)!=data($path1/@Description)
			or
			exists($path1/com:AddressLine[2]) and data($path/ayr:PersonalStreetAddress2)!=data($path1/com:AddressLine[2])
		) or (
			exists($path1/com:AddressLine[3]) and data($path/ayr:PersonalStreetAddress3)!=data($path1/com:AddressLine[3])
		)
) then ($var1)
else (0)</con6:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6625452680328267833--27ab29d7.139f7783410.-7fe8</con5:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$EmptyIndicator = "empty"</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="AYMailReturned">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6625452680328267833--27ab29d7.139f7783410.-7fe7</con5:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">"Y"</con:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:replace varName="body" contents-only="true">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6625452680328267833--27ab29d7.139f7783410.-7fe6</con5:id>
                  <con2:location>
                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress/ayr:AYMailReturned</con:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$AYMailReturned</con:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:foreach>
                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-9201802019042183556-507f7cec.13b900147f1.-7d51</con5:id>
                <con2:variable>body</con2:variable>
                <con2:expression>
                  <con5:xpathText xmlns:con5="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress</con5:xpathText>
                </con2:expression>
                <con2:value-variable>PersonalAddress</con2:value-variable>
                <con2:index-variable>i</con2:index-variable>
                <con2:actions>
                  <con2:ifThenElse>
                    <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-9201802019042183556-507f7cec.13b900147f1.-7d40</con5:id>
                    <con2:case>
                      <con2:condition>
                        <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$i = xs:int($HomeIndicatora)</con5:xqueryText>
                      </con2:condition>
                      <con2:actions>
                        <con2:replace varName="PersonalAddress" contents-only="true">
                          <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-9201802019042183556-507f7cec.13b900147f1.-7d29</con5:id>
                          <con2:location>
                            <con5:xpathText xmlns:con5="http://www.bea.com/wli/sb/stages/config">./AYMailReturned</con5:xpathText>
                          </con2:location>
                          <con2:expr>
                            <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">"N"</con5:xqueryText>
                          </con2:expr>
                        </con2:replace>
                      </con2:actions>
                    </con2:case>
                    <con2:case>
                      <con2:condition>
                        <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$i = xs:int($JobIndicatora)</con5:xqueryText>
                      </con2:condition>
                      <con2:actions>
                        <con2:replace varName="PersonalAddress" contents-only="true">
                          <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-9201802019042183556-507f7cec.13b900147f1.-7cf3</con5:id>
                          <con2:location>
                            <con5:xpathText xmlns:con5="http://www.bea.com/wli/sb/stages/config">./AYMailReturned</con5:xpathText>
                          </con2:location>
                          <con2:expr>
                            <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">"N"</con5:xqueryText>
                          </con2:expr>
                        </con2:replace>
                      </con2:actions>
                    </con2:case>
                  </con2:ifThenElse>
                </con2:actions>
              </con2:foreach>
            </con2:default>
          </con2:ifThenElse>
          <con2:assign varName="AddressTypeHome">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f8b</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address))

where $Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/@UseType = "13" 

return "Home"</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="AddressTypeJob">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f8a</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address))

where $Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/@UseType = "14" 

return "Job"</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="Req_Job">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-1987456877628131841--3a2b7d0e.12bf667a2ff.-7ef0</con4:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[@UseType="14"]</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="Req_Home">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-1987456877628131841--3a2b7d0e.12bf667a2ff.-7eef</con4:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[@UseType="13"]</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7fc8</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($AddressTypeHome) != ""</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:ifThenElse>
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3154782520543783281--5ac19df8.12b7ffb693c.-7fda</con4:id>
                  <con2:case>
                    <con2:condition>
                      <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[*]/ayr:AddressType = "Home"</con:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:replace varName="body" contents-only="true">
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3154782520543783281--5ac19df8.12b7ffb693c.-7fd9</con3:id>
                        <con2:location>
                          <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress))

where ./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AddressType = "Home"

return

./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AddressType</con:xpathText>
                        </con2:location>
                        <con2:expr>
                          <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$AddressTypeHome</con:xqueryText>
                        </con2:expr>
                      </con2:replace>
                    </con2:actions>
                  </con2:case>
                  <con2:case>
                    <con2:condition>
                      <con:xqueryConditionExpr xmlns:con="http://www.bea.com/wli/sb/stages/config">
                        <con:boolExpr operator="or">
                          <con:compExpr operator="!=">
                            <con:leftPath>$body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[*]/ayr:AddressType</con:leftPath>
                            <con:rightPath>"Home"</con:rightPath>
                          </con:compExpr>
                          <con:unaryExpr>
                            <con:path>$body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress</con:path>
                          </con:unaryExpr>
                        </con:boolExpr>
                      </con:xqueryConditionExpr>
                    </con2:condition>
                    <con2:actions>
                      <con2:assign varName="PersonalHomeAddress">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3154782520543783281--5ac19df8.12b7ffb693c.-7fd8</con4:id>
                        <con2:expr>
                          <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config"><![CDATA[<ayr:PersonalAddress>
                              <ayr:PersonalAddressId>0</ayr:PersonalAddressId>
                              <ayr:AYCompanyName/>
                              <ayr:AddressId>0</ayr:AddressId>
                              <ayr:PersonalAddressName xsi:nil="true"/>
                              <ayr:AddressType>Home</ayr:AddressType>
                              <ayr:PersonalCity/>
                              <ayr:PersonalCountry/>
                              <ayr:IntegrationId/>
                              <ayr:PersonalPostalCode/>
                              <ayr:PersonalProvince/>
                              <ayr:PersonalAddressStartDate/>
                              <ayr:PersonalState/>
                              <ayr:PersonalStreetAddress/>
                              <ayr:PersonalStreetAddress2/>
                              <ayr:PersonalStreetAddress3/>
                               <ayr:AYMailReturned/>
                           </ayr:PersonalAddress>]]></con:xqueryText>
                        </con2:expr>
                      </con2:assign>
                      <con2:ifThenElse>
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3154782520543783281--5ac19df8.12b7ffb693c.-7fd7</con4:id>
                        <con2:case>
                          <con2:condition>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Req_Home[@UseType="13"] and $Req_Home[@DefaultInd="1"]</con:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:insert varName="body">
                              <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3154782520543783281--5ac19df8.12b7ffb693c.-7fd6</con4:id>
                              <con2:location>
                                <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress</con:xpathText>
                              </con2:location>
                              <con2:where>first-child</con2:where>
                              <con2:expr>
                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PersonalHomeAddress</con:xqueryText>
                              </con2:expr>
                            </con2:insert>
                          </con2:actions>
                        </con2:case>
                        <con2:case>
                          <con2:condition>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Req_Home[@UseType="13"] and $Req_Home[@DefaultInd !="1"]</con:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:insert varName="body">
                              <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3154782520543783281--5ac19df8.12b7ffb693c.-7fd5</con4:id>
                              <con2:location>
                                <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress</con:xpathText>
                              </con2:location>
                              <con2:where>last-child</con2:where>
                              <con2:expr>
                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PersonalHomeAddress</con:xqueryText>
                              </con2:expr>
                            </con2:insert>
                          </con2:actions>
                        </con2:case>
                      </con2:ifThenElse>
                    </con2:actions>
                  </con2:case>
                </con2:ifThenElse>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7fc6</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($AddressTypeJob) != ""</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:ifThenElse>
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3154782520543783281--5ac19df8.12b7ffb693c.-7fe7</con4:id>
                  <con2:case>
                    <con2:condition>
                      <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[*]/ayr:AddressType = "Job"</con:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:replace varName="body" contents-only="true">
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3154782520543783281--5ac19df8.12b7ffb693c.-7fe5</con3:id>
                        <con2:location>
                          <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress))

where ./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AddressType = "Job"

return

./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AddressType</con:xpathText>
                        </con2:location>
                        <con2:expr>
                          <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$AddressTypeJob</con:xqueryText>
                        </con2:expr>
                      </con2:replace>
                    </con2:actions>
                  </con2:case>
                  <con2:case>
                    <con2:condition>
                      <con:xqueryConditionExpr xmlns:con="http://www.bea.com/wli/sb/stages/config">
                        <con:boolExpr operator="or">
                          <con:compExpr operator="!=">
                            <con:leftPath>$body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[*]/ayr:AddressType</con:leftPath>
                            <con:rightPath>"Job"</con:rightPath>
                          </con:compExpr>
                          <con:unaryExpr>
                            <con:path>$body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress</con:path>
                          </con:unaryExpr>
                        </con:boolExpr>
                      </con:xqueryConditionExpr>
                    </con2:condition>
                    <con2:actions>
                      <con2:assign varName="PersonalJobAddress">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3154782520543783281--5ac19df8.12b7ffb693c.-7fe4</con4:id>
                        <con2:expr>
                          <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config"><![CDATA[<ayr:PersonalAddress>
                              <ayr:PersonalAddressId>0</ayr:PersonalAddressId>
                              <ayr:AYCompanyName/>
                              <ayr:AddressId>0</ayr:AddressId>
                              <ayr:PersonalAddressName xsi:nil="true"/>
                              <ayr:AddressType>Job</ayr:AddressType>
                              <ayr:PersonalCity/>
                              <ayr:PersonalCountry/>
                              <ayr:IntegrationId/>
                              <ayr:PersonalPostalCode/>
                              <ayr:PersonalProvince/>
                              <ayr:PersonalAddressStartDate/>
                              <ayr:PersonalState/>
                              <ayr:PersonalStreetAddress/>
                              <ayr:PersonalStreetAddress2/>
                              <ayr:PersonalStreetAddress3/>
                                <ayr:AYMailReturned/>
                           </ayr:PersonalAddress>]]></con:xqueryText>
                        </con2:expr>
                      </con2:assign>
                      <con2:ifThenElse>
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3154782520543783281--5ac19df8.12b7ffb693c.-7fe2</con4:id>
                        <con2:case>
                          <con2:condition>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Req_Job[@UseType="14"] and $Req_Job[@DefaultInd="1"]</con:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:insert varName="body">
                              <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3154782520543783281--5ac19df8.12b7ffb693c.-7fe1</con4:id>
                              <con2:location>
                                <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress</con:xpathText>
                              </con2:location>
                              <con2:where>first-child</con2:where>
                              <con2:expr>
                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PersonalJobAddress</con:xqueryText>
                              </con2:expr>
                            </con2:insert>
                          </con2:actions>
                        </con2:case>
                        <con2:case>
                          <con2:condition>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Req_Job[@UseType="14"] and $Req_Job[@DefaultInd !="1"]</con:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con2:insert varName="body">
                              <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3154782520543783281--5ac19df8.12b7ffb693c.-7fdf</con4:id>
                              <con2:location>
                                <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress</con:xpathText>
                              </con2:location>
                              <con2:where>last-child</con2:where>
                              <con2:expr>
                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PersonalJobAddress</con:xqueryText>
                              </con2:expr>
                            </con2:insert>
                          </con2:actions>
                        </con2:case>
                      </con2:ifThenElse>
                    </con2:actions>
                  </con2:case>
                </con2:ifThenElse>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="Portal To Synchronise II" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
        <con:comment>AddressLine Transformation</con:comment>
        <con:context>
          <con4:userNsDecl prefix="ayr1" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20â€“%20Long%20Portal" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con3:varNsDecl prefix="ayr" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con3:varNsDecl prefix="asi" namespace="http://siebel.com/asi/" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con2:assign varName="PersonalCityHome">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f84</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to 2)
where $Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/@UseType="13"

return

data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/com:CityName)</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="PersonalCityJob">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f4d</con4:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to 2)
where $Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/@UseType="14"

return

data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/com:CityName)</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="PersonalCountryHomeCode">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f50</con4:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to 2)
where $Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/@UseType="13"

return

data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/com:CountryName/@Code)</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f45</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($PersonalCountryHomeCode)!=""</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="PersonalCountryHome">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f44</con4:id>
                  <con2:expr>
                    <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                      <con:resource ref="MemberProfileProcessing/transformations/InsertDVM"/>
                      <con:param name="sourceValue">
                        <con:path>$PersonalCountryHomeCode</con:path>
                      </con:param>
                      <con:param name="sourceColumnName">
                        <con:path>"CountryCode"</con:path>
                      </con:param>
                      <con:param name="targetColumnName">
                        <con:path>"CountryName"</con:path>
                      </con:param>
                      <con:param name="defaultValue">
                        <con:path>""</con:path>
                      </con:param>
                      <con:param name="dvmTable">
                        <con:path>$dvmTable</con:path>
                      </con:param>
                    </con:xqueryTransform>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f4e</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($PersonalCountryHome)!=""</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:replace varName="body" contents-only="true">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f4b</con4:id>
                  <con2:location>
                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress))

where ./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AddressType = "Home"

return

./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:PersonalCountry</con:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PersonalCountryHome</con:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:assign varName="PersonalCountryJobCode">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f4f</con4:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to 2)
where $Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/@UseType="14"

return

data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/com:CountryName/@Code)</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f42</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($PersonalCountryJobCode)!=""</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="PersonalCountryJob">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f41</con4:id>
                  <con2:expr>
                    <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                      <con:resource ref="MemberProfileProcessing/transformations/InsertDVM"/>
                      <con:param name="sourceValue">
                        <con:path>$PersonalCountryJobCode</con:path>
                      </con:param>
                      <con:param name="sourceColumnName">
                        <con:path>"CountryCode"</con:path>
                      </con:param>
                      <con:param name="targetColumnName">
                        <con:path>"CountryName"</con:path>
                      </con:param>
                      <con:param name="defaultValue">
                        <con:path>""</con:path>
                      </con:param>
                      <con:param name="dvmTable">
                        <con:path>$dvmTable</con:path>
                      </con:param>
                    </con:xqueryTransform>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f4c</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($PersonalCountryJob)!=""</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:replace varName="body" contents-only="true">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f4a</con4:id>
                  <con2:location>
                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress))

where ./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AddressType = "Job"

return

./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:PersonalCountry</con:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PersonalCountryJob</con:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:assign varName="PersonalPostalCodeHome">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f71</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to 2)
where $Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/@UseType="13"

return

data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/com:PostalCode)</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f64</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($PersonalPostalCodeHome)!=""</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:replace varName="body" contents-only="true">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f63</con3:id>
                  <con2:location>
                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress))

where ./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AddressType = "Home"

return

./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:PersonalPostalCode</con:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PersonalPostalCodeHome</con:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:assign varName="PersonalPostalCodeJob">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f6d</con4:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to 2)
where $Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/@UseType="14"

return

data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/com:PostalCode)</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f62</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($PersonalPostalCodeJob)!=""</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:replace varName="body" contents-only="true">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f61</con3:id>
                  <con2:location>
                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress))

where ./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AddressType = "Job"

return

./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:PersonalPostalCode</con:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PersonalPostalCodeJob</con:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:assign varName="PersonalProvinceHome">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f6f</con3:id>
            <con2:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">let $reqAddress as element(*)? := $Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[@UseType = "13"]
let $bodyAddress as element(*)? := $body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[AddressType = "Home"]
return
if (exists($reqAddress) and data($reqAddress/com:CountryName/@Code) = ("CA", "US", "AU")) then
    $reqAddress/com:StateProv/text()
else
    $bodyAddress/ayr:PersonalProvince/text()</con6:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f60</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($PersonalProvinceHome)!=""
or
data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[*]/com:CountryName/@Code) = "CA" 
 
or 
data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[*]/com:CountryName/@Code) = "US" 
 
or 
data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[*]/com:CountryName/@Code) = "AU"</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:replace varName="body" contents-only="true">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f5d</con3:id>
                  <con2:location>
                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress))

where ./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AddressType = "Home"

return

./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:PersonalProvince</con:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PersonalProvinceHome</con:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:replace varName="body" contents-only="true">
                <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-7462120426016971313-13c68ef3.153899eb02f.-7ded</con6:id>
                <con2:location>
                  <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress))

where ./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AddressType = "Home"

return

./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:PersonalProvince</con:xpathText>
                </con2:location>
                <con2:expr>
                  <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">''</con6:xqueryText>
                </con2:expr>
              </con2:replace>
            </con2:default>
          </con2:ifThenElse>
          <con2:assign varName="PersonalProvinceJob">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f6c</con4:id>
            <con2:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">let $reqAddress as element(*)? := $Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[@UseType="14"]
let $bodyAddress as element(*)? := $body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[AddressType = "Job"]
return
if (exists($reqAddress) and data($reqAddress/com:CountryName/@Code) = ("CA", "US", "AU")) then
    $reqAddress/com:StateProv/text()
else
    $bodyAddress/ayr:PersonalProvince/text()</con6:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f5f</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryConditionExpr xmlns:con="http://www.bea.com/wli/sb/stages/config">
                  <con:boolExpr operator="or">
                    <con:compExpr operator="!=">
                      <con:leftPath>data($PersonalProvinceJob)</con:leftPath>
                      <con:rightPath>""</con:rightPath>
                    </con:compExpr>
                    <con:compExpr operator="=">
                      <con:leftPath>data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[*]/com:CountryName/@Code)</con:leftPath>
                      <con:rightPath>"CA"</con:rightPath>
                    </con:compExpr>
                    <con:compExpr operator="=">
                      <con:leftPath>data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[*]/com:CountryName/@Code)</con:leftPath>
                      <con:rightPath>"US"</con:rightPath>
                    </con:compExpr>
                    <con:compExpr operator="=">
                      <con:leftPath>data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[*]/com:CountryName/@Code)</con:leftPath>
                      <con:rightPath>"AU"</con:rightPath>
                    </con:compExpr>
                  </con:boolExpr>
                </con:xqueryConditionExpr>
              </con2:condition>
              <con2:actions>
                <con2:replace varName="body" contents-only="true">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f5e</con3:id>
                  <con2:location>
                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress))

where ./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AddressType = "Job"

return

./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:PersonalProvince</con:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PersonalProvinceJob</con:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f79</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($PersonalCityJob) != ""</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:replace varName="body" contents-only="true">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f78</con3:id>
                  <con2:location>
                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress))

where ./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AddressType = "Job"

return

./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:PersonalCity</con:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PersonalCityJob</con:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f82</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($PersonalCityHome) != ""</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:replace varName="body" contents-only="true">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f81</con3:id>
                  <con2:location>
                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress))

where ./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AddressType = "Home"

return

./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:PersonalCity</con:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PersonalCityHome</con:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:assign varName="AYCompanyName">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7fac</con4:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in ( 1 to 2)
where(data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/com:CompanyName)!="" and data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/@UseType) = "14")

return

data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[$var]/com:CompanyName)</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7faa</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($AYCompanyName)!=""</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:replace varName="body" contents-only="true">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7fa9</con3:id>
                  <con2:location>
                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress))

where ./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AddressType = "Job"

return

./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AYCompanyName</con:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$AYCompanyName</con:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con:assign varName="PersonalStreetAddressHome" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con1:id xmlns:con1="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f7e</con1:id>
            <con:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">$Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[@UseType = "13"]/com:AddressLine[1]/text()</con6:xqueryText>
            </con:expr>
          </con:assign>
          <con2:ifThenElse>
            <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-1549501064853706357-973051f.14c4fe18518.-7e8e</con6:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($PersonalStreetAddressHome) != ""</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con:replace varName="body" contents-only="true" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
                  <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-1549501064853706357-973051f.14c4fe18518.-7e8d</con6:id>
                  <con:location>
                    <con6:xpathText xmlns:con6="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[ayr:AddressType = "Home"]/ayr:PersonalStreetAddress</con6:xpathText>
                  </con:location>
                  <con:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PersonalStreetAddressHome</con:xqueryText>
                  </con:expr>
                </con:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con:assign varName="DescriptionHome" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-1549501064853706357-973051f.14c4fe18518.-7d4a</con6:id>
            <con:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">let $address as element(*)? := $Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[@UseType = "13"]

return
if (exists($address/@Description) and $address/com:CountryName/@Code = ("JP", "GB")) then
	data($address/@Description)
else
	""</con6:xqueryText>
            </con:expr>
          </con:assign>
          <con:assign varName="PersonalStreetAddress2Home" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-1549501064853706357-973051f.14c4fe18518.-7fc8</con6:id>
            <con:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">let $address as element(*)? := $Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[@UseType = "13"]

return
if ($address/com:CountryName/@Code = ("KP", "KR", "CA", "CN", "IN", "NZ")) then
	$address/com:AddressLine[2]/text()
else
	""</con6:xqueryText>
            </con:expr>
          </con:assign>
          <con:replace varName="body" contents-only="true" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con6:comment xmlns:con6="http://www.bea.com/wli/sb/stages/config">Using either DescriptionHome or PersonalStreetAddress2Home, according to FCOM-1653 both should not be present</con6:comment>
            <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-1549501064853706357-973051f.14c4fe18518.-7dfc</con6:id>
            <con:location>
              <con6:xpathText xmlns:con6="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[ayr:AddressType = "Home"]/ayr:PersonalStreetAddress2</con6:xpathText>
            </con:location>
            <con:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">if (data($DescriptionHome) != "") then
	$DescriptionHome
else if (data($PersonalStreetAddress2Home) != "") then
	$PersonalStreetAddress2Home
else
	""</con6:xqueryText>
            </con:expr>
          </con:replace>
          <con:assign varName="PersonalStreetAddress3Home" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-1549501064853706357-973051f.14c4fe18518.-7fab</con6:id>
            <con:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">""

(: $Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[@UseType = "13"]/com:AddressLine[3]/text() :)</con6:xqueryText>
            </con:expr>
          </con:assign>
          <con:assign varName="CountyHome" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-1549501064853706357-973051f.14c4fe18518.-7d8c</con6:id>
            <con:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">""

(: data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[@UseType = "13"]/com:County) :)</con6:xqueryText>
            </con:expr>
          </con:assign>
          <con:replace varName="body" contents-only="true" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-1549501064853706357-973051f.14c4fe18518.-7dc4</con6:id>
            <con:location>
              <con6:xpathText xmlns:con6="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[ayr:AddressType = "Home"]/ayr:PersonalStreetAddress3</con6:xpathText>
            </con:location>
            <con:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">(:

FCOM-1653 :
- PersonalStreetAddress3Home no longer populated -->
- County no longer forwarded
   
if (data($PersonalStreetAddress3Home) != "") then
	$PersonalStreetAddress3Home
else if (data($CountyHome) != "") then
	$CountyHome
else
:)
	""</con6:xqueryText>
            </con:expr>
          </con:replace>
          <con:assign varName="PersonalStreetAddressJob" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con1:id xmlns:con1="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f78</con1:id>
            <con:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">$Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[@UseType = "14"]/com:AddressLine[1]/text()</con6:xqueryText>
            </con:expr>
          </con:assign>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7fa1</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($PersonalStreetAddressJob) != ""</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con:replace varName="body" contents-only="true" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
                  <con1:id xmlns:con1="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7f9b</con1:id>
                  <con:location>
                    <con6:xpathText xmlns:con6="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[ayr:AddressType = "Job"]/ayr:PersonalStreetAddress</con6:xpathText>
                  </con:location>
                  <con:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PersonalStreetAddressJob</con:xqueryText>
                  </con:expr>
                </con:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con:assign varName="DescriptionJob" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-1549501064853706357-973051f.14c4fe18518.-7d4c</con6:id>
            <con:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">let $address as element(*)? := $Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[@UseType ="14"]

return
if (exists($address/@Description) and $address/com:CountryName/@Code = ("JP", "GB")) then
	data($address/@Description)
else
	""</con6:xqueryText>
            </con:expr>
          </con:assign>
          <con:assign varName="PersonalStreetAddress2Job" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-1549501064853706357-973051f.14c4fe18518.-7d6c</con6:id>
            <con:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">let $address as element(*)? := $Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[@UseType = "14"]

return
if ($address/com:CountryName/@Code = ("KP", "KR", "CA", "CN", "IN", "NZ")) then
	$address/com:AddressLine[2]/text()
else
	""</con6:xqueryText>
            </con:expr>
          </con:assign>
          <con:replace varName="body" contents-only="true" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con6:comment xmlns:con6="http://www.bea.com/wli/sb/stages/config">Using either DescriptionHome or PersonalStreetAddress2Home, according to FCOM-1653 both should not be present</con6:comment>
            <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-1549501064853706357-973051f.14c4fe18518.-7d4e</con6:id>
            <con:location>
              <con6:xpathText xmlns:con6="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[ayr:AddressType = "Job"]/ayr:PersonalStreetAddress2</con6:xpathText>
            </con:location>
            <con:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">if (data($DescriptionJob) != "") then
	$DescriptionJob
else if (data($PersonalStreetAddress2Job) != "") then
	$PersonalStreetAddress2Job
else
	""</con6:xqueryText>
            </con:expr>
          </con:replace>
          <con:assign varName="PersonalStreetAddress3Job" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-1549501064853706357-973051f.14c4fe18518.-7d2a</con6:id>
            <con:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">let $address as element(*)? := $Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[@UseType = "14"]

return
if ($address/com:CountryName/@Code = ("KP", "KR", "CA", "CN", "IN", "NZ")) then
	$address/com:AddressLine[3]/text()
else
	""</con6:xqueryText>
            </con:expr>
          </con:assign>
          <con:assign varName="CountyJob" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con1:id xmlns:con1="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f74</con1:id>
            <con:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">""

(: data($Request/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[@UseType ="14"]/com:County) :)</con6:xqueryText>
            </con:expr>
          </con:assign>
          <con:replace varName="body" contents-only="true" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-1549501064853706357-973051f.14c4fe18518.-7d0c</con6:id>
            <con:location>
              <con6:xpathText xmlns:con6="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[ayr:AddressType = "Job"]/ayr:PersonalStreetAddress3</con6:xpathText>
            </con:location>
            <con:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">if (data($PersonalStreetAddress3Job) != "") then
	$PersonalStreetAddress3Job
(:

FCOM-1653 :
- County no longer forwarded
   
else if (data($CountyJob) != "") then
	$CountyJob

:)
else
	""</con6:xqueryText>
            </con:expr>
          </con:replace>
          <con2:ifThenElse>
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-9201802019042183556-507f7cec.13b900147f1.-7c8f</con5:id>
            <con2:case>
              <con2:condition>
                <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">xs:int($HomeIndicatora) > 0</con5:xqueryText>
              </con2:condition>
              <con2:actions>
                <con:replace varName="body" contents-only="true" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-9201802019042183556-507f7cec.13b900147f1.-7c1d</con5:id>
                  <con:location>
                    <con5:xpathText xmlns:con5="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress))

where ./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AddressType = "Home"

return

./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AYMailReturned</con5:xpathText>
                  </con:location>
                  <con:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">"N"</con5:xqueryText>
                  </con:expr>
                </con:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:ifThenElse>
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-9201802019042183556-507f7cec.13b900147f1.-7bac</con5:id>
            <con2:case>
              <con2:condition>
                <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">xs:int($JobIndicatora) > 0</con5:xqueryText>
              </con2:condition>
              <con2:actions>
                <con:replace varName="body" contents-only="true" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-9201802019042183556-507f7cec.13b900147f1.-7bab</con5:id>
                  <con:location>
                    <con5:xpathText xmlns:con5="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress))

where ./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AddressType = "Job"

return

./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AYMailReturned</con5:xpathText>
                  </con:location>
                  <con:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">"N"</con5:xqueryText>
                  </con:expr>
                </con:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="Portal To Synchronise III" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
        <con:comment>Miscellaneous Transformation</con:comment>
        <con:context>
          <con3:varNsDecl prefix="ayr" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con3:varNsDecl prefix="asi" namespace="http://siebel.com/asi/" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="ayr1" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20â€“%20Long%20Portal" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con5:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
          <con5:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
          <con1:variable name="Siebel" path="$Siebel">
            <con1:service operation="QuerybyExampleFullMember">
              <con1:business ref="MemberProfileProcessing/businessservices/AYLoyMemberPortal"/>
            </con1:service>
          </con1:variable>
        </con:context>
        <con:actions>
          <con:assign varName="CitizenCountry" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con1:id xmlns:con1="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f72</con1:id>
            <con:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn:upper-case($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:CitizenCountryName/@Code)</con:xqueryText>
            </con:expr>
          </con:assign>
          <con2:assign varName="CitizendvmTable">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7479597100834234522--13b7068.12d1699f1ec.-7ce1</con4:id>
            <con2:expr>
              <con6:xqueryTransform xmlns:con6="http://www.bea.com/wli/sb/stages/config">
                <con6:resource ref="Common/transformations/CitizenshipDVM"/>
              </con6:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-245067393091034326-1ca484fa.12b37bbabac.-7f20</con4:id>
            <con2:case>
              <con2:condition>
                <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                  <con4:unaryExpr>
                    <con4:path>data($CitizenCountry)</con4:path>
                  </con4:unaryExpr>
                </con4:xqueryConditionExpr>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="SiebelCode">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-245067393091034326-1ca484fa.12b37bbabac.-7f1f</con3:id>
                  <con2:expr>
                    <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                      <con:resource ref="MemberProfileProcessing/transformations/InsertDVM"/>
                      <con:param name="sourceValue">
                        <con:path>$CitizenCountry</con:path>
                      </con:param>
                      <con:param name="sourceColumnName">
                        <con:path>"CitizenshipCode"</con:path>
                      </con:param>
                      <con:param name="targetColumnName">
                        <con:path>"CitizenshipName"</con:path>
                      </con:param>
                      <con:param name="defaultValue">
                        <con:path>""</con:path>
                      </con:param>
                      <con:param name="dvmTable">
                        <con:path>$CitizendvmTable</con:path>
                      </con:param>
                    </con:xqueryTransform>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con:replace varName="body" contents-only="true" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con1:id xmlns:con1="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f70</con1:id>
            <con:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:Citizenship</con:xpathText>
            </con:location>
            <con:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$SiebelCode</con:xqueryText>
            </con:expr>
          </con:replace>
          <con2:assign varName="AYGuardianMemberNumber">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f6d</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:RelatedTraveler))
where $Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:RelatedTraveler[$var]/@Relation = "guardian"

return

$Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:RelatedTraveler[$var]/com:UniqueID/@ID</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f6c</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:AYGuardianMemberNumber</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$AYGuardianMemberNumber</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="AYGuardianName">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f6b</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:RelatedTraveler))
where $Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:RelatedTraveler/@Relation = "guardian"

return

$Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:RelatedTraveler[$var]/com:PersonName/com:Surname/text()</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f6a</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:AYGuardianName</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$AYGuardianName</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="AYGuardianPhoneNumber">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f69</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:RelatedTraveler))
where $Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:RelatedTraveler[$var]/@Relation = "guardian"

return

for $var2 in (1 to fn:count($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:RelatedTraveler[$var]/com:Telephone))
where 
data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:RelatedTraveler[$var]/com:Telephone[$var2]/@PhoneLocationType)="6" and 
data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:RelatedTraveler[$var]/com:Telephone[$var2]/@PhoneTechType)="5"

return 

$Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:RelatedTraveler[$var]/com:Telephone[$var2]/@PhoneNumber</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f68</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:AYGuardianPhoneNumber</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$AYGuardianPhoneNumber</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="AYGuardianEmail">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f67</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:RelatedTraveler))
where $Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:RelatedTraveler/@Relation = "guardian"

return

$Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:RelatedTraveler[$var]/com:Email/text()</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f66</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:AYGuardianEmail</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$AYGuardianEmail</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="LoyTravelProfileId">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7238953409985074563-2a81867e.12d73402cbf.-7f79</con4:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfLoyTravelProfile/ayr:LoyTravelProfile/ayr:Id)</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7238953409985074563-2a81867e.12d73402cbf.-7f78</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Document/@DocType) = "2"</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="DocPassportCountry">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7238953409985074563-2a81867e.12d73402cbf.-7f77</con4:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Document/@DocIssueCountry)</con:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:assign varName="PassportCountry">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7238953409985074563-2a81867e.12d73402cbf.-7f76</con3:id>
                  <con2:expr>
                    <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                      <con:resource ref="MemberProfileProcessing/transformations/InsertDVM"/>
                      <con:param name="sourceValue">
                        <con:path>$DocPassportCountry</con:path>
                      </con:param>
                      <con:param name="sourceColumnName">
                        <con:path>"CountryCode"</con:path>
                      </con:param>
                      <con:param name="targetColumnName">
                        <con:path>"CountryName"</con:path>
                      </con:param>
                      <con:param name="defaultValue">
                        <con:path>""</con:path>
                      </con:param>
                      <con:param name="dvmTable">
                        <con:path>$dvmTable</con:path>
                      </con:param>
                    </con:xqueryTransform>
                  </con2:expr>
                </con2:assign>
                <con2:delete varName="body">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7238953409985074563-2a81867e.12d73402cbf.-7f75</con4:id>
                  <con2:location>
                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfLoyTravelProfile/ayr:LoyTravelProfile</con:xpathText>
                  </con2:location>
                </con2:delete>
                <con2:assign varName="ListOfLoyTravelProfile">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7238953409985074563-2a81867e.12d73402cbf.-7f74</con4:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config"><![CDATA[<ayr:LoyTravelProfile>
                              <ayr:Id>{$LoyTravelProfileId}</ayr:Id>
                              <ayr:ParentContactId>{$LoyTravelProfileId}</ayr:ParentContactId>
                              <ayr:PassportCountry>{$PassportCountry}</ayr:PassportCountry>

                              <ayr:PassportExpirationDate>{
fn:concat(
fn:substring(data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Document/@ExpireDate),6,2),
"/",
fn:substring(data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Document/@ExpireDate),9,2),
"/",
fn:substring(data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Document/@ExpireDate),1,4),
"",
fn:substring(data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Document/@ExpireDate),12)
)}</ayr:PassportExpirationDate>

                              <ayr:PassportIssueDate>{
fn:concat(
fn:substring(data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Document/@EffectiveDate),6,2),
"/",
fn:substring(data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Document/@EffectiveDate),9,2),
"/",
fn:substring(data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Document/@EffectiveDate),1,4),
"",
fn:substring(data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Document/@EffectiveDate),12)
)
}</ayr:PassportIssueDate>

                              <ayr:PassportNumber>{data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Document/@DocID)}</ayr:PassportNumber>
                              <ayr:PreferredMealType></ayr:PreferredMealType>
                              <ayr:PreferredSeatType></ayr:PreferredSeatType>
                              <ayr:SmokeFlag>N</ayr:SmokeFlag>
                           </ayr:LoyTravelProfile>]]></con:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:insert varName="body">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7238953409985074563-2a81867e.12d73402cbf.-7f73</con4:id>
                  <con2:location>
                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfLoyTravelProfile</con:xpathText>
                  </con2:location>
                  <con2:where>first-child</con2:where>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$ListOfLoyTravelProfile</con:xqueryText>
                  </con2:expr>
                </con2:insert>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:assign varName="EmptyPassportData">
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7238953409985074563-2a81867e.12d73402cbf.-7f72</con4:id>
                <con2:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config"><![CDATA[<ayr:LoyTravelProfile>
                              <ayr:Id>{$LoyTravelProfileId}</ayr:Id>
                              <ayr:ParentContactId>{$LoyTravelProfileId}</ayr:ParentContactId>
                              <ayr:PassportCountry></ayr:PassportCountry>

                              <ayr:PassportExpirationDate></ayr:PassportExpirationDate>

                              <ayr:PassportIssueDate></ayr:PassportIssueDate>

                              <ayr:PassportNumber></ayr:PassportNumber>
                              <ayr:PreferredMealType></ayr:PreferredMealType>
                              <ayr:PreferredSeatType></ayr:PreferredSeatType>
                              <ayr:SmokeFlag>N</ayr:SmokeFlag>
                           </ayr:LoyTravelProfile>]]></con:xqueryText>
                </con2:expr>
              </con2:assign>
              <con2:replace varName="body" contents-only="true">
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7238953409985074563-2a81867e.12d73402cbf.-7f71</con4:id>
                <con2:location>
                  <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfLoyTravelProfile</con:xpathText>
                </con2:location>
                <con2:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$EmptyPassportData</con:xqueryText>
                </con2:expr>
              </con2:replace>
            </con2:default>
          </con2:ifThenElse>
          <con2:assign varName="JobTitle">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f5c</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:EmployeeInfo/@EmployeeTitle</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f5b</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:JobTitle</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$JobTitle</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="LanguageID">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f5a</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn:upper-case(data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:LanguageSpoken/@Code))</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="Lang_DVM">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3502553873978082500--7a0d0b2c.131f4dc8dfa.-7f86</con4:id>
            <con2:expr>
              <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                <con:resource ref="Common/transformations/Country_DVM"/>
              </con:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="SiebelLanguageID">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3502553873978082500--7a0d0b2c.131f4dc8dfa.-7f85</con4:id>
            <con2:expr>
              <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                <con:resource ref="MemberProfileProcessing/transformations/InsertDVM"/>
                <con:param name="sourceValue">
                  <con:path>$LanguageID</con:path>
                </con:param>
                <con:param name="sourceColumnName">
                  <con:path>"Input"</con:path>
                </con:param>
                <con:param name="targetColumnName">
                  <con:path>"Output"</con:path>
                </con:param>
                <con:param name="defaultValue">
                  <con:path>"ENU"</con:path>
                </con:param>
                <con:param name="dvmTable">
                  <con:path>$Lang_DVM</con:path>
                </con:param>
              </con:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f59</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:LanguageId</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$SiebelLanguageID</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="PreferredSeatType">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f58</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">if (data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:PrefCollections/com:PrefCollection/com:AirlinePref/com:SeatPref/com:SeatPreferences/text()) = "5") then "Window"

else if (data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:PrefCollections/com:PrefCollection/com:AirlinePref/com:SeatPref/com:SeatPreferences/text()) = "3") then "Aisle"
else
""</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f57</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfLoyTravelProfile/ayr:LoyTravelProfile/ayr:PreferredSeatType</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PreferredSeatType</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="PreferredMealType">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f56</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:PrefCollections/com:PrefCollection/com:AirlinePref/com:SSR_Pref/@SSR_Code</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f55</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfLoyTravelProfile/ayr:LoyTravelProfile/ayr:PreferredMealType</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PreferredMealType</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6310268134615942556--58e9ee9b.12bc2e13088.-7fb0</con4:id>
            <con2:case>
              <con2:condition>
                <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                  <con4:compExpr operator="=">
                    <con4:leftPath>data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField/@KeyValue)</con4:leftPath>
                    <con4:rightPath>"7"</con4:rightPath>
                  </con4:compExpr>
                </con4:xqueryConditionExpr>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="SuppressSMSPromos">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6310268134615942556--58e9ee9b.12bc2e13088.-7faf</con3:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField)) 
where data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) ="7"

return

if ( data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) ="7"
and
data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[$var]) = "TRUE")
then "N"
else 
"Y"</con:xqueryText>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:assign varName="SuppressSMSPromos">
                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6310268134615942556--58e9ee9b.12bc2e13088.-7fae</con3:id>
                <con2:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">"Y"</con:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:default>
          </con2:ifThenElse>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f53</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:SuppressSMSPromos</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$SuppressSMSPromos</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6310268134615942556--58e9ee9b.12bc2e13088.-7fad</con4:id>
            <con2:case>
              <con2:condition>
                <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                  <con4:compExpr operator="=">
                    <con4:leftPath>data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField/@KeyValue)</con4:leftPath>
                    <con4:rightPath>"8"</con4:rightPath>
                  </con4:compExpr>
                </con4:xqueryConditionExpr>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="ReceivePartnerPromotionFlag">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6310268134615942556--58e9ee9b.12bc2e13088.-7fac</con3:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField)) 
where data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) ="8"

return

if ( data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) ="8"
and
data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[$var]) = "TRUE")
then "Y"
else 
"N"</con:xqueryText>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:assign varName="ReceivePartnerPromotionFlag">
                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6310268134615942556--58e9ee9b.12bc2e13088.-7faa</con3:id>
                <con2:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">"N"</con:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:default>
          </con2:ifThenElse>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f51</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ReceivePartnerPromotionFlag</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$ReceivePartnerPromotionFlag</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6310268134615942556--58e9ee9b.12bc2e13088.-7fa9</con4:id>
            <con2:case>
              <con2:condition>
                <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                  <con4:compExpr operator="=">
                    <con4:leftPath>data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField/@KeyValue)</con4:leftPath>
                    <con4:rightPath>"9"</con4:rightPath>
                  </con4:compExpr>
                </con4:xqueryConditionExpr>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="SuppresseMailWeeklyOffers">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6310268134615942556--58e9ee9b.12bc2e13088.-7fa8</con3:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField)) 
where data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) ="9"

return

if ( data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) ="9"
and
data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[$var]) = "TRUE")
then "N"
else 
"Y"</con:xqueryText>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:assign varName="SuppresseMailWeeklyOffers">
                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6310268134615942556--58e9ee9b.12bc2e13088.-7fa7</con3:id>
                <con2:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">"Y"</con:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:default>
          </con2:ifThenElse>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f4f</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:SuppresseMailWeeklyOffers</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$SuppresseMailWeeklyOffers</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:ifThenElse>
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5007972636938380433-38250b97.13b2d56d23b.-7fe0</con5:id>
            <con2:case>
              <con2:condition>
                <con5:xqueryConditionExpr xmlns:con5="http://www.bea.com/wli/sb/stages/config">
                  <con5:unaryExpr>
                    <con5:path>data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField/@KeyValue) = "10"</con5:path>
                  </con5:unaryExpr>
                </con5:xqueryConditionExpr>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="SuppressAllEmailsFlag">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5007972636938380433-38250b97.13b2d56d23b.-7fdf</con5:id>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField)) 
where data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "10"

return

if (data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "10"
and
data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[$var]) = "TRUE")
then "N"
else 
"Y"</con5:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:replace varName="body" contents-only="true">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-7129130153252170021-75b6b257.13d880e53ab.-7fc3</con5:id>
                  <con2:location>
                    <con5:xpathText xmlns:con5="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:SuppressAllEmails</con5:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$SuppressAllEmailsFlag</con5:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:ifThenElse>
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5007972636938380433-38250b97.13b2d56d23b.-7fdc</con5:id>
            <con2:case>
              <con2:condition>
                <con5:xqueryConditionExpr xmlns:con5="http://www.bea.com/wli/sb/stages/config">
                  <con5:unaryExpr>
                    <con5:path>data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField/@KeyValue)="11"</con5:path>
                  </con5:unaryExpr>
                </con5:xqueryConditionExpr>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="SuppressAllFaxesFlag">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5007972636938380433-38250b97.13b2d56d23b.-7fdb</con5:id>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField)) 
where data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "11"

return

if (data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "11"
and
data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[$var]) = "TRUE")
then "N"
else 
"Y"</con5:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:replace varName="body" contents-only="true">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-7129130153252170021-75b6b257.13d880e53ab.-7fc5</con5:id>
                  <con2:location>
                    <con5:xpathText xmlns:con5="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:SuppressAllFaxes</con5:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$SuppressAllFaxesFlag</con5:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:ifThenElse>
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5007972636938380433-38250b97.13b2d56d23b.-7fd8</con5:id>
            <con2:case>
              <con2:condition>
                <con5:xqueryConditionExpr xmlns:con5="http://www.bea.com/wli/sb/stages/config">
                  <con5:unaryExpr>
                    <con5:path>data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField/@KeyValue)="12"</con5:path>
                  </con5:unaryExpr>
                </con5:xqueryConditionExpr>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="SuppressAllSMSFlag">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5007972636938380433-38250b97.13b2d56d23b.-7fd7</con5:id>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField)) 
where data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "12"

return

if (data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "12"
and
data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[$var]) = "TRUE")
then "N"
else 
"Y"</con5:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:replace varName="body" contents-only="true">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-7129130153252170021-75b6b257.13d880e53ab.-7fc9</con5:id>
                  <con2:location>
                    <con5:xpathText xmlns:con5="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:SuppressAllSMS</con5:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$SuppressAllSMSFlag</con5:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:ifThenElse>
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5007972636938380433-38250b97.13b2d56d23b.-7fd4</con5:id>
            <con2:case>
              <con2:condition>
                <con5:xqueryConditionExpr xmlns:con5="http://www.bea.com/wli/sb/stages/config">
                  <con5:unaryExpr>
                    <con5:path>data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField/@KeyValue)="13"</con5:path>
                  </con5:unaryExpr>
                </con5:xqueryConditionExpr>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="eMailFlightInfoFlag">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5007972636938380433-38250b97.13b2d56d23b.-7fd3</con5:id>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField)) 
where data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "13"

return

if (data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "13"
and
data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[$var]) = "TRUE")
then "Y"
else 
"N"</con5:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:replace varName="body" contents-only="true">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-7129130153252170021-75b6b257.13d880e53ab.-7fc7</con5:id>
                  <con2:location>
                    <con5:xpathText xmlns:con5="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:eMailFlightInfo</con5:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$eMailFlightInfoFlag</con5:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:ifThenElse>
            <con5:comment xmlns:con5="http://www.bea.com/wli/sb/stages/config">Check for Household, if nothing, leave as-is</con5:comment>
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5142151973991985845-58056dd7.13db1954389.-77e4</con5:id>
            <con2:case>
              <con2:condition>
                <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">fn:exists($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[@KeyValue="HHOLD"])</con5:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="HouseholdSize">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5142151973991985845-58056dd7.13db1954389.-77e3</con5:id>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[@KeyValue= "HHOLD"])</con5:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:replace contents-only="true" varName="body">
                  <con5:comment xmlns:con5="http://www.bea.com/wli/sb/stages/config">Replace the householdsize in the synchronize call</con5:comment>
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5142151973991985845-58056dd7.13db1954389.-77e2</con5:id>
                  <con2:location>
                    <con5:xpathText xmlns:con5="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:AYHouseholdSize</con5:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$HouseholdSize</con5:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:ifThenElse>
            <con5:comment xmlns:con5="http://www.bea.com/wli/sb/stages/config">PreferredLanguage code transformation, if it's existing in insert</con5:comment>
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5142151973991985845-58056dd7.13db1954389.-78ce</con5:id>
            <con2:case>
              <con2:condition>
                <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">fn:exists($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[@KeyValue="PREFLANG"])</con5:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="PreferredLanguageCode_ISO">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5142151973991985845-58056dd7.13db1954389.-78cd</con5:id>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:CustomFields/com:CustomField[@KeyValue= "PREFLANG"])</con5:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:assign varName="PreferredLanguagedvm">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5142151973991985845-58056dd7.13db1954389.-78cc</con5:id>
                  <con2:expr>
                    <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                      <con:resource ref="Common/transformations/Country_DVM"/>
                    </con:xqueryTransform>
                  </con2:expr>
                </con2:assign>
                <con2:assign varName="PreferredLanguageCode">
                  <con5:comment xmlns:con5="http://www.bea.com/wli/sb/stages/config">Call the dvm function for mapping language from ISO -> Siebel PreferredLanguage picklist</con5:comment>
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5142151973991985845-58056dd7.13db1954389.-78cb</con5:id>
                  <con2:expr>
                    <con5:xqueryTransform xmlns:con5="http://www.bea.com/wli/sb/stages/config">
                      <con5:resource ref="MemberProfileProcessing/transformations/InsertDVM"/>
                      <con5:param name="targetColumnName">
                        <con5:path>"SiebelPreferredLangCode"</con5:path>
                      </con5:param>
                      <con5:param name="dvmTable">
                        <con5:path>$PreferredLanguagedvm</con5:path>
                      </con5:param>
                      <con5:param name="defaultValue">
                        <con5:path>"ENU"</con5:path>
                      </con5:param>
                      <con5:param name="sourceColumnName">
                        <con5:path>"ISOCode"</con5:path>
                      </con5:param>
                      <con5:param name="sourceValue">
                        <con5:path>$PreferredLanguageCode_ISO</con5:path>
                      </con5:param>
                    </con5:xqueryTransform>
                  </con2:expr>
                </con2:assign>
                <con2:replace varName="body" contents-only="true">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5142151973991985845-58056dd7.13db1954389.-78ca</con5:id>
                  <con2:location>
                    <con5:xpathText xmlns:con5="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:PreferredLanguageCode</con5:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$PreferredLanguageCode</con5:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="Portal To Synchronise IV" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
        <con:comment>Child Id Transformation</con:comment>
        <con:context>
          <con3:varNsDecl prefix="ayr" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con3:varNsDecl prefix="asi" namespace="http://siebel.com/asi/" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="ayr1" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20â€“%20Long%20Portal" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con5:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
          <con5:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
          <con1:variable name="Siebel" path="$Siebel">
            <con1:service operation="QuerybyExampleFullMember">
              <con1:business ref="MemberProfileProcessing/businessservices/AYLoyMemberPortal"/>
            </con1:service>
          </con1:variable>
        </con:context>
        <con:actions>
          <con2:ifThenElse>
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-530140766071300154-77102151.137fe661869.-7fd5</con5:id>
            <con2:case>
              <con2:condition>
                <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">data($temp/prof:UpdateProfile//com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/@Status="P")</con5:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:ifThenElse>
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-530140766071300154-77102151.137fe661869.-7fd4</con5:id>
                  <con2:case>
                    <con2:condition>
                      <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:FirstName)!="" 
and
data($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:LastName)!=""
and
data($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:BirthDate)!=""
and
data($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfLoyCommunicationSms/ayr:LoyCommunicationSms/ayr:AlternateSMS)!=""
and
data($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfCommunicationAddress/ayr:CommunicationAddress/ayr:AlternateEmailAddress)!=""
and
data($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress/ayr:PersonalCity)!="" 
and
data($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress/ayr:PersonalCountry)!=""</con:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:replace varName="body" contents-only="true">
                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-530140766071300154-77102151.137fe661869.-7fd3</con5:id>
                        <con2:location>
                          <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:Status</con:xpathText>
                        </con2:location>
                        <con2:expr>
                          <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">"Active"</con:xqueryText>
                        </con2:expr>
                      </con2:replace>
                    </con2:actions>
                  </con2:case>
                </con2:ifThenElse>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:assign varName="status">
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-530140766071300154-77102151.137fe661869.-7fd2</con5:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:Status/text()</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="ChildStructure">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3239275774872309362-e281805.12b51e3d512.-7fdb</con4:id>
            <con2:expr>
              <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                <con:resource ref="MemberProfileProcessing/transformations/ChildIDQuery"/>
                <con:param name="Request">
                  <con:path>$Request</con:path>
                </con:param>
                <con:param name="MemberID">
                  <con:path>if(data($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:LoyaltyMemberId2)!="") then data($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:LoyaltyMemberId2) else "0"</con:path>
                </con:param>
              </con:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="false">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3239275774872309362-e281805.12b51e3d512.-7fc8</con4:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfAyLoyMemberChildrenBirthYear</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$ChildStructure</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="HobbiesDVM">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5111138515665097604--5b5998f1.12b2d79a305.-7f45</con4:id>
            <con2:expr>
              <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<tns:dvm name="Hobbies-dvm" xmlns:tns="http://xmlns.oracle.com/dvm" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
  <tns:description>Hobbies DVM</tns:description>
  <tns:columns>
    <tns:column name="HobbyName"/>
    <tns:column name="HobbyID"/>
  </tns:columns>
  <tns:rows>

<tns:row>
	<tns:cell>Museum / Art galleries</tns:cell>
	<tns:cell>MT</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Opera / Concerts / Ballet</tns:cell>
	<tns:cell>OK</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Theater and Musicals</tns:cell>
	<tns:cell>TM</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Popular Music</tns:cell>
	<tns:cell>KM</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Classical Music</tns:cell>
	<tns:cell>MS</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Jazz</tns:cell>
	<tns:cell>JZ</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Food &amp; Wine</tns:cell>
	<tns:cell>RV</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Health and Spa holidays</tns:cell>
	<tns:cell>TK</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Golf</tns:cell>
	<tns:cell>GO</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Tennis</tns:cell>
	<tns:cell>TE</tns:cell>
</tns:row>

<tns:row>
	<tns:cell>Sailing</tns:cell>
	<tns:cell>PU</tns:cell>
</tns:row>

<tns:row>
	<tns:cell>Watersports</tns:cell>
	<tns:cell>VE</tns:cell>
</tns:row>

<tns:row>
	<tns:cell>Diving</tns:cell>
	<tns:cell>SU</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Horse riding / Trotting</tns:cell>
	<tns:cell>RR</tns:cell>
</tns:row>

<tns:row>
	<tns:cell>Cross-country skiing</tns:cell>
	<tns:cell>MU</tns:cell>
</tns:row>

<tns:row>
	<tns:cell>Hunting</tns:cell>
	<tns:cell>ME</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Fishing</tns:cell>
	<tns:cell>KA</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Ice hockey</tns:cell>
	<tns:cell>JK</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Football</tns:cell>
	<tns:cell>JA</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Basketball</tns:cell>
	<tns:cell>KO</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Car and Motor Sports</tns:cell>
	<tns:cell>AU</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Alpine Skiing / Telemark</tns:cell>
	<tns:cell>LA</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Snowboarding</tns:cell>
	<tns:cell>SB</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Design</tns:cell>
	<tns:cell>DE</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Technology &amp; Computers</tns:cell>
	<tns:cell>TC</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Photography</tns:cell>
	<tns:cell>PH</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Nature</tns:cell>
	<tns:cell>NA</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Food &amp; Drink</tns:cell>
	<tns:cell>FOD</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Sport &amp; Exercise</tns:cell>
	<tns:cell>SPE</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Music &amp; Entertainment</tns:cell>
	<tns:cell>MUE</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Beauty &amp; Fashion</tns:cell>
	<tns:cell>BEF</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Home &amp; Decoration</tns:cell>
	<tns:cell>HOD</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Environment &amp; Social Responsib</tns:cell>
	<tns:cell>ENR</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Business life</tns:cell>
	<tns:cell>BUL</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Health &amp; Wellbeing</tns:cell>
	<tns:cell>HEW</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Hotels</tns:cell>
	<tns:cell>HOT</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Car rental</tns:cell>
	<tns:cell>CAR</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>City holidays</tns:cell>
	<tns:cell>CIH</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Beach holidays</tns:cell>
	<tns:cell>BEH</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Spa holidays</tns:cell>
	<tns:cell>SPH</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Active holidays</tns:cell>
	<tns:cell>ACH</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Tour holidays</tns:cell>
	<tns:cell>TOH</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Cruises</tns:cell>
	<tns:cell>CRU</tns:cell>
</tns:row>
  </tns:rows>
</tns:dvm>]]></con5:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="PrimaryContactID">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5111138515665097604--5b5998f1.12b2d79a305.-7f30</con4:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:PrimaryContactId/text()</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="HobbiesUpdate">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5111138515665097604--5b5998f1.12b2d79a305.-7f31</con4:id>
            <con2:expr>
              <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                <con:resource ref="MemberProfileProcessing/transformations/XQ_Req_HobbiesUpdate"/>
                <con:param name="HobbiesDvm">
                  <con:path>$HobbiesDVM</con:path>
                </con:param>
                <con:param name="PrimaryContactID">
                  <con:path>$PrimaryContactID</con:path>
                </con:param>
                <con:param name="Request">
                  <con:path>$Request</con:path>
                </con:param>
              </con:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:delete varName="body">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5431500898001039780-76e5f9f9.12c10140701.-7ea8</con4:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfEautoContactHobby/ayr:EautoContactHobby</con:xpathText>
            </con2:location>
          </con2:delete>
          <con2:replace varName="body" contents-only="false">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5431500898001039780-76e5f9f9.12c10140701.-7e96</con4:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfEautoContactHobby</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$HobbiesUpdate</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="HomeNewAddress">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-1987456877628131841--3a2b7d0e.12bf667a2ff.-7f84</con4:id>
            <con2:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">$body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[ayr:AddressType = "Home"]</con6:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="JobNewAddress">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-1987456877628131841--3a2b7d0e.12bf667a2ff.-7f83</con4:id>
            <con2:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">$body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[ayr:AddressType = "Job"]</con6:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-1987456877628131841--3a2b7d0e.12bf667a2ff.-7f61</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[*]/ayr:AddressType = "Job"</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="Req_Job">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-1987456877628131841--3a2b7d0e.12bf667a2ff.-7f0e</con4:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[@UseType="14"]</con:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:ifThenElse>
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-1987456877628131841--3a2b7d0e.12bf667a2ff.-7f5f</con4:id>
                  <con2:case>
                    <con2:condition>
                      <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Req_Job[@UseType="14"] and $Req_Job[@DefaultInd="1"]</con:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:delete varName="body">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-1987456877628131841--3a2b7d0e.12bf667a2ff.-7f42</con4:id>
                        <con2:location>
                          <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress))
where data(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AddressType)="Job"

return

./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]</con:xpathText>
                        </con2:location>
                      </con2:delete>
                      <con2:insert varName="body">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-1987456877628131841--3a2b7d0e.12bf667a2ff.-7f5e</con4:id>
                        <con2:location>
                          <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress</con:xpathText>
                        </con2:location>
                        <con2:where>first-child</con2:where>
                        <con2:expr>
                          <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$JobNewAddress</con:xqueryText>
                        </con2:expr>
                      </con2:insert>
                    </con2:actions>
                  </con2:case>
                  <con2:case>
                    <con2:condition>
                      <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Req_Job[@UseType="14"] and $Req_Job[@DefaultInd !="1"]</con:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:delete varName="body">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-1987456877628131841--3a2b7d0e.12bf667a2ff.-7f41</con4:id>
                        <con2:location>
                          <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress))
where data(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AddressType)="Job"

return

./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]</con:xpathText>
                        </con2:location>
                      </con2:delete>
                      <con2:insert varName="body">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-1987456877628131841--3a2b7d0e.12bf667a2ff.-7f5d</con4:id>
                        <con2:location>
                          <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress</con:xpathText>
                        </con2:location>
                        <con2:where>last-child</con2:where>
                        <con2:expr>
                          <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$JobNewAddress</con:xqueryText>
                        </con2:expr>
                      </con2:insert>
                    </con2:actions>
                  </con2:case>
                  <con2:case>
                    <con2:condition>
                      <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                        <con4:unaryExpr negative="true">
                          <con4:path>$Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[@UseType="14"]</con4:path>
                        </con4:unaryExpr>
                      </con4:xqueryConditionExpr>
                    </con2:condition>
                    <con2:actions>
                      <con2:delete varName="body">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6336454387977140720--44375bce.12c0ae2d388.-7fb7</con4:id>
                        <con2:location>
                          <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress))
where data(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AddressType)="Job"

return

./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]</con:xpathText>
                        </con2:location>
                      </con2:delete>
                    </con2:actions>
                  </con2:case>
                </con2:ifThenElse>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-1987456877628131841--3a2b7d0e.12bf667a2ff.-7f5c</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[*]/ayr:AddressType = "Home"</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="Req_Home">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-1987456877628131841--3a2b7d0e.12bf667a2ff.-7f0d</con4:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[@UseType="13"]</con:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:ifThenElse>
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-1987456877628131841--3a2b7d0e.12bf667a2ff.-7f5b</con4:id>
                  <con2:case>
                    <con2:condition>
                      <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Req_Home[@UseType="13"] and $Req_Home[@DefaultInd="1"]</con:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:delete varName="body">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-1987456877628131841--3a2b7d0e.12bf667a2ff.-7f40</con4:id>
                        <con2:location>
                          <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress))
where data(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AddressType)="Home"

return

./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]</con:xpathText>
                        </con2:location>
                      </con2:delete>
                      <con2:insert varName="body">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-1987456877628131841--3a2b7d0e.12bf667a2ff.-7f5a</con4:id>
                        <con2:location>
                          <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress</con:xpathText>
                        </con2:location>
                        <con2:where>first-child</con2:where>
                        <con2:expr>
                          <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$HomeNewAddress</con:xqueryText>
                        </con2:expr>
                      </con2:insert>
                    </con2:actions>
                  </con2:case>
                  <con2:case>
                    <con2:condition>
                      <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Req_Home[@UseType="13"] and $Req_Home[@DefaultInd !="1"]</con:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:delete varName="body">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-1987456877628131841--3a2b7d0e.12bf667a2ff.-7f3f</con4:id>
                        <con2:location>
                          <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress))
where data(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AddressType)="Home"

return

./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]</con:xpathText>
                        </con2:location>
                      </con2:delete>
                      <con2:insert varName="body">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-1987456877628131841--3a2b7d0e.12bf667a2ff.-7f59</con4:id>
                        <con2:location>
                          <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress</con:xpathText>
                        </con2:location>
                        <con2:where>last-child</con2:where>
                        <con2:expr>
                          <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$HomeNewAddress</con:xqueryText>
                        </con2:expr>
                      </con2:insert>
                    </con2:actions>
                  </con2:case>
                  <con2:case>
                    <con2:condition>
                      <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                        <con4:unaryExpr negative="true">
                          <con4:path>$Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:Address[@UseType="13"]</con4:path>
                        </con4:unaryExpr>
                      </con4:xqueryConditionExpr>
                    </con2:condition>
                    <con2:actions>
                      <con2:delete varName="body">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6336454387977140720--44375bce.12c0ae2d388.-7fb5</con4:id>
                        <con2:location>
                          <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress))
where data(./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]/ayr:AddressType)="Home"

return

./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[$var]</con:xpathText>
                        </con2:location>
                      </con2:delete>
                    </con2:actions>
                  </con2:case>
                </con2:ifThenElse>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6336454387977140720--44375bce.12c0ae2d388.-7ed6</con4:id>
            <con2:case>
              <con2:condition>
                <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                  <con4:compExpr operator="!=">
                    <con4:leftPath>data($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[1]/ayr:PersonalAddressId)</con4:leftPath>
                    <con4:rightPath>"0"</con4:rightPath>
                  </con4:compExpr>
                </con4:xqueryConditionExpr>
              </con2:condition>
              <con2:actions>
                <con2:replace varName="body" contents-only="true">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6336454387977140720--44375bce.12c0ae2d388.-7ed5</con4:id>
                  <con2:location>
                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:PrimaryPersonalAddressId</con:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[1]/ayr:PersonalAddressId)</con:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:replace varName="body" contents-only="false">
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6336454387977140720--44375bce.12c0ae2d388.-7ea2</con4:id>
                <con2:location>
                  <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:PrimaryPersonalAddressId</con:xpathText>
                </con2:location>
                <con2:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">&lt;ayr:PrimaryPersonalAddressId/></con:xqueryText>
                </con2:expr>
              </con2:replace>
            </con2:default>
          </con2:ifThenElse>
          <con2:replace varName="body" contents-only="true">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-1987456877628131841--3a2b7d0e.12bf667a2ff.-7ec7</con4:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:PrimaryPersonalAddressType</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[1]/ayr:AddressType)</con:xqueryText>
            </con2:expr>
          </con2:replace>
        </con:actions>
      </con:stage>
      <con:stage name="Synchronizing" errorHandler="_onErrorHandler-7181538584930003524--5d62a2e8.143de568622.-7710" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
        <con:comment>To : AYLoyQueryByExampleFullMember.Synchronise</con:comment>
        <con:context>
          <con3:varNsDecl prefix="ayr" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con3:varNsDecl prefix="asi" namespace="http://siebel.com/asi/" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con2:rename varName="body">
            <con4:comment xmlns:con4="http://www.bea.com/wli/sb/stages/config">Changing the namespace from QuerybyExampleFullMember to Synchronise</con4:comment>
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7eb1</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse</con:xpathText>
            </con2:location>
            <con2:localname>Synchronize</con2:localname>
          </con2:rename>
          <con:wsCallout xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con1:id xmlns:con1="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f4a</con1:id>
            <con:service ref="MemberProfileProcessing/businessservices/AYLoyMemberPortal" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con:operation>Synchronize</con:operation>
            <con:request>
              <con:body wrapped="true">$body</con:body>
              <con:header/>
            </con:request>
            <con:response>
              <con:body wrapped="true">body</con:body>
              <con:header/>
            </con:response>
            <con:requestTransform>
              <con4:log xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7de8</con5:id>
                <con4:logLevel>info</con4:logLevel>
                <con4:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                </con4:expr>
                <con4:message>Logging Synchronizing Request</con4:message>
              </con4:log>
              <con:delete varName="header">
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-2041694110763451302--16168512.131fb1161ef.-7f32</con4:id>
                <con:location>
                  <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./*</con:xpathText>
                </con:location>
              </con:delete>
              <con:assign varName="SiebelRequest">
                <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-7181538584930003524--5d62a2e8.143de568622.-7666</con6:id>
                <con:expr>
                  <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">$body</con6:xqueryText>
                </con:expr>
              </con:assign>
            </con:requestTransform>
            <con:responseTransform>
              <con4:log xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7de7</con5:id>
                <con4:logLevel>info</con4:logLevel>
                <con4:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                </con4:expr>
                <con4:message>Logging Synchronizing Request To Synchronizing Response</con4:message>
              </con4:log>
              <con4:ifThenElse xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config">
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6657838074217504034-20de61e7.12a56cdf324.-7fe4</con4:id>
                <con4:case>
                  <con4:condition>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn:local-name($body/*[1])='Fault'</con:xqueryText>
                  </con4:condition>
                  <con4:actions>
                    <con4:Error>
                      <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6657838074217504034-20de61e7.12a56cdf324.-7fe3</con4:id>
                      <con4:errCode>62</con4:errCode>
                    </con4:Error>
                  </con4:actions>
                </con4:case>
              </con4:ifThenElse>
            </con:responseTransform>
          </con:wsCallout>
        </con:actions>
      </con:stage>
      <con:stage name="Portal To AYLoyMemberInterest" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
        <con:comment>For : AYLoyMemberInterest</con:comment>
        <con:context>
          <con4:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con2:assign varName="InterestRequest">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-2822348576148956301-955768d.12b852d5f82.-7fbd</con3:id>
            <con2:expr>
              <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                <con:resource ref="MemberProfileProcessing/transformations/XQ_Req_AYLoyMemberInterestSynchronize"/>
                <con:param name="UpdateProfile">
                  <con:path>$Request/*</con:path>
                </con:param>
              </con:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="false">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f49</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./*</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$InterestRequest</con:xqueryText>
            </con2:expr>
          </con2:replace>
        </con:actions>
      </con:stage>
      <con:stage name="Synchronizing Interest" errorHandler="_onErrorHandler-7181538584930003524--5d62a2e8.143de568622.-7665" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
        <con:comment>To : AYLoyMemberInterest.SynchronizeInterest</con:comment>
        <con:context>
          <con4:userNsDecl prefix="ayr" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:userNsDecl prefix="loy" namespace="http://www.siebel.com/xml/LOYMember" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="ay" namespace="http://www.siebel.com/xml/AY%20LOY%20Member%20Int" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="asi" namespace="http://siebel.com/asi/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con5:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
          <con5:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
          <con1:variable name="Siebel" path="$Siebel">
            <con1:service operation="QueryPageInterest">
              <con1:business ref="MemberProfileProcessing/businessservices/AYLoyMemberInterest"/>
            </con1:service>
          </con1:variable>
        </con:context>
        <con:actions>
          <con2:wsCallout>
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5649269592524560700-93d243e.12a408450f2.-7f48</con3:id>
            <con2:service ref="MemberProfileProcessing/businessservices/AYLoyMemberInterest" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con2:operation>SynchronizeInterest</con2:operation>
            <con2:request>
              <con2:body wrapped="true">$body</con2:body>
              <con2:header/>
            </con2:request>
            <con2:response>
              <con2:body wrapped="true">body</con2:body>
              <con2:header/>
            </con2:response>
            <con2:requestTransform>
              <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7de6</con5:id>
                <con4:logLevel>info</con4:logLevel>
                <con4:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                </con4:expr>
                <con4:message>Logging SynchronizeInterest Request.</con4:message>
              </con4:log>
              <con2:delete varName="header">
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-2041694110763451302--16168512.131fb1161ef.-7f31</con4:id>
                <con2:location>
                  <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./*</con:xpathText>
                </con2:location>
              </con2:delete>
              <con2:assign varName="SiebelRequest">
                <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-7181538584930003524--5d62a2e8.143de568622.-7612</con6:id>
                <con2:expr>
                  <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">$body</con6:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:requestTransform>
            <con2:responseTransform>
              <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7de5</con5:id>
                <con4:logLevel>debug</con4:logLevel>
                <con4:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                </con4:expr>
                <con4:message>Logging InsertOrUpdateInterest Request To SynchronizeInterest Response.</con4:message>
              </con4:log>
              <con2:ifThenElse>
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3154782520543783281--5ac19df8.12b7ffb693c.-7fbd</con4:id>
                <con2:case>
                  <con2:condition>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn:local-name($body/*[1])='Fault'</con:xqueryText>
                  </con2:condition>
                  <con2:actions>
                    <con2:Error>
                      <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3154782520543783281--5ac19df8.12b7ffb693c.-7fbc</con4:id>
                      <con2:errCode>50</con2:errCode>
                      <con2:message>Error While SynchronizeInterest</con2:message>
                    </con2:Error>
                  </con2:actions>
                </con2:case>
              </con2:ifThenElse>
            </con2:responseTransform>
          </con2:wsCallout>
        </con:actions>
      </con:stage>
      <con:stage name="Portal To BVServlet" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
        <con:comment>Request Transformation for BVServlet</con:comment>
        <con:context>
          <con4:userNsDecl prefix="loy" namespace="http://www.siebel.com/xml/LOYMember" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:userNsDecl prefix="asi" namespace="http://siebel.com/asi/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:userNsDecl prefix="ayr" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5886473718478157716-1f1f0af9.12b4238040e.-7fe7</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:UserID/@PinNumber)!=""</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="UserID">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5886473718478157716-1f1f0af9.12b4238040e.-7fe3</con3:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:UniqueID/@ID</con:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:assign varName="PinNumber">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5886473718478157716-1f1f0af9.12b4238040e.-7fe2</con3:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">if(data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:UserID/@PinNumber)!="") then 
data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:UserID/@PinNumber)
else ""</con:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:ifThenElse>
                  <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-1009661500401532016--6b424ea8.1416f1ba539.-7528</con6:id>
                  <con2:case>
                    <con2:condition>
                      <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">fn:exists($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:LanguageSpoken) and fn:string-length(data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:LanguageSpoken/@Code)) gt 0</con6:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:assign varName="SiteLanguage">
                        <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-1009661500401532016--6b424ea8.1416f1ba539.-7526</con6:id>
                        <con2:expr>
                          <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">fn:upper-case(data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:Customer/com:LanguageSpoken/@Code))</con6:xqueryText>
                        </con2:expr>
                      </con2:assign>
                    </con2:actions>
                  </con2:case>
                  <con2:default>
                    <con2:assign varName="SiteLanguage">
                      <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-1009661500401532016--6b424ea8.1416f1ba539.-74ee</con6:id>
                      <con2:expr>
                        <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">"EN"</con6:xqueryText>
                      </con2:expr>
                    </con2:assign>
                  </con2:default>
                </con2:ifThenElse>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
        </con:actions>
      </con:stage>
    </con3:pipeline>
    <con5:pipeline type="request" name="Opt-out Gateway_request">
      <con5:stage name="Input logging">
        <con5:context>
          <con:varNsDecl namespace="http://com.finnair/profileProcessing/" prefix="prof"/>
          <con:varNsDecl namespace="http://com.finnair" prefix="com"/>
        </con5:context>
        <con5:actions>
          <con2:assign varName="startTimestamp" xmlns:con3="http://www.bea.com/wli/sb/pipeline/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
            <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-8747118900741786136--75660ad1.141926cd65e.-7ded</con6:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">current-dateTime()</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con3:log>
            <con:id>_ActionId-8747118900741786136--75660ad1.141926cd65e.-7dd0</con:id>
            <con3:logLevel>debug</con3:logLevel>
            <con3:expr>
              <con:xqueryText>$body</con:xqueryText>
            </con3:expr>
            <con3:message>Input Request Logging</con3:message>
          </con3:log>
        </con5:actions>
      </con5:stage>
      <con5:stage name="Check inbound parameter">
        <con5:context>
          <con:userNsDecl namespace="http://com.finnair/profileProcessing/" prefix="prof"/>
          <con:varNsDecl namespace="http://com.finnair" prefix="com"/>
        </con5:context>
        <con5:actions>
          <con2:validate>
            <con:id>_ActionId-575701662507721275--12b291c0.14196ea8a25.-782b</con:id>
            <con2:schema ref="PortalInterfaces/schema/OptOut"/>
            <con2:schemaElement xmlns:com="http://com.finnair">com:OptOutRQ</con2:schemaElement>
            <con2:varName>body</con2:varName>
            <con2:location>
              <con:xpathText>./prof:MarketingCommunicationsOptOut/com:OptOutRQ</con:xpathText>
            </con2:location>
          </con2:validate>
          <con2:assign varName="memberNumber">
            <con:id>_ActionId-575701662507721275--12b291c0.14196ea8a25.-7880</con:id>
            <con2:expr>
              <con:xqueryText>data($body/prof:MarketingCommunicationsOptOut/com:OptOutRQ/com:MemberNumber)</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con:id>_ActionId-575701662507721275--12b291c0.14196ea8a25.-7863</con:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText>fn:not(fn:string-length($memberNumber) gt 0)</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="errorCode">
                  <con:id>_ActionId-575701662507721275--12b291c0.14196ea8a25.-776a</con:id>
                  <con2:expr>
                    <con:xqueryText>"400"</con:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:assign varName="errorMessage">
                  <con:id>_ActionId-575701662507721275--12b291c0.14196ea8a25.-774d</con:id>
                  <con2:expr>
                    <con:xqueryText>"Member number is mandatory"</con:xqueryText>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:assign varName="attributeKey">
            <con:id>_ActionId-575701662507721275--12b291c0.14196ea8a25.-7c4b</con:id>
            <con2:expr>
              <con:xqueryText>data($body/prof:MarketingCommunicationsOptOut/com:OptOutRQ/com:AttributeKey)</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con:id>_ActionId-575701662507721275--12b291c0.14196ea8a25.-7c2e</con:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText>$attributeKey != "sms" and $attributeKey != "pp" and $attributeKey != "wo" and $attributeKey != "ae" and $attributeKey != "af"</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="errorCode">
                  <con:id>_ActionId-575701662507721275--12b291c0.14196ea8a25.-7bf6</con:id>
                  <con2:expr>
                    <con:xqueryText>"400"</con:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:assign varName="errorMessage">
                  <con:id>_ActionId-575701662507721275--12b291c0.14196ea8a25.-7bd9</con:id>
                  <con2:expr>
                    <con:xqueryText>"Unknown key"</con:xqueryText>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
        </con5:actions>
      </con5:stage>
      <con5:stage name="Get member details">
        <con5:context>
          <con:userNsDecl namespace="http://siebel.com/asi/" prefix="asi"/>
          <con:varNsDecl namespace="http://com.finnair/profileProcessing/" prefix="prof"/>
          <con:varNsDecl namespace="http://com.finnair" prefix="com"/>
          <con:varNsDecl namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal" prefix="ayr"/>
          <con1:variable name="queryFullExample" path="$queryFullExample" asChild="false">
            <con1:wsdl ref="SiebelInterfaces/wsdl/AYLoyMemberPortal" element="ayr:ListOfAyresMemberInformationLongPortal" xmlns:ayr="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal"/>
          </con1:variable>
        </con5:context>
        <con5:actions>
          <con2:ifThenElse>
            <con:id>_ActionId-575701662507721275--12b291c0.14196ea8a25.-7ba1</con:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText>fn:not(fn:exists($errorCode))</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:wsCallout>
                  <con:id>_ActionId-575701662507721275--12b291c0.14196ea8a25.-7b97</con:id>
                  <con2:service xsi:type="ref:BusinessServiceRef" ref="MemberProfileProcessing/businessservices/AYLoyMemberPortal" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con2:operation>QuerybyExampleFullMember</con2:operation>
                  <con2:request>
                    <con2:body wrapped="true">$queryByFullMemberRQ</con2:body>
                  </con2:request>
                  <con2:response>
                    <con2:body wrapped="true">queryByFullMemberRS</con2:body>
                  </con2:response>
                  <con2:requestTransform>
                    <con2:assign varName="queryByFullMemberRQ">
                      <con:id>_ActionId-7869801579869266419--6be39981.1419c604389.-7bf9</con:id>
                      <con2:expr>
                        <con:xqueryText>$body</con:xqueryText>
                      </con2:expr>
                    </con2:assign>
                    <con2:replace varName="queryByFullMemberRQ">
                      <con:id>_ActionId-7869801579869266419--6be39981.1419c604389.-7c31</con:id>
                      <con2:location>
                        <con:xpathText>./*</con:xpathText>
                      </con2:location>
                      <con2:expr>
                        <con:xqueryTransform>
                          <con:resource ref="MemberProfileProcessing/transformations/XQ_Req_UpdateProfile"/>
                          <con:param name="memberNumber">
                            <con:path>$memberNumber</con:path>
                          </con:param>
                        </con:xqueryTransform>
                      </con2:expr>
                    </con2:replace>
                  </con2:requestTransform>
                  <con2:responseTransform>
                    <con2:ifThenElse>
                      <con:id>_ActionId-575701662507721275--12b291c0.14196ea8a25.-7b9a</con:id>
                      <con2:case>
                        <con2:condition>
                          <con:xqueryText>fn:not(fn:exists($queryByFullMemberRS/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember)) or fn:local-name($queryByFullMemberRS/*[1]) = 'Fault'</con:xqueryText>
                        </con2:condition>
                        <con2:actions>
                          <con2:assign varName="errorCode">
                            <con:id>_ActionId-575701662507721275--12b291c0.14196ea8a25.-7b99</con:id>
                            <con2:expr>
                              <con:xqueryText>"60"</con:xqueryText>
                            </con2:expr>
                          </con2:assign>
                          <con2:assign varName="errorMessage">
                            <con:id>_ActionId-575701662507721275--12b291c0.14196ea8a25.-7b98</con:id>
                            <con2:expr>
                              <con:xqueryText>"Invalid Member ID"</con:xqueryText>
                            </con2:expr>
                          </con2:assign>
                        </con2:actions>
                      </con2:case>
                    </con2:ifThenElse>
                    <con2:assign varName="synchronizeRQ">
                      <con:id>_ActionId-4456165718991166648--1fa84d2.1419cc24872.-7f76</con:id>
                      <con2:expr>
                        <con:xqueryText>$queryByFullMemberRS</con:xqueryText>
                      </con2:expr>
                    </con2:assign>
                    <con2:rename varName="synchronizeRQ">
                      <con:id>_ActionId-3742977784386622753--4f8e5ee0.141a1c90a34.-7f5b</con:id>
                      <con2:location>
                        <con:xpathText>./asi:QuerybyExampleFullMemberResponse</con:xpathText>
                      </con2:location>
                      <con2:localname>Synchronize</con2:localname>
                    </con2:rename>
                  </con2:responseTransform>
                </con2:wsCallout>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
        </con5:actions>
      </con5:stage>
      <con5:stage name="Update marketing flag" errorHandler="_onErrorHandler-7869801579869266419--6be39981.1419c604389.-7d62">
        <con5:context>
          <con:userNsDecl namespace="http://siebel.com/asi/" prefix="asi"/>
          <con:userNsDecl namespace="http://com.finnair" prefix="com"/>
          <con:userNsDecl namespace="http://com.finnair/profileProcessing" prefix="prof"/>
          <con:varNsDecl namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal" prefix="ayr1"/>
          <con1:variable name="listOfAyresMemberInformationLongPortal" path="$listOfAyresMemberInformationLongPortal" asChild="false">
            <con1:wsdl ref="SiebelInterfaces/wsdl/AYLoyMemberPortal" element="ayr:ListOfAyresMemberInformationLongPortal" xmlns:ayr="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal"/>
          </con1:variable>
        </con5:context>
        <con5:actions>
          <con2:ifThenElse>
            <con:id>_ActionId-575701662507721275--12b291c0.14196ea8a25.-7b29</con:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText>fn:not(fn:exists($errorCode))</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:ifThenElse>
                  <con:id>_ActionId-575701662507721275--12b291c0.14196ea8a25.-79fe</con:id>
                  <con2:case>
                    <con2:condition>
                      <con:xqueryText>$attributeKey = "sms"</con:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:replace contents-only="true" varName="synchronizeRQ">
                        <con:id>_ActionId-575701662507721275--12b291c0.14196ea8a25.-79c6</con:id>
                        <con2:location>
                          <con:xpathText>./asi:Synchronize/SiebelMessage/ayr1:ListOfAyresMemberInformationLongPortal/ayr1:LoyMember/ayr1:ListOfContact/ayr1:Contact/ayr1:SuppressSMSPromos</con:xpathText>
                        </con2:location>
                        <con2:expr>
                          <con:xqueryText>"Y"</con:xqueryText>
                        </con2:expr>
                      </con2:replace>
                    </con2:actions>
                  </con2:case>
                </con2:ifThenElse>
                <con2:ifThenElse>
                  <con:id>_ActionId-7869801579869266419--6be39981.1419c604389.-7fae</con:id>
                  <con2:case>
                    <con2:condition>
                      <con:xqueryText>$attributeKey = "pp"</con:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:replace contents-only="true" varName="synchronizeRQ">
                        <con:id>_ActionId-7869801579869266419--6be39981.1419c604389.-7f3f</con:id>
                        <con2:location>
                          <con:xpathText>./asi:Synchronize/SiebelMessage/ayr1:ListOfAyresMemberInformationLongPortal/ayr1:LoyMember/ayr1:ReceivePartnerPromotionFlag</con:xpathText>
                        </con2:location>
                        <con2:expr>
                          <con:xqueryText>"N"</con:xqueryText>
                        </con2:expr>
                      </con2:replace>
                    </con2:actions>
                  </con2:case>
                </con2:ifThenElse>
                <con2:ifThenElse>
                  <con:id>_ActionId-7869801579869266419--6be39981.1419c604389.-7f07</con:id>
                  <con2:case>
                    <con2:condition>
                      <con:xqueryText>$attributeKey = "wo"</con:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:replace contents-only="true" varName="synchronizeRQ">
                        <con:id>_ActionId-7869801579869266419--6be39981.1419c604389.-7e98</con:id>
                        <con2:location>
                          <con:xpathText>./asi:Synchronize/SiebelMessage/ayr1:ListOfAyresMemberInformationLongPortal/ayr1:LoyMember/ayr1:ListOfContact/ayr1:Contact/ayr1:SuppresseMailWeeklyOffers</con:xpathText>
                        </con2:location>
                        <con2:expr>
                          <con:xqueryText>"Y"</con:xqueryText>
                        </con2:expr>
                      </con2:replace>
                    </con2:actions>
                  </con2:case>
                </con2:ifThenElse>
                <con2:ifThenElse>
                  <con:id>_ActionId-7869801579869266419--6be39981.1419c604389.-7e60</con:id>
                  <con2:case>
                    <con2:condition>
                      <con:xqueryText>$attributeKey = "ae"</con:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:replace contents-only="true" varName="synchronizeRQ">
                        <con:id>_ActionId-7869801579869266419--6be39981.1419c604389.-7e28</con:id>
                        <con2:location>
                          <con:xpathText>./asi:Synchronize/SiebelMessage/ayr1:ListOfAyresMemberInformationLongPortal/ayr1:LoyMember/ayr1:ListOfContact/ayr1:Contact/ayr1:SuppressAllEmails</con:xpathText>
                        </con2:location>
                        <con2:expr>
                          <con:xqueryText>"Y"</con:xqueryText>
                        </con2:expr>
                      </con2:replace>
                    </con2:actions>
                  </con2:case>
                </con2:ifThenElse>
                <con2:ifThenElse>
                  <con:id>_ActionId-7869801579869266419--6be39981.1419c604389.-7df0</con:id>
                  <con2:case>
                    <con2:condition>
                      <con:xqueryText>$attributeKey = "af"</con:xqueryText>
                    </con2:condition>
                    <con2:actions>
                      <con2:replace varName="synchronizeRQ" contents-only="true">
                        <con:id>_ActionId-7869801579869266419--6be39981.1419c604389.-7db8</con:id>
                        <con2:location>
                          <con:xpathText>./asi:Synchronize/SiebelMessage/ayr1:ListOfAyresMemberInformationLongPortal/ayr1:LoyMember/ayr1:ListOfContact/ayr1:Contact/ayr1:SuppressAllFaxes</con:xpathText>
                        </con2:location>
                        <con2:expr>
                          <con:xqueryText>"Y"</con:xqueryText>
                        </con2:expr>
                      </con2:replace>
                    </con2:actions>
                  </con2:case>
                </con2:ifThenElse>
                <con2:wsCallout>
                  <con:id>_ActionId-7869801579869266419--6be39981.1419c604389.-7d63</con:id>
                  <con2:service xsi:type="ref:BusinessServiceRef" ref="MemberProfileProcessing/businessservices/AYLoyMemberPortal" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                  <con2:operation>Synchronize</con2:operation>
                  <con2:request>
                    <con2:body wrapped="true">$synchronizeRQ</con2:body>
                  </con2:request>
                  <con2:response>
                    <con2:body wrapped="true">synchronizeRS</con2:body>
                  </con2:response>
                  <con2:requestTransform/>
                  <con2:responseTransform/>
                </con2:wsCallout>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
        </con5:actions>
      </con5:stage>
    </con5:pipeline>
    <con3:pipeline name="_onErrorHandler-8963622514322013752-7c9f2332.12a45f93d1a.-7fe5" type="error" xmlns:con3="http://www.bea.com/wli/sb/pipeline/config">
      <con1:stage name="Generic Error Handler" xmlns:con1="http://www.bea.com/wli/sb/pipeline/config">
        <con1:comment>MemberProfileProcessing Error Handler will handle all BEA and Siebel errors.</con1:comment>
        <con3:context xmlns:con4="http://www.bea.com/wli/sb/pipeline/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con2="http://www.bea.com/wli/sb/typesystem/config">
          <con:userNsDecl namespace="http://www.siebel.com/ws/fault" prefix="siebelf"/>
          <con:varNsDecl prefix="get" namespace="http://com.finnair/GetPointBalance"/>
          <con:varNsDecl prefix="poin" namespace="http://com.finnair/PointsInfoRetrieve/"/>
          <con:varNsDecl prefix="mem" namespace="http://com.finnair/MemberProfileRetrieve/"/>
          <con:varNsDecl prefix="com" namespace="http://com.finnair"/>
          <con:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/"/>
        </con3:context>
        <con3:actions xmlns:con4="http://www.bea.com/wli/sb/pipeline/config" xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con2="http://www.bea.com/wli/sb/typesystem/config">
          <con5:log xmlns:con5="http://www.bea.com/wli/sb/stages/logging/config">
            <con:id>_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7dde</con:id>
            <con5:logLevel>warning</con5:logLevel>
            <con5:expr>
              <con:xqueryText><![CDATA[<gerror><gfault>{$fault}</gfault><gbody>{$body}</gbody></gerror>]]></con:xqueryText>
            </con5:expr>
            <con5:message>Logging fault in MemberProfileProcessing.proxy</con5:message>
          </con5:log>
          <con5:ifThenElse xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config">
            <con:id>_ActionId-3502553873978082500--7a0d0b2c.131f4dc8dfa.-7f23</con:id>
            <con5:case>
              <con5:condition>
                <con:xqueryText>$body/FPApplRS/Error/@value!=""</con:xqueryText>
              </con5:condition>
              <con5:actions>
                <con5:assign varName="NewStageText">
                  <con:id>_ActionId-3502553873978082500--7a0d0b2c.131f4dc8dfa.-7f22</con:id>
                  <con5:expr>
                    <con:xqueryText>concat('OnlineDB write failed: ',$body/FPApplRS/Error/@value,'-',$body/FPApplRS/Error/@description)</con:xqueryText>
                  </con5:expr>
                </con5:assign>
              </con5:actions>
            </con5:case>
            <con5:default>
              <con5:assign varName="stageText">
                <con:id>_ActionId-3502553873978082500--7a0d0b2c.131f4dc8dfa.-7f21</con:id>
                <con5:expr>
                  <con:xqueryText>if ($fault/ctx:location/ctx:stage) then 

$fault/ctx:location/ctx:stage/text()

else 

$fault/ctx:location/ctx:node/text()</con:xqueryText>
                </con5:expr>
              </con5:assign>
              <con5:assign varName="stageDVM">
                <con:id>_ActionId-3502553873978082500--7a0d0b2c.131f4dc8dfa.-7f20</con:id>
                <con5:expr>
                  <con:xqueryText><![CDATA[<tns:dvm name="country-dvm" xmlns:tns="http://xmlns.oracle.com/dvm" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
  <tns:description>StageText DVM</tns:description>
  <tns:columns>
    <tns:column name="Input"/>
    <tns:column name="Output"/>
  </tns:columns>
  <tns:rows>

<tns:row>
	<tns:cell>Request Validation</tns:cell>
	<tns:cell>Message Does not pass Validation</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Email Validation</tns:cell>
	<tns:cell>Invalid email</tns:cell>
</tns:row>

<tns:row>
	<tns:cell>PinCode Validation</tns:cell>
	<tns:cell>Pincode doesn't pass validtion rules</tns:cell>
</tns:row>

<tns:row>
	<tns:cell>Portal To AYRESNewMember I</tns:cell>
	<tns:cell>Create failed in ReturnBasicMembData</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Creating Member Number</tns:cell>
	<tns:cell>Create failed in ReturnBasicMembData</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Portal To AYRESNewMember II</tns:cell>
	<tns:cell>Create failed in InsertNewMember</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Inserting New Member</tns:cell>
	<tns:cell>Create failed in InsertNewMember</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Portal To AYLoyMemberPortal</tns:cell>
	<tns:cell>Interests update failed</tns:cell>
</tns:row>
v
<tns:row>
	<tns:cell>Retrieving Full Details of MemberID</tns:cell>
	<tns:cell>Interests update failed</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Portal To Synchronise I</tns:cell>
	<tns:cell>Synchronize failed</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Portal To Synchronise II</tns:cell>
	<tns:cell>Synchronize failed</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Portal To Synchronise III</tns:cell>
	<tns:cell>Synchronize failed</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Portal To Synchronise IV</tns:cell>
	<tns:cell>Synchronize failed</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Synchronizing</tns:cell>
	<tns:cell>Synchronize failed</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Portal To AYLoyMemberInterest</tns:cell>
	<tns:cell>Interests create failed</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Inserting Interests</tns:cell>
	<tns:cell>Interests create failed</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Inserting or Updating Interests </tns:cell>
	<tns:cell>Failed to update interests</tns:cell>
</tns:row>

<tns:row>
	<tns:cell>Portal To FPlusApp Servlet</tns:cell>
	<tns:cell>OnlineDB write failed</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Online DB</tns:cell>
	<tns:cell>OnlineDB write failed</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Portal To BVServlet</tns:cell>
	<tns:cell>Failed to update password</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>BV Servlet</tns:cell>
	<tns:cell>Failed to update password</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Input Request Logging</tns:cell>
	<tns:cell>Message Does not pass Validation</tns:cell>
</tns:row>
  </tns:rows>
</tns:dvm>]]></con:xqueryText>
                </con5:expr>
              </con5:assign>
              <con5:assign varName="NewStageText">
                <con:id>_ActionId-3502553873978082500--7a0d0b2c.131f4dc8dfa.-7f1f</con:id>
                <con5:expr>
                  <con:xqueryTransform>
                    <con:resource ref="MemberProfileProcessing/transformations/InsertDVM"/>
                    <con:param name="sourceValue">
                      <con:path>$stageText</con:path>
                    </con:param>
                    <con:param name="sourceColumnName">
                      <con:path>"Input"</con:path>
                    </con:param>
                    <con:param name="targetColumnName">
                      <con:path>"Output"</con:path>
                    </con:param>
                    <con:param name="defaultValue">
                      <con:path>"11:UNABLE TO PROCESS"</con:path>
                    </con:param>
                    <con:param name="dvmTable">
                      <con:path>$stageDVM</con:path>
                    </con:param>
                  </con:xqueryTransform>
                </con5:expr>
              </con5:assign>
            </con5:default>
          </con5:ifThenElse>
          <con5:ifThenElse xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config">
            <con:id>_ActionId-3525837289851415380-5b4e4341.12a4b35ae38.-7f24</con:id>
            <con5:case>
              <con5:condition>
                <con:xqueryText>fn:local-name($body/*[1])='Fault'</con:xqueryText>
              </con5:condition>
              <con5:actions>
                <con5:ifThenElse>
                  <con:id>_ActionId-2327502807177402847--7e689091.12f8baca7df.-7fc7</con:id>
                  <con5:case>
                    <con5:condition>
                      <con:xqueryConditionExpr>
                        <con:unaryExpr>
                          <con:path>$body/soap-env:Fault/detail/siebelf:siebdetail</con:path>
                        </con:unaryExpr>
                      </con:xqueryConditionExpr>
                    </con5:condition>
                    <con5:actions>
                      <con5:assign varName="FaultCodeRequest">
                        <con:id>_ActionId-2327502807177402847--7e689091.12f8baca7df.-7fc6</con:id>
                        <con5:expr>
                          <con:xqueryText>if($body/soap-env:Fault/detail/siebelf:siebdetail/siebelf:errorstack/siebelf:error/siebelf:errorsymbol/text())
then
$body/soap-env:Fault/detail/siebelf:siebdetail/siebelf:errorstack/siebelf:error/siebelf:errorsymbol/text()
else "11:UNABLE TO PROCESS"</con:xqueryText>
                        </con5:expr>
                      </con5:assign>
                    </con5:actions>
                  </con5:case>
                  <con5:default>
                    <con5:assign varName="FaultCodeRequest">
                      <con:id>_ActionId-2327502807177402847--7e689091.12f8baca7df.-7fc4</con:id>
                      <con5:expr>
                        <con:xqueryText>if($body/soap-env:Fault/detail/siebelf:errorstack/siebelf:error/siebelf:errorsymbol/text())
then
$body/soap-env:Fault/detail/siebelf:errorstack/siebelf:error/siebelf:errorsymbol/text()
else "11:UNABLE TO PROCESS"</con:xqueryText>
                      </con5:expr>
                    </con5:assign>
                  </con5:default>
                </con5:ifThenElse>
                <con1:assign varName="dvmTable" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
                  <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-3525837289851415380-5b4e4341.12a4b35ae38.-7f22</con6:id>
                  <con1:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config"><![CDATA[<tns:dvm name="country-dvm" xmlns:tns="http://xmlns.oracle.com/dvm" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
  <tns:description>ErrorDVM</tns:description>
  <tns:columns>
    <tns:column name="MW"/>
    <tns:column name="Custom"/>
  </tns:columns>
  <tns:rows>

<tns:row>
	<tns:cell>IDS_EAI_ERR_COMMON_MAX_FIELD_LENGTH_EXCEEDED</tns:cell>
	<tns:cell>DBD:INVALID ACCOUNT NUMBER</tns:cell>            

</tns:row>

<tns:row>
	<tns:cell>IDS_ERR_EAI_SA_INSERT_MATCH_FOUND</tns:cell>
	<tns:cell>12.AJB:PROFILE ALREADY EXIST</tns:cell>            

</tns:row>

  </tns:rows>
</tns:dvm>]]></con:xqueryText>
                  </con1:expr>
                </con1:assign>
                <con5:assign varName="FaultCodeResponse" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
                  <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-3525837289851415380-5b4e4341.12a4b35ae38.-7f21</con6:id>
                  <con5:expr>
                    <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                      <con:resource ref="Common/transformations/DVMFunction"/>
                      <con:param name="sourceValue">
                        <con:path>$FaultCodeRequest</con:path>
                      </con:param>
                      <con:param name="sourceColumnName">
                        <con:path>"MW"</con:path>
                      </con:param>
                      <con:param name="targetColumnName">
                        <con:path>"Custom"</con:path>
                      </con:param>
                      <con:param name="defaultValue">
                        <con:path>"11:UNABLE TO PROCESS"</con:path>
                      </con:param>
                      <con:param name="dvmTable">
                        <con:path>$dvmTable</con:path>
                      </con:param>
                    </con:xqueryTransform>
                  </con5:expr>
                </con5:assign>
              </con5:actions>
            </con5:case>
            <con5:default>
              <con5:assign varName="FaultCodeRequest">
                <con:id>_ActionId-3525837289851415380-5b4e4341.12a4b35ae38.-7f20</con:id>
                <con5:expr>
                  <con:xqueryText>$fault/ctx:errorCode/text()</con:xqueryText>
                </con5:expr>
              </con5:assign>
              <con1:wsCallout xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                <con:id>_ActionId-3525837289851415380-5b4e4341.12a4b35ae38.-7f1f</con:id>
                <con1:service ref="Common/proxyservices/CommonErrorHandler" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                <con1:request>
                  <con1:payload wrapped="false">$FaultCodeRequest</con1:payload>
                </con1:request>
                <con1:response>
                  <con1:payload wrapped="false">FaultCodeResponse</con1:payload>
                </con1:response>
                <con1:requestTransform/>
                <con1:responseTransform/>
              </con1:wsCallout>
            </con5:default>
          </con5:ifThenElse>
          <con5:assign varName="errorCode" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config">
            <con:id>_ActionId-3525837289851415380-5b4e4341.12a4b35ae38.-7f1e</con:id>
            <con5:expr>
              <con:xqueryText>fn:substring-before($FaultCodeResponse,":")</con:xqueryText>
            </con5:expr>
          </con5:assign>
          <con5:assign varName="PinNumber" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config">
            <con:id>_ActionId-946966958583918762-501d949b.12faf1c0076.-7f92</con:id>
            <con5:expr>
              <con:xqueryText>if($operation= "InsertNewMember") then data($body/prof:InsertNewMember/com:AMA_ProfileCreateRQ/com:Profile/com:UserID/@PinNumber)
elseif($operation= "UpdateProfile") then data($body/prof:UpdateProfile/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:UserID/@PinNumber)
else ""</con:xqueryText>
            </con5:expr>
          </con5:assign>
          <con5:assign varName="errorDescription" xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config">
            <con:id>_ActionId-3525837289851415380-5b4e4341.12a4b35ae38.-7f1d</con:id>
            <con5:expr>
              <con:xqueryText>if (data($errorCode)="35007") then
fn:replace(fn:substring-after($FaultCodeResponse,":"),"/",$PinNumber)
else
fn:substring-after($FaultCodeResponse,":")</con:xqueryText>
            </con5:expr>
          </con5:assign>
          <con5:ifThenElse xmlns:con5="http://www.bea.com/wli/sb/stages/transform/config">
            <con:id>_ActionId-4421182730978937819-49af23e6.12ae564c279.-7fa4</con:id>
            <con5:case>
              <con5:condition>
                <con:xqueryConditionExpr>
                  <con:compExpr operator="=">
                    <con:leftPath>$operation</con:leftPath>
                    <con:rightPath>"InsertNewMember"</con:rightPath>
                  </con:compExpr>
                </con:xqueryConditionExpr>
              </con5:condition>
              <con5:actions>
                <con5:ifThenElse>
                  <con:id>_ActionId-1339639997614389434--61c789f9.135a455d969.-7fea</con:id>
                  <con5:case>
                    <con5:condition>
                      <con:xqueryText>$body/FPApplRS/Error/@value!=""</con:xqueryText>
                    </con5:condition>
                    <con5:actions>
                      <con5:replace varName="body" contents-only="false">
                        <con:id>_ActionId-1339639997614389434--61c789f9.135a455d969.-7fe9</con:id>
                        <con5:location>
                          <con:xpathText>./*</con:xpathText>
                        </con5:location>
                        <con5:expr>
                          <con:xqueryTransform>
                            <con:resource ref="MemberProfileProcessing/transformations/XQ_Res_InsertNewMember_FPlus"/>
                            <con:param name="MemberNumber">
                              <con:path>$MemberNumber</con:path>
                            </con:param>
                          </con:xqueryTransform>
                        </con5:expr>
                      </con5:replace>
                    </con5:actions>
                  </con5:case>
                  <con5:default>
                    <con5:replace varName="body" contents-only="true">
                      <con:id>_ActionId-1339639997614389434--61c789f9.135a455d969.-7fe8</con:id>
                      <con5:location>
                        <con:xpathText>.</con:xpathText>
                      </con5:location>
                      <con5:expr>
                        <con:xqueryTransform>
                          <con:resource ref="MemberProfileProcessing/transformations/XQ_Res_InsertNewMemberFault"/>
                          <con:param name="ErrorDescription">
                            <con:path>$errorDescription</con:path>
                          </con:param>
                          <con:param name="StageText">
                            <con:path>$NewStageText</con:path>
                          </con:param>
                          <con:param name="ErrorCode">
                            <con:path>$errorCode</con:path>
                          </con:param>
                        </con:xqueryTransform>
                      </con5:expr>
                    </con5:replace>
                  </con5:default>
                </con5:ifThenElse>
              </con5:actions>
            </con5:case>
            <con5:case>
              <con5:condition>
                <con:xqueryText>$operation="LinkMemberToPromotion"</con:xqueryText>
              </con5:condition>
              <con5:actions>
                <con5:replace varName="body" contents-only="false">
                  <con:id>_ActionId-2873641054946293496-680bf8b5.12b28ddc85a.-7fba</con:id>
                  <con5:location>
                    <con:xpathText>./*</con:xpathText>
                  </con5:location>
                  <con5:expr>
                    <con:xqueryTransform>
                      <con:resource ref="MemberProfileProcessing/transformations/XQ_Res_LinkMemberToPromotionFault"/>
                      <con:param name="ErrorDescription">
                        <con:path>$errorDescription</con:path>
                      </con:param>
                      <con:param name="ErrorCode">
                        <con:path>$errorCode</con:path>
                      </con:param>
                    </con:xqueryTransform>
                  </con5:expr>
                </con5:replace>
              </con5:actions>
            </con5:case>
            <con5:case>
              <con5:condition>
                <con:xqueryText>$operation="UpdateProfile"</con:xqueryText>
              </con5:condition>
              <con5:actions>
                <con5:replace varName="body" contents-only="false">
                  <con:id>_ActionId-245067393091034326-1ca484fa.12b37bbabac.-7ef8</con:id>
                  <con5:location>
                    <con:xpathText>.</con:xpathText>
                  </con5:location>
                  <con5:expr>
                    <con:xqueryTransform>
                      <con:resource ref="MemberProfileProcessing/transformations/XQ_Res_UpdateFault"/>
                      <con:param name="ErrorDescription">
                        <con:path>$errorDescription</con:path>
                      </con:param>
                      <con:param name="StageText">
                        <con:path>$NewStageText</con:path>
                      </con:param>
                      <con:param name="ErrorCode">
                        <con:path>$errorCode</con:path>
                      </con:param>
                    </con:xqueryTransform>
                  </con5:expr>
                </con5:replace>
              </con5:actions>
            </con5:case>
            <con5:default>
              <con5:replace varName="body" contents-only="false">
                <con:id>_ActionId-4421182730978937819-49af23e6.12ae564c279.-7fa2</con:id>
                <con5:location>
                  <con:xpathText>./*</con:xpathText>
                </con5:location>
                <con5:expr>
                  <con:xqueryText>"No Operation Invoked"</con:xqueryText>
                </con5:expr>
              </con5:replace>
            </con5:default>
          </con5:ifThenElse>
          <con5:alert xmlns:con5="http://www.bea.com/wli/sb/stages/alert/config">
            <con:id>_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7fd6</con:id>
            <con5:destination ref="Common/alerts/DefaultAlerts"/>
            <con5:description>Generic Error Handler alert</con5:description>
            <con5:severity>warning</con5:severity>
            <con5:payload>
              <con:xqueryText>$body</con:xqueryText>
            </con5:payload>
          </con5:alert>
          <con2:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/alert/config" xmlns:con1="http://www.bea.com/wli/sb/typesystem/config">
            <con:comment>Setting response version to support AMA 12.2 (FCP-1096)</con:comment>
            <con:id>_ActionId-1420454770313012735-128b09d4.141dbc6e5f4.-7dcf</con:id>
            <con2:location>
              <con:xpathText>//@Version[1]</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText>$Version</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con5:reply isError="true" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con5="http://www.bea.com/wli/sb/stages/config">
            <con5:id>_ActionId-3525837289851415380-5b4e4341.12a4b35ae38.-7f1b</con5:id>
          </con5:reply>
        </con3:actions>
      </con1:stage>
    </con3:pipeline>
    <con3:pipeline name="InsertNewMember Gateway_request" type="request" xmlns:con3="http://www.bea.com/wli/sb/pipeline/config">
      <con3:stage name="Input Request Logging">
        <con3:comment>This will log the input service request.</con3:comment>
        <con3:context>
          <con:varNsDecl prefix="com" namespace="http://com.finnair"/>
          <con:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/"/>
        </con3:context>
        <con3:actions>
          <con2:assign varName="startTimestamp">
            <con:id>_ActionId-4449486212243904989-7fb4642e.136100f27e0.-7fe5</con:id>
            <con2:expr>
              <con:xqueryText>current-dateTime()</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
            <con:id>_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7eb7</con:id>
            <con4:logLevel>info</con4:logLevel>
            <con4:expr>
              <con:xqueryText>$body</con:xqueryText>
            </con4:expr>
            <con4:message>Input Request Logging</con4:message>
          </con4:log>
          <con2:ifThenElse>
            <con:id>_ActionId-6148932581009058993-a3f6162.12b1df96aab.-7f6a</con:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText>data($body/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/@ProfileType) != "1"</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:Error>
                  <con:id>_ActionId-6148932581009058993-a3f6162.12b1df96aab.-7f69</con:id>
                  <con2:errCode>90</con2:errCode>
                  <con2:message>Invalid Profile Type</con2:message>
                </con2:Error>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
        </con3:actions>
      </con3:stage>
      <con3:stage name="Request Validation">
        <con3:comment>This will validate the service input request</con3:comment>
        <con3:context>
          <con:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/"/>
          <con:varNsDecl prefix="com" namespace="http://com.finnair"/>
        </con3:context>
        <con3:actions>
          <con2:validate>
            <con:id>_ActionId-8963622514322013752-7c9f2332.12a45f93d1a.-7f6b</con:id>
            <con2:schema ref="PortalInterfaces/schema/AMA_ProfileCreateRQ"/>
            <con2:schemaElement xmlns:com="http://com.finnair">com:AMA_ProfileCreateRQ</con2:schemaElement>
            <con2:varName>body</con2:varName>
            <con2:location>
              <con:xpathText>.//com:AMA_ProfileCreateRQ</con:xpathText>
            </con2:location>
            <con2:resultVarName/>
          </con2:validate>
        </con3:actions>
      </con3:stage>
      <con3:stage name="Email Validation">
        <con3:comment/>
        <con3:context>
          <con:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/"/>
          <con:varNsDecl prefix="com" namespace="http://com.finnair"/>
        </con3:context>
        <con3:actions>
          <con2:assign varName="Email">
            <con:id>_ActionId-3502553873978082500--7a0d0b2c.131f4dc8dfa.-7f29</con:id>
            <con2:expr>
              <con:xqueryText>$body/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Email/text()</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con:id>_ActionId-3502553873978082500--7a0d0b2c.131f4dc8dfa.-7f28</con:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText>matches($Email,'.*.+@.{2,}\..{2,}')</con:xqueryText>
              </con2:condition>
              <con2:actions/>
            </con2:case>
            <con2:case>
              <con2:condition>
                <con:xqueryText>fn:contains($Email, "ä") or fn:contains($Email, "ö") or fn:contains($Email, "å") or fn:contains($Email, "á") 
or fn:contains($Email, "ü")</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:Error>
                  <con:id>_ActionId-6331640136266735042-27d4ae6f.14ecf7412e4.-7f5d</con:id>
                  <con2:errCode>11</con2:errCode>
                  <con2:message>Invalid Email. Some characteres are not allowed.</con2:message>
                </con2:Error>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:Error>
                <con:id>_ActionId-3502553873978082500--7a0d0b2c.131f4dc8dfa.-7f27</con:id>
                <con2:errCode>11</con2:errCode>
                <con2:message>Invalid email</con2:message>
              </con2:Error>
            </con2:default>
          </con2:ifThenElse>
        </con3:actions>
      </con3:stage>
      <con3:stage name="PinCode Validation">
        <con3:comment/>
        <con3:context>
          <con:userNsDecl prefix="functx" namespace="http://www.functx.com"/>
          <con:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/"/>
          <con:varNsDecl prefix="com" namespace="http://com.finnair"/>
        </con3:context>
        <con3:actions>
          <con2:ifThenElse>
            <con:id>_ActionId-2327502807177402847--7e689091.12f8baca7df.-7fdd</con:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText>$body/prof:InsertNewMember/com:AMA_ProfileCreateRQ/com:Profile/com:UserID/@PinNumber !=""</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="PinCode">
                  <con:id>_ActionId-2327502807177402847--7e689091.12f8baca7df.-7fdc</con:id>
                  <con2:expr>
                    <con:xqueryText>$body/prof:InsertNewMember/com:AMA_ProfileCreateRQ/com:Profile/com:UserID/@PinNumber</con:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:assign varName="NormalizePinCode">
                  <con:id>_ActionId-2327502807177402847--7e689091.12f8baca7df.-7fda</con:id>
                  <con2:expr>
                    <con:xqueryText>data(fn:normalize-space($PinCode))</con:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:assign varName="CharacterCount">
                  <con:id>_ActionId-2327502807177402847--7e689091.12f8baca7df.-7fd9</con:id>
                  <con2:expr>
                    <con:xqueryText>fn:count(fn:tokenize($NormalizePinCode,fn:substring($NormalizePinCode,1,1))) - 1</con:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:assign varName="ValidationStatus">
                  <con:id>_ActionId-2327502807177402847--7e689091.12f8baca7df.-7fd8</con:id>
                  <con2:expr>
                    <con:xqueryText>if(fn:contains($PinCode,data($body/prof:InsertNewMember/com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:PersonName/com:GivenName)) or fn:contains($PinCode,data($body/prof:InsertNewMember/com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:PersonName/com:Surname)) or (fn:string-length($PinCode)&lt;=5) or fn:contains($PinCode," ") or (fn:string-length($NormalizePinCode)=$CharacterCount cast as xs:integer))then "No"
else "Yes"</con:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:ifThenElse>
                  <con:id>_ActionId-2327502807177402847--7e689091.12f8baca7df.-7fd7</con:id>
                  <con2:case>
                    <con2:condition>
                      <con:xqueryText>$ValidationStatus="Yes"</con:xqueryText>
                    </con2:condition>
                    <con2:actions/>
                  </con2:case>
                  <con2:default>
                    <con2:Error>
                      <con:id>_ActionId-2327502807177402847--7e689091.12f8baca7df.-7fd6</con:id>
                      <con2:errCode>21</con2:errCode>
                      <con2:message>Create failed in PinCode validation</con2:message>
                    </con2:Error>
                  </con2:default>
                </con2:ifThenElse>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
        </con3:actions>
      </con3:stage>
      <con:stage name="Portal To AYRESNewMember I" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
        <con:comment>Request Transformation for AYRESNewMember.ReturnBasicMembData</con:comment>
        <con:context>
          <con4:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con2:replace varName="body" contents-only="true">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7fe7</con4:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count(./prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address))
where
data(./prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[$var]/@DefaultInd)="1" or data(./prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[$var]/@DefaultInd)="true"
return

./prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[$var]/@DefaultInd</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">"1"</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="Request">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6105418122853364779--557a84b9.129631dc054.-7fe0</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con1:replace varName="body" contents-only="false" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-1970153335756382092--6647a2df.12958d3d281.-7fb2</con2:id>
            <con1:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./*</con:xpathText>
            </con1:location>
            <con1:expr>
              <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                <con:resource ref="MemberProfileProcessing/transformations/XQ_Req_InsertNewMember"/>
                <con:param name="InsertNewMember">
                  <con:path>$body/*</con:path>
                </con:param>
              </con:xqueryTransform>
            </con1:expr>
          </con1:replace>
        </con:actions>
      </con:stage>
      <con3:stage name="Creating Member Number">
        <con3:comment>Service Callout to AYRESNewMember.ReturnMemberBasicData.This Service will create NewMemberNumber in Siebel Database and will return the MemberNumber and PNRName</con3:comment>
        <con3:context>
          <con:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/"/>
          <con:varNsDecl prefix="com" namespace="http://com.finnair"/>
        </con3:context>
        <con3:actions>
          <con2:wsCallout>
            <con:id>_ActionId-6637644696297698549--1ae1ce3f.12b99b77a20.-7fe5</con:id>
            <con2:service ref="MemberProfileProcessing/businessservices/AYRESNewMember" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con2:operation>ReturnBasicMembData</con2:operation>
            <con2:request>
              <con2:body wrapped="true">$body</con2:body>
              <con2:header/>
            </con2:request>
            <con2:response>
              <con2:body wrapped="true">body</con2:body>
              <con2:header/>
            </con2:response>
            <con2:requestTransform>
              <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                <con:id>_ActionId-3328702671766844306-55bf560e.12be1f11fd1.-7fdf</con:id>
                <con4:logLevel>info</con4:logLevel>
                <con4:expr>
                  <con:xqueryText>$body</con:xqueryText>
                </con4:expr>
                <con4:message>Logging Portal To ReturnBasicMembData Request.</con4:message>
              </con4:log>
              <con2:delete varName="header">
                <con:id>_ActionId-2041694110763451302--16168512.131fb1161ef.-7f38</con:id>
                <con2:location>
                  <con:xpathText>./*</con:xpathText>
                </con2:location>
              </con2:delete>
            </con2:requestTransform>
            <con2:responseTransform>
              <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                <con:id>_ActionId-3328702671766844306-55bf560e.12be1f11fd1.-7fde</con:id>
                <con4:logLevel>debug</con4:logLevel>
                <con4:expr>
                  <con:xqueryText>$body</con:xqueryText>
                </con4:expr>
                <con4:message>Logging ReturnBasicMembData To ReturnBasicMembData Response.</con4:message>
              </con4:log>
              <con2:ifThenElse>
                <con:id>_ActionId-6637644696297698549--1ae1ce3f.12b99b77a20.-7fe4</con:id>
                <con2:case>
                  <con2:condition>
                    <con:xqueryText>fn:local-name($body/*[1])='Fault'</con:xqueryText>
                  </con2:condition>
                  <con2:actions>
                    <con2:Error>
                      <con:id>_ActionId-6637644696297698549--1ae1ce3f.12b99b77a20.-7fe3</con:id>
                      <con2:errCode>50</con2:errCode>
                      <con2:message>Error While Creating New Member</con2:message>
                    </con2:Error>
                  </con2:actions>
                </con2:case>
              </con2:ifThenElse>
            </con2:responseTransform>
          </con2:wsCallout>
        </con3:actions>
      </con3:stage>
      <con:stage name="Portal To AYRESNewMember II" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
        <con:comment>Request Transformation for AYRESNewMember.InsertNewMember</con:comment>
        <con:context>
          <con4:userNsDecl prefix="ayr" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:userNsDecl prefix="ayr1" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20â€“%20Long%20Portal" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con2:varNsDecl prefix="loy" namespace="http://www.siebel.com/xml/LOYMember" xmlns:con2="http://www.bea.com/wli/sb/stages/config"/>
          <con2:varNsDecl prefix="asi" namespace="http://siebel.com/asi/" xmlns:con2="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con1:variable name="Siebel" path="$Siebel">
            <con1:service operation="ReturnBasicMembData">
              <con1:business ref="MemberProfileProcessing/businessservices/AYRESNewMember"/>
            </con1:service>
          </con1:variable>
        </con:context>
        <con:actions>
          <con2:assign varName="MemberNumber">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-2620698230051504387--192219d2.129684ae392.-7fba</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body/asi:ReturnBasicMembDataResponse/MemberNumber/text()</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="LangIDdvm">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6105418122853364779--557a84b9.129631dc054.-7fb5</con3:id>
            <con2:expr>
              <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                <con:resource ref="Common/transformations/Country_DVM"/>
              </con:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="LangNamedvm">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-2620698230051504387--192219d2.129684ae392.-7fd4</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config"><![CDATA[<tns:dvm name="country-dvm" xmlns:tns="http://xmlns.oracle.com/dvm" 

xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
  <tns:description>Country DVM</tns:description>
  <tns:columns>
    <tns:column name="Input"/>
    <tns:column name="Output"/>
  </tns:columns>
  <tns:rows>
  <tns:row>
<tns:cell>EN</tns:cell>
<tns:cell>English-American</tns:cell>
</tns:row>
<tns:row>
<tns:cell>FI</tns:cell>
<tns:cell>Finnish</tns:cell>
</tns:row>
<tns:row>
<tns:cell>SV</tns:cell>
<tns:cell>Swedish</tns:cell>
</tns:row>
<tns:row>
<tns:cell>SE</tns:cell>
<tns:cell>Swedish</tns:cell>
</tns:row>

 </tns:rows>
</tns:dvm>]]></con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="ID">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6105418122853364779--557a84b9.129631dc054.-7fb4</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn:upper-case($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:LanguageSpoken/@Code)</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="SiebelCode">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6105418122853364779--557a84b9.129631dc054.-7fb3</con3:id>
            <con2:expr>
              <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                <con:resource ref="MemberProfileProcessing/transformations/InsertDVM"/>
                <con:param name="sourceValue">
                  <con:path>$ID</con:path>
                </con:param>
                <con:param name="sourceColumnName">
                  <con:path>"Input"</con:path>
                </con:param>
                <con:param name="targetColumnName">
                  <con:path>"Output"</con:path>
                </con:param>
                <con:param name="defaultValue">
                  <con:path>"ENU"</con:path>
                </con:param>
                <con:param name="dvmTable">
                  <con:path>$LangIDdvm</con:path>
                </con:param>
              </con:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="SiebelName">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-2620698230051504387--192219d2.129684ae392.-7fcf</con3:id>
            <con2:expr>
              <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                <con:resource ref="MemberProfileProcessing/transformations/InsertDVM"/>
                <con:param name="sourceValue">
                  <con:path>$ID</con:path>
                </con:param>
                <con:param name="sourceColumnName">
                  <con:path>"Input"</con:path>
                </con:param>
                <con:param name="targetColumnName">
                  <con:path>"Output"</con:path>
                </con:param>
                <con:param name="defaultValue">
                  <con:path>"English-American"</con:path>
                </con:param>
                <con:param name="dvmTable">
                  <con:path>$LangNamedvm</con:path>
                </con:param>
              </con:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6310268134615942556--58e9ee9b.12bc2e13088.-7fdd</con4:id>
            <con2:case>
              <con2:condition>
                <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                  <con4:compExpr operator="=">
                    <con4:leftPath>data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField/@KeyValue)</con4:leftPath>
                    <con4:rightPath>"9"</con4:rightPath>
                  </con4:compExpr>
                </con4:xqueryConditionExpr>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="ReceivePartnerPromotionFlag">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6310268134615942556--58e9ee9b.12bc2e13088.-7fdc</con3:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField)) 
where data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "9"

return

if (data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "9"
and
data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]) = "TRUE")
then "Y"
else 
"N"</con:xqueryText>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:assign varName="ReceivePartnerPromotionFlag">
                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6310268134615942556--58e9ee9b.12bc2e13088.-7fdb</con3:id>
                <con2:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">"N"</con:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:default>
          </con2:ifThenElse>
          <con2:assign varName="ReceivePromotionFlag">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-2041694110763451302--16168512.131fb1161ef.-7f2f</con4:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">"Y"</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="Second">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6105418122853364779--557a84b9.129631dc054.-7fbe</con3:id>
            <con2:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config"><![CDATA[<asi:InsertNewMember xmlns:asi="http://siebel.com/asi/" xmlns:loy="http://www.siebel.com/xml/LOYMember">
   <SiebelMessage>
      <loy:ListOfAyLoyMember>
         <loy:AyLoyMember>
            <loy:ContactFirstName>{data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:PersonName/com:GivenName)}</loy:ContactFirstName>
            <loy:ContactLastName>{data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:PersonName/com:Surname)}</loy:ContactLastName>
            <loy:EnrollmentChannel>{$enrollmentChannel}</loy:EnrollmentChannel>
            <loy:LanguageId>{$SiebelCode}</loy:LanguageId>
            <loy:LanguageName>{$SiebelName}</loy:LanguageName>
            <loy:MemberNumber>{data($body/asi:ReturnBasicMembDataResponse/MemberNumber)}</loy:MemberNumber>
			{if(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Rates/@PromotionCode) != "") then 
			if(fn:starts-with( (data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Rates/@PromotionCode)),"MG*")) then
			<loy:MemberGroup>{fn:substring-after((data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Rates/@PromotionCode)),"MG*")}</loy:MemberGroup>
			else <loy:AYEnrollmentCampaign>{data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Rates/@PromotionCode)}</loy:AYEnrollmentCampaign>
			else ""}
            <loy:PNRName>{data($body/asi:ReturnBasicMembDataResponse/PNRName)}</loy:PNRName>
            <loy:ProgramName>Finnair Plus</loy:ProgramName>
            <loy:ReceivePartnerPromotionFlag>{$ReceivePartnerPromotionFlag}</loy:ReceivePartnerPromotionFlag>
            <loy:ReceivePromotionFlag>{$ReceivePromotionFlag}</loy:ReceivePromotionFlag>
            <loy:Status>{if(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/@Status)="A") then ("Active") 
else if(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/@Status)="I") then ("Inactive")
else if(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/@Status)="L") then ("Dormant") 
else if(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/@Status)="T") then ("Deleted")
else if(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/@Status)="P") then  ("Pending")
else if(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/@Status)="D") then ("Deceased") else "" }</loy:Status>
         </loy:AyLoyMember>
      </loy:ListOfAyLoyMember>
   </SiebelMessage>
   <StatusObject>?</StatusObject>
</asi:InsertNewMember>]]></con6:xqueryText>
            </con2:expr>
          </con2:assign>
          <con:replace varName="body" contents-only="false" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con1:id xmlns:con1="http://www.bea.com/wli/sb/stages/config">_ActionId-8474880111340823902-11a6e533.1295df6a1b5.-7fd9</con1:id>
            <con:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./*</con:xpathText>
            </con:location>
            <con:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Second</con:xqueryText>
            </con:expr>
          </con:replace>
        </con:actions>
      </con:stage>
      <con:stage name="Inserting New Member" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
        <con:comment>Service Callout to AYRESNewMember.InsertNewMember.This Service will create NewMember in Siebel Database and will return Success.</con:comment>
        <con:context>
          <con4:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con2:wsCallout>
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6105418122853364779--557a84b9.129631dc054.-7fba</con3:id>
            <con2:service ref="MemberProfileProcessing/businessservices/AYRESNewMember" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con2:operation>InsertNewMember</con2:operation>
            <con2:request>
              <con2:body wrapped="true">$body</con2:body>
              <con2:header/>
            </con2:request>
            <con2:response>
              <con2:body wrapped="true">body</con2:body>
              <con2:header/>
            </con2:response>
            <con2:requestTransform>
              <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-7306129615012111980--52975030.12b8a4abbe8.-7f61</con5:id>
                <con4:logLevel>debug</con4:logLevel>
                <con4:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                </con4:expr>
                <con4:message>Logging AyresNewMember.InsertNewMember Request</con4:message>
              </con4:log>
              <con2:delete varName="header">
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-2041694110763451302--16168512.131fb1161ef.-7f37</con4:id>
                <con2:location>
                  <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./*</con:xpathText>
                </con2:location>
              </con2:delete>
            </con2:requestTransform>
            <con2:responseTransform>
              <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7df4</con5:id>
                <con4:logLevel>debug</con4:logLevel>
                <con4:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                </con4:expr>
                <con4:message>Logging AyresNewMember.InsertNewMember Response</con4:message>
              </con4:log>
              <con2:ifThenElse>
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6657838074217504034-20de61e7.12a56cdf324.-7fe6</con4:id>
                <con2:case>
                  <con2:condition>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn:local-name($body/*[1])='Fault'</con:xqueryText>
                  </con2:condition>
                  <con2:actions>
                    <con2:Error>
                      <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6657838074217504034-20de61e7.12a56cdf324.-7fe5</con4:id>
                      <con2:errCode>51</con2:errCode>
                      <con2:message>Error in Inserting New Member</con2:message>
                    </con2:Error>
                  </con2:actions>
                </con2:case>
              </con2:ifThenElse>
            </con2:responseTransform>
          </con2:wsCallout>
        </con:actions>
      </con:stage>
      <con:stage name="Portal To AYLoyMemberPortal" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
        <con:comment>Request Transformation for AYLoyMemberPortal.QuerybyExampleFullMember</con:comment>
        <con:context>
          <con2:varNsDecl prefix="loy" namespace="http://www.siebel.com/xml/LOYMember" xmlns:con2="http://www.bea.com/wli/sb/stages/config"/>
          <con2:varNsDecl prefix="asi" namespace="http://siebel.com/asi/" xmlns:con2="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con1:variable name="Siebel" path="$Siebel">
            <con1:service>
              <con1:business ref="MemberProfileProcessing/businessservices/AYRESNewMember"/>
            </con1:service>
          </con1:variable>
        </con:context>
        <con:actions>
          <con2:assign varName="Third">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-2620698230051504387--192219d2.129684ae392.-7fc6</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config"><![CDATA[<asi:QuerybyExampleFullMember xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:asi="http://siebel.com/asi/" xmlns:ayr="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal">
	<SiebelMessage>
            <ayr:ListOfAyresMemberInformationLongPortal>
         
                <ayr:LoyMember>


                  <ayr:MemberNumber>{$MemberNumber}</ayr:MemberNumber>


               </ayr:LoyMember>
            </ayr:ListOfAyresMemberInformationLongPortal>
         </SiebelMessage>
</asi:QuerybyExampleFullMember>]]></con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="false">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-2620698230051504387--192219d2.129684ae392.-7fa4</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./*</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Third</con:xqueryText>
            </con2:expr>
          </con2:replace>
        </con:actions>
      </con:stage>
      <con:stage name="Retrieving Full Details of MemberID" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
        <con:comment>Service Callout to AYLoyMemberPortal.QueryByExampleFullMember. This Service will return the default structure with default values, created at the time of inserting a new member.</con:comment>
        <con:context>
          <con4:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con2:wsCallout>
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-2620698230051504387--192219d2.129684ae392.-7faa</con3:id>
            <con2:service ref="MemberProfileProcessing/businessservices/AYLoyMemberPortal" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con2:operation>QuerybyExampleFullMember</con2:operation>
            <con2:request>
              <con2:body wrapped="true">$body</con2:body>
              <con2:header/>
            </con2:request>
            <con2:response>
              <con2:body wrapped="true">body</con2:body>
              <con2:header/>
            </con2:response>
            <con2:requestTransform>
              <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7df3</con5:id>
                <con4:logLevel>info</con4:logLevel>
                <con4:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                </con4:expr>
                <con4:message>Logging QuerybyExampleFullMember Request</con4:message>
              </con4:log>
              <con2:delete varName="header">
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-2041694110763451302--16168512.131fb1161ef.-7f36</con4:id>
                <con2:location>
                  <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./*</con:xpathText>
                </con2:location>
              </con2:delete>
            </con2:requestTransform>
            <con2:responseTransform>
              <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7df2</con5:id>
                <con4:logLevel>debug</con4:logLevel>
                <con4:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                </con4:expr>
                <con4:message>Logging QuerybyExampleFullMember Request To QuerybyExampleFullMember Response.</con4:message>
              </con4:log>
              <con2:assign varName="querybyExampleFullMemberResponse">
                <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-979274265589350622--5619026e.14395f0c225.-7fac</con6:id>
                <con2:expr>
                  <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">$body</con6:xqueryText>
                </con2:expr>
              </con2:assign>
              <con2:ifThenElse>
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7fd4</con4:id>
                <con2:case>
                  <con2:condition>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn:local-name($body/*[1])='Fault'</con:xqueryText>
                  </con2:condition>
                  <con2:actions>
                    <con2:Error>
                      <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7fd3</con4:id>
                      <con2:errCode>0000</con2:errCode>
                      <con2:message>Siebel Backend Error</con2:message>
                    </con2:Error>
                  </con2:actions>
                </con2:case>
              </con2:ifThenElse>
            </con2:responseTransform>
          </con2:wsCallout>
        </con:actions>
      </con:stage>
      <con:stage name="Portal To Synchronise I" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
        <con:comment>Miscellaneous Transformation</con:comment>
        <con:context>
          <con3:varNsDecl prefix="ayr" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con3:varNsDecl prefix="asi" namespace="http://siebel.com/asi/" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con1:variable name="Siebel" path="$Siebel">
            <con1:service operation="QuerybyExampleFullMember">
              <con1:business ref="MemberProfileProcessing/businessservices/AYLoyMemberPortal"/>
            </con1:service>
          </con1:variable>
        </con:context>
        <con:actions>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5814644046060843536-7e45067c.1298c5da1e4.-7fda</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:MemberNumber</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$MemberNumber</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="MF">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5814644046060843536-7e45067c.1298c5da1e4.-7fdb</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">if (data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/@Gender) = "Male") then ("M")
else if (data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/@Gender) = "Female") then ("F")
else ""</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5814644046060843536-7e45067c.1298c5da1e4.-7fd9</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:MF</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$MF</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-4272444770741942686-52b06724.13672f07bbc.-7fef</con4:id>
            <con2:case>
              <con2:condition>
                <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">string-length($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/*:ListOfAyresMemberInformationLongPortal/*:LoyMember/*:ListOfContact/*:Contact/*:MM/text()) = 0</con6:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="MM">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-4272444770741942686-52b06724.13672f07bbc.-7fec</con4:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">if (data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/@Gender) = "Male") then ("Mr.")
else if (data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/@Gender) = "Female") then ("Ms.")
else ""</con:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:replace varName="body" contents-only="true">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-4272444770741942686-52b06724.13672f07bbc.-7fea</con4:id>
                  <con2:location>
                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:MM</con:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$MM</con:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:assign varName="PrimaryDateofBirth">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7196663052906402885--53b83241.1299701f4fb.-7fe4</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">if(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/@BirthDate)!="") then 
fn:concat(
fn:substring(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/@BirthDate),6,2),
"/",
fn:substring(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/@BirthDate),9,2),
"/",
fn:substring(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/@BirthDate),1,4),
" ",
fn:substring(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/@BirthDate),12)
)

else

data($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:PrimaryDateofBirth)</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7196663052906402885--53b83241.1299701f4fb.-7fe3</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:BirthDate</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PrimaryDateofBirth</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="PrimaryContactFirstName">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5814644046060843536-7e45067c.1298c5da1e4.-7fd2</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:PersonName/com:GivenName/text()</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5814644046060843536-7e45067c.1298c5da1e4.-7fd1</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:PrimaryContactFirstName</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PrimaryContactFirstName</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="ContactMiddleName">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-2547816300260951139--26c224ef.12d0c6edf0b.-7fe7</con4:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:PersonName/com:MiddleName/text()</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-2547816300260951139--26c224ef.12d0c6edf0b.-7fe6</con4:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:MiddleName</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$ContactMiddleName</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="PrimaryContactLastName">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5814644046060843536-7e45067c.1298c5da1e4.-7fce</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:PersonName/com:Surname/text()</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5814644046060843536-7e45067c.1298c5da1e4.-7fcd</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:PrimaryContactLastName</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PrimaryContactLastName</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="PhoneNumber">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8132496771578085873-7657234d.12b75a0ca85.-7efb</con4:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in ( 1 to fn:count($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Telephone)) 

where data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Telephone[$var]/@PhoneLocationType) = "6" and 
data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Telephone[$var]/@PhoneTechType) = "5"

return 

fn:replace(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Telephone[$var]/@PhoneNumber),"-","")</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="AlternateSMS">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5814644046060843536-7e45067c.1298c5da1e4.-7fc2</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config"><![CDATA[if ((data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Telephone/@PhoneLocationType) = "6" and 
data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Telephone/@PhoneTechType) = "5")) then


<ayr:ListOfLoyCommunicationSms>
                           <ayr:LoyCommunicationSms>
                              <ayr:Id>0</ayr:Id>
                              <ayr:AlternateSMS>{$PhoneNumber}</ayr:AlternateSMS>
                              <ayr:AlternateSMSMediumType>SMS</ayr:AlternateSMSMediumType>
                              <ayr:AlternateSMSName>Home</ayr:AlternateSMSName>
                              <ayr:AlternateSMSPersonId>{$body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:Id/text()}</ayr:AlternateSMSPersonId>
                           </ayr:LoyCommunicationSms>
                        </ayr:ListOfLoyCommunicationSms>



else 
<ayr:ListOfLoyCommunicationSms/>]]></con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="false">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5814644046060843536-7e45067c.1298c5da1e4.-7fc1</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfLoyCommunicationSms</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$AlternateSMS</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="AlternateEmailAddress">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5814644046060843536-7e45067c.1298c5da1e4.-7fc0</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config"><![CDATA[if (data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Email/@EmailType) = "1") then


<ayr:ListOfCommunicationAddress>
                           <ayr:CommunicationAddress>
                              <ayr:Id>0</ayr:Id>
                              <ayr:AlternateEmailAddress>{data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Email/text())}</ayr:AlternateEmailAddress>
                              <ayr:CommunicationAddressMediumType>Email</ayr:CommunicationAddressMediumType>
                              <ayr:CommunicationAddressName>Home</ayr:CommunicationAddressName>
                              <ayr:CommunicationAddressPersonId xsi:nil="true"/>
                           </ayr:CommunicationAddress>
                        </ayr:ListOfCommunicationAddress>

else
<ayr:ListOfCommunicationAddress/>]]></con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="false">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5814644046060843536-7e45067c.1298c5da1e4.-7fbf</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfCommunicationAddress</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$AlternateEmailAddress</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="AYeMailReturnedFlg">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5814644046060843536-7e45067c.1298c5da1e4.-7fbe</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">if(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Email) !="") then ("N")
else ("Y")</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5814644046060843536-7e45067c.1298c5da1e4.-7fbd</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:AYeMailReturnedFlg</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$AYeMailReturnedFlg</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="AYMailReturnedFlag">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5814644046060843536-7e45067c.1298c5da1e4.-7fb7</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in(1 to fn:count($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address))
return
if($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[$var]/@DefaultInd="1") then
if (data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[$var]/com:AddressLine) = "" and data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[$var]/com:County)="" and data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[$var]/com:StateProv)="" and data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[$var]/@Description)="" and data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[$var]/com:CityName)="" and data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[$var]/com:PostalCode)="" and data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[$var]/com:CountryName/@Code)="") then ("Y")
else ("N")
else ("N")</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5814644046060843536-7e45067c.1298c5da1e4.-7fb6</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:AYMailReturnedFlg</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$AYMailReturnedFlag</con:xqueryText>
            </con2:expr>
          </con2:replace>
        </con:actions>
      </con:stage>
      <con:stage name="Portal To Synchronise II" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
        <con:comment>Tranformation of Guardian and Document</con:comment>
        <con:context>
          <con3:varNsDecl prefix="ayr" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con3:varNsDecl prefix="asi" namespace="http://siebel.com/asi/" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con5:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
          <con5:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
          <con1:variable name="Siebel" path="$Siebel">
            <con1:service operation="QuerybyExampleFullMember">
              <con1:business ref="MemberProfileProcessing/businessservices/AYLoyMemberPortal"/>
            </con1:service>
          </con1:variable>
        </con:context>
        <con:actions>
          <con:assign varName="CitizenCountry" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con1:id xmlns:con1="http://www.bea.com/wli/sb/stages/config">_ActionId-3411810035365129931-ea8fbc2.129918a9afb.-7fd8</con1:id>
            <con:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn:upper-case($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:CitizenCountryName/@Code)</con:xqueryText>
            </con:expr>
          </con:assign>
          <con2:assign varName="CitizendvmTable">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7479597100834234522--13b7068.12d1699f1ec.-7d21</con4:id>
            <con2:expr>
              <con6:xqueryTransform xmlns:con6="http://www.bea.com/wli/sb/stages/config">
                <con6:resource ref="Common/transformations/CitizenshipDVM"/>
              </con6:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="dvmTable">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-8227967121587516870-3f186feb.12a363afb37.-7fd5</con3:id>
            <con2:expr>
              <con6:xqueryTransform xmlns:con6="http://www.bea.com/wli/sb/stages/config">
                <con6:resource ref="Common/transformations/CountryCodesToCRM_DVM"/>
              </con6:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7479597100834234522--13b7068.12d1699f1ec.-7b5e</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($CitizenCountry) != ""</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="CitizenCode">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7479597100834234522--13b7068.12d1699f1ec.-7b5d</con3:id>
                  <con2:expr>
                    <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                      <con:resource ref="MemberProfileProcessing/transformations/InsertDVM"/>
                      <con:param name="sourceValue">
                        <con:path>$CitizenCountry</con:path>
                      </con:param>
                      <con:param name="sourceColumnName">
                        <con:path>"CitizenshipCode"</con:path>
                      </con:param>
                      <con:param name="targetColumnName">
                        <con:path>"CitizenshipName"</con:path>
                      </con:param>
                      <con:param name="defaultValue">
                        <con:path>""</con:path>
                      </con:param>
                      <con:param name="dvmTable">
                        <con:path>$CitizendvmTable</con:path>
                      </con:param>
                    </con:xqueryTransform>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con:replace varName="body" contents-only="true" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con1:id xmlns:con1="http://www.bea.com/wli/sb/stages/config">_ActionId-3411810035365129931-ea8fbc2.129918a9afb.-7fd6</con1:id>
            <con:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:Citizenship</con:xpathText>
            </con:location>
            <con:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$CitizenCode</con:xqueryText>
            </con:expr>
          </con:replace>
          <con2:assign varName="AYGuardianMemberNumber">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3411810035365129931-ea8fbc2.129918a9afb.-7fe4</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:RelatedTraveler))
where $Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:RelatedTraveler[$var]/@Relation = "guardian"

return
$Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:RelatedTraveler[$var]/com:UniqueID/@ID</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3411810035365129931-ea8fbc2.129918a9afb.-7fe3</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:AYGuardianMemberNumber</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$AYGuardianMemberNumber</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="AYGuardianName">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3411810035365129931-ea8fbc2.129918a9afb.-7fe2</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:RelatedTraveler))
where $Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:RelatedTraveler[$var]/@Relation = "guardian"

return

$Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:RelatedTraveler[$var]/com:PersonName/com:Surname/text()</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3411810035365129931-ea8fbc2.129918a9afb.-7fe1</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:AYGuardianName</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$AYGuardianName</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="AYGuardianPhoneNumber">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3411810035365129931-ea8fbc2.129918a9afb.-7fe0</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:RelatedTraveler))
where $Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:RelatedTraveler[$var]/@Relation = "guardian"

return

for $var2 in (1 to fn:count($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:RelatedTraveler[$var]/com:Telephone))
where 
data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:RelatedTraveler[$var]/com:Telephone[$var2]/@PhoneLocationType)="6" and 
data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:RelatedTraveler[$var]/com:Telephone[$var2]/@PhoneTechType)="5"

return 

$Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:RelatedTraveler[$var]/com:Telephone[$var2]/@PhoneNumber</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3411810035365129931-ea8fbc2.129918a9afb.-7fdf</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:AYGuardianPhoneNumber</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$AYGuardianPhoneNumber</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="AYGuardianEmail">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3411810035365129931-ea8fbc2.129918a9afb.-7fde</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:RelatedTraveler))
where $Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:RelatedTraveler[$var]/@Relation = "guardian"

return

$Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:RelatedTraveler[$var]/com:Email/text()</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3411810035365129931-ea8fbc2.129918a9afb.-7fdd</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:AYGuardianEmail</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$AYGuardianEmail</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7238953409985074563-2a81867e.12d73402cbf.-7f83</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Document/@DocType) = "2"</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="LoyTravelProfileId">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7238953409985074563-2a81867e.12d73402cbf.-7f82</con4:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfLoyTravelProfile/ayr:LoyTravelProfile/ayr:Id)</con:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:assign varName="DocPassportCountry">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7238953409985074563-2a81867e.12d73402cbf.-7f81</con3:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Document/@DocIssueCountry)</con:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:assign varName="PassportCountry">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-7238953409985074563-2a81867e.12d73402cbf.-7f80</con3:id>
                  <con2:expr>
                    <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                      <con:resource ref="MemberProfileProcessing/transformations/InsertDVM"/>
                      <con:param name="sourceValue">
                        <con:path>$DocPassportCountry</con:path>
                      </con:param>
                      <con:param name="sourceColumnName">
                        <con:path>"CountryCode"</con:path>
                      </con:param>
                      <con:param name="targetColumnName">
                        <con:path>"CountryName"</con:path>
                      </con:param>
                      <con:param name="defaultValue">
                        <con:path>""</con:path>
                      </con:param>
                      <con:param name="dvmTable">
                        <con:path>$dvmTable</con:path>
                      </con:param>
                    </con:xqueryTransform>
                  </con2:expr>
                </con2:assign>
                <con2:assign varName="ListOfLoyTravelProfile">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7238953409985074563-2a81867e.12d73402cbf.-7f7f</con4:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config"><![CDATA[<ayr:ListOfLoyTravelProfile>                  
           <ayr:LoyTravelProfile>

                              <ayr:Id>{$LoyTravelProfileId}</ayr:Id>
                              <ayr:ParentContactId>{$LoyTravelProfileId}</ayr:ParentContactId>
                              <ayr:PassportCountry>{$PassportCountry}</ayr:PassportCountry>

                              <ayr:PassportExpirationDate>{fn:concat(
fn:substring(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Document/@ExpireDate),6,2),
"/",
fn:substring(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Document/@ExpireDate),9,2),
"/",
fn:substring(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Document/@ExpireDate),1,4),
"",
fn:substring(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Document/@ExpireDate),12)
)}</ayr:PassportExpirationDate>

                              <ayr:PassportIssueDate>{fn:concat(
fn:substring(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Document/@EffectiveDate),6,2),
"/",
fn:substring(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Document/@EffectiveDate),9,2),
"/",
fn:substring(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Document/@EffectiveDate),1,4),
"",
fn:substring(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Document/@EffectiveDate),12)
)}</ayr:PassportIssueDate>

                              <ayr:PassportNumber>{data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Document/@DocID)}</ayr:PassportNumber>
                              <ayr:PreferredMealType></ayr:PreferredMealType>
                              <ayr:PreferredSeatType></ayr:PreferredSeatType>
                              <ayr:SmokeFlag>N</ayr:SmokeFlag>
             </ayr:LoyTravelProfile>
</ayr:ListOfLoyTravelProfile>]]></con:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:replace varName="body" contents-only="false">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7238953409985074563-2a81867e.12d73402cbf.-7f7e</con4:id>
                  <con2:location>
                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfLoyTravelProfile</con:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$ListOfLoyTravelProfile</con:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:assign varName="PreferredSeatType">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7238953409985074563-2a81867e.12d73402cbf.-7f7d</con4:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">if ($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:PrefCollections/com:PrefCollection/com:AirlinePref/com:SeatPref/com:SeatPreferences/text() = "5") then "Window"
 
else if ($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:PrefCollections/com:PrefCollection/com:AirlinePref/com:SeatPref/com:SeatPreferences/text() = "3") then "Aisle"
else
""</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7238953409985074563-2a81867e.12d73402cbf.-7f7c</con4:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfLoyTravelProfile/ayr:LoyTravelProfile/ayr:PreferredSeatType</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PreferredSeatType</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="PreferredMealType">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7238953409985074563-2a81867e.12d73402cbf.-7f7b</con4:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:PrefCollections/com:PrefCollection/com:AirlinePref/com:SSR_Pref/@SSR_Code)</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7238953409985074563-2a81867e.12d73402cbf.-7f7a</con4:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfLoyTravelProfile/ayr:LoyTravelProfile/ayr:PreferredMealType</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PreferredMealType</con:xqueryText>
            </con2:expr>
          </con2:replace>
        </con:actions>
      </con:stage>
      <con:stage name="Portal To Synchronise III" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
        <con:comment>AddressLine Transformation</con:comment>
        <con:context>
          <con3:varNsDecl prefix="ayr" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con3:varNsDecl prefix="asi" namespace="http://siebel.com/asi/" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con1:variable name="$Siebel" path="$Siebel">
            <con1:service operation="QuerybyExampleFullMember">
              <con1:business ref="MemberProfileProcessing/businessservices/AYLoyMemberPortal"/>
            </con1:service>
          </con1:variable>
        </con:context>
        <con:actions>
          <con2:assign varName="PortalCountryCodeHome">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5261270935375145941-4cb03e3d.12a3114c13c.-7f83</con3:id>
            <con2:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">$Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[@UseType = "13"]/com:CountryName/@Code</con6:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="PortalCountryCodeJob">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5261270935375145941-4cb03e3d.12a3114c13c.-7f82</con3:id>
            <con2:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">$Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[@UseType = "14"]/com:CountryName/@Code</con6:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-2213640281224819431-30cc04e1.12a3b655063.-7fc6</con3:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($PortalCountryCodeHome) !=""</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="PersonalCountryHome">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-2213640281224819431-30cc04e1.12a3b655063.-7fc5</con3:id>
                  <con2:expr>
                    <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                      <con:resource ref="MemberProfileProcessing/transformations/InsertDVM"/>
                      <con:param name="sourceValue">
                        <con:path>$PortalCountryCodeHome</con:path>
                      </con:param>
                      <con:param name="sourceColumnName">
                        <con:path>"CountryCode"</con:path>
                      </con:param>
                      <con:param name="targetColumnName">
                        <con:path>"CountryName"</con:path>
                      </con:param>
                      <con:param name="defaultValue">
                        <con:path>""</con:path>
                      </con:param>
                      <con:param name="dvmTable">
                        <con:path>$dvmTable</con:path>
                      </con:param>
                    </con:xqueryTransform>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con2:ifThenElse>
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-2213640281224819431-30cc04e1.12a3b655063.-7fd5</con3:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($PortalCountryCodeJob) !=""</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="PersonalCountryJob">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-2213640281224819431-30cc04e1.12a3b655063.-7fd4</con3:id>
                  <con2:expr>
                    <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                      <con:resource ref="MemberProfileProcessing/transformations/InsertDVM"/>
                      <con:param name="sourceValue">
                        <con:path>$PortalCountryCodeJob</con:path>
                      </con:param>
                      <con:param name="sourceColumnName">
                        <con:path>"CountryCode"</con:path>
                      </con:param>
                      <con:param name="targetColumnName">
                        <con:path>"CountryName"</con:path>
                      </con:param>
                      <con:param name="defaultValue">
                        <con:path>""</con:path>
                      </con:param>
                      <con:param name="dvmTable">
                        <con:path>$dvmTable</con:path>
                      </con:param>
                    </con:xqueryTransform>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
          </con2:ifThenElse>
          <con:assign varName="PersonalStreetAddressHome" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con1:id xmlns:con1="http://www.bea.com/wli/sb/stages/config">_ActionId-3019619899048675035-49cec79a.129a5de8ceb.-7fd3</con1:id>
            <con:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">$Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[@UseType="13"]/com:AddressLine[1]/text()</con6:xqueryText>
            </con:expr>
          </con:assign>
          <con:assign varName="PersonalStreetAddressHome2" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-9206126092649992002-1cc2353f.14c45bd1e7f.-7fb8</con6:id>
            <con:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">$Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[@UseType="13"]/com:AddressLine[2]/text()</con6:xqueryText>
            </con:expr>
          </con:assign>
          <con:assign varName="PersonalStreetAddressJob" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con1:id xmlns:con1="http://www.bea.com/wli/sb/stages/config">_ActionId-3019619899048675035-49cec79a.129a5de8ceb.-7fcd</con1:id>
            <con:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">$Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[@UseType="14"]/com:AddressLine[1]/text()</con6:xqueryText>
            </con:expr>
          </con:assign>
          <con:assign varName="PersonalStreetAddressJob2" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-9206126092649992002-1cc2353f.14c45bd1e7f.-7f62</con6:id>
            <con:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">$Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[@UseType="14"]/com:AddressLine[2]/text()</con6:xqueryText>
            </con:expr>
          </con:assign>
          <con:assign varName="PersonalStreetAddressJob3" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-9206126092649992002-1cc2353f.14c45bd1e7f.-7f7f</con6:id>
            <con:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">$Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[@UseType="14"]/com:AddressLine[3]/text()</con6:xqueryText>
            </con:expr>
          </con:assign>
          <con2:assign varName="DescriptionHome">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5090540286158741535-7d109f9d.12d11b88c6a.-7bda</con4:id>
            <con2:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[@UseType="13"]/@Description)</con6:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="DescriptionJob">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5090540286158741535-7d109f9d.12d11b88c6a.-7bd9</con4:id>
            <con2:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[@UseType="14"]/@Description)</con6:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="CountyHome">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5090540286158741535-7d109f9d.12d11b88c6a.-7bd8</con4:id>
            <con2:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[@UseType="13"]/com:County)</con6:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="CountyJob">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5090540286158741535-7d109f9d.12d11b88c6a.-7bd7</con4:id>
            <con2:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[@UseType="14"]/com:County)</con6:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="PersonalAddress1">
            <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-3686255242343302756--36a941b2.14ba0d6bfb1.-7fe4</con6:id>
            <con2:expr>
              <con6:xqueryTransform xmlns:con6="http://www.bea.com/wli/sb/stages/config">
                <con6:resource ref="MemberProfileProcessing/transformations/XQ_MemberFileProcessing_ProducePersonalAddress"/>
                <con6:param name="request">
                  <con6:path>$Request</con6:path>
                </con6:param>
                <con6:param name="position">
                  <con6:path>1</con6:path>
                </con6:param>
                <con6:param name="personalCountryJob">
                  <con6:path>string($PersonalCountryJob)</con6:path>
                </con6:param>
                <con6:param name="personalCountryHome">
                  <con6:path>string($PersonalCountryHome)</con6:path>
                </con6:param>
              </con6:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="PersonalAddress2">
            <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-3686255242343302756--36a941b2.14ba0d6bfb1.-7fab</con6:id>
            <con2:expr>
              <con6:xqueryTransform xmlns:con6="http://www.bea.com/wli/sb/stages/config">
                <con6:resource ref="MemberProfileProcessing/transformations/XQ_MemberFileProcessing_ProducePersonalAddress"/>
                <con6:param name="request">
                  <con6:path>$Request</con6:path>
                </con6:param>
                <con6:param name="position">
                  <con6:path>2</con6:path>
                </con6:param>
                <con6:param name="personalCountryJob">
                  <con6:path>string($PersonalCountryJob)</con6:path>
                </con6:param>
                <con6:param name="personalCountryHome">
                  <con6:path>string($PersonalCountryHome)</con6:path>
                </con6:param>
              </con6:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5584042876961402143-bf44fb2.12bf1431f5e.-7fd4</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">xs:string(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[1]/@DefaultInd))="1"</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:insert varName="body">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5584042876961402143-bf44fb2.12bf1431f5e.-7fd3</con4:id>
                  <con2:location>
                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress</con:xpathText>
                  </con2:location>
                  <con2:where>first-child</con2:where>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PersonalAddress1</con:xqueryText>
                  </con2:expr>
                </con2:insert>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:insert varName="body">
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5584042876961402143-bf44fb2.12bf1431f5e.-7fd2</con4:id>
                <con2:location>
                  <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress</con:xpathText>
                </con2:location>
                <con2:where>last-child</con2:where>
                <con2:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PersonalAddress1</con:xqueryText>
                </con2:expr>
              </con2:insert>
            </con2:default>
          </con2:ifThenElse>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5584042876961402143-bf44fb2.12bf1431f5e.-7fd1</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">xs:string(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[2]/@DefaultInd))="1"</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:insert varName="body">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5584042876961402143-bf44fb2.12bf1431f5e.-7fd0</con4:id>
                  <con2:location>
                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress</con:xpathText>
                  </con2:location>
                  <con2:where>first-child</con2:where>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PersonalAddress2</con:xqueryText>
                  </con2:expr>
                </con2:insert>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:insert varName="body">
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5584042876961402143-bf44fb2.12bf1431f5e.-7fcf</con4:id>
                <con2:location>
                  <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress</con:xpathText>
                </con2:location>
                <con2:where>last-child</con2:where>
                <con2:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$PersonalAddress2</con:xqueryText>
                </con2:expr>
              </con2:insert>
            </con2:default>
          </con2:ifThenElse>
        </con:actions>
      </con:stage>
      <con:stage name="Portal To Synchronise IV" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
        <con:comment>Miscellaneous Transformation, e.g. CustomFields</con:comment>
        <con:context>
          <con4:userNsDecl prefix="loy" namespace="http://www.siebel.com/xml/LOYMember" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con3:varNsDecl prefix="ayr" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con3:varNsDecl prefix="asi" namespace="http://siebel.com/asi/" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="ayr1" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20â€“%20Long%20Portal" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con5:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
          <con5:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
          <con1:variable name="Siebel" path="$Siebel">
            <con1:service operation="QuerybyExampleFullMember">
              <con1:business ref="MemberProfileProcessing/businessservices/AYLoyMemberPortal"/>
            </con1:service>
          </con1:variable>
        </con:context>
        <con:actions>
          <con2:assign varName="LanguageID">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5261270935375145941-4cb03e3d.12a3114c13c.-7f72</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$SiebelCode</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5261270935375145941-4cb03e3d.12a3114c13c.-7f71</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:LanguageId</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$LanguageID</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="JobTitle">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5261270935375145941-4cb03e3d.12a3114c13c.-7f66</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:EmployeeInfo/@EmployeeTitle</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5261270935375145941-4cb03e3d.12a3114c13c.-7f65</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:JobTitle</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$JobTitle</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6310268134615942556--58e9ee9b.12bc2e13088.-7fc0</con4:id>
            <con2:case>
              <con2:condition>
                <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                  <con4:compExpr operator="=">
                    <con4:leftPath>data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField/@KeyValue)</con4:leftPath>
                    <con4:rightPath>"7"</con4:rightPath>
                  </con4:compExpr>
                </con4:xqueryConditionExpr>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="SuppressSMSPromos">
                  <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6310268134615942556--58e9ee9b.12bc2e13088.-7fbc</con3:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField)) 
where data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "7"

return

if (data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "7"
and
data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]) = "TRUE")
then "N"
else 
"Y"</con:xqueryText>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:assign varName="SuppressSMSPromos">
                <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-6310268134615942556--58e9ee9b.12bc2e13088.-7fbe</con3:id>
                <con2:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">"Y"</con:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:default>
          </con2:ifThenElse>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5261270935375145941-4cb03e3d.12a3114c13c.-7f6b</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:SuppressSMSPromos</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$SuppressSMSPromos</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6310268134615942556--58e9ee9b.12bc2e13088.-7fbb</con4:id>
            <con2:case>
              <con2:condition>
                <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                  <con4:compExpr operator="=">
                    <con4:leftPath>data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField/@KeyValue)</con4:leftPath>
                    <con4:rightPath>"9"</con4:rightPath>
                  </con4:compExpr>
                </con4:xqueryConditionExpr>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="SuppresseMailWeeklyOffers">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6310268134615942556--58e9ee9b.12bc2e13088.-7fba</con4:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField)) 
where data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "9"

return

if (data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "9"
and
data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]) = "TRUE")
then "N"
else 
"Y"</con:xqueryText>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:assign varName="SuppresseMailWeeklyOffers">
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6310268134615942556--58e9ee9b.12bc2e13088.-7fb9</con4:id>
                <con2:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">"Y"</con:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:default>
          </con2:ifThenElse>
          <con2:replace varName="body" contents-only="true">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5261270935375145941-4cb03e3d.12a3114c13c.-7f6f</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:SuppresseMailWeeklyOffers</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$SuppresseMailWeeklyOffers</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:ifThenElse>
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6765379205593579413-7643eb28.136812aae71.-7d66</con5:id>
            <con2:case>
              <con2:condition>
                <con5:xqueryConditionExpr xmlns:con5="http://www.bea.com/wli/sb/stages/config">
                  <con5:compExpr operator="=">
                    <con5:leftPath>data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField/@KeyValue)</con5:leftPath>
                    <con5:rightPath>"8"</con5:rightPath>
                  </con5:compExpr>
                </con5:xqueryConditionExpr>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="ReceivePartnerPromotionFlag">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6765379205593579413-7643eb28.136812aae71.-7d65</con5:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField)) 
where data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "8"

return

if (data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "8"
and
data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]) = "TRUE")
then "Y"
else 
"N"</con:xqueryText>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:assign varName="ReceivePartnerPromotionFlag">
                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6765379205593579413-7643eb28.136812aae71.-7d64</con5:id>
                <con2:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">"N"</con:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:default>
          </con2:ifThenElse>
          <con2:replace varName="body" contents-only="true">
            <con4:comment xmlns:con4="http://www.bea.com/wli/sb/stages/config">ReceivePartnerPromotion is already defined in "Portal To AYRESNewMember II"</con4:comment>
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5261270935375145941-4cb03e3d.12a3114c13c.-7f6d</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ReceivePartnerPromotionFlag</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$ReceivePartnerPromotionFlag</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:ifThenElse>
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5494689221137924908-23c42e46.13b17add453.-7fbf</con5:id>
            <con2:case>
              <con2:condition>
                <con5:xqueryConditionExpr xmlns:con5="http://www.bea.com/wli/sb/stages/config">
                  <con5:unaryExpr>
                    <con5:path>fn:exists($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[@KeyValue="10"])</con5:path>
                  </con5:unaryExpr>
                </con5:xqueryConditionExpr>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="SuppressAllEmailsFlag">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5494689221137924908-23c42e46.13b17add453.-7fbe</con5:id>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField)) 
where data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "10"

return

if (data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "10"
and
data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]) = "TRUE")
then "N"
else 
"Y"</con5:xqueryText>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:assign varName="SuppressAllEmailsFlag">
                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5494689221137924908-23c42e46.13b17add453.-7fbd</con5:id>
                <con2:expr>
                  <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">"N"</con5:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:default>
          </con2:ifThenElse>
          <con2:replace varName="body" contents-only="true">
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5494689221137924908-23c42e46.13b17add453.-7fb7</con5:id>
            <con2:location>
              <con5:xpathText xmlns:con5="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:SuppressAllEmails</con5:xpathText>
            </con2:location>
            <con2:expr>
              <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$SuppressAllEmailsFlag</con5:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:ifThenElse>
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5494689221137924908-23c42e46.13b17add453.-7fae</con5:id>
            <con2:case>
              <con2:condition>
                <con5:xqueryConditionExpr xmlns:con5="http://www.bea.com/wli/sb/stages/config">
                  <con5:unaryExpr>
                    <con5:path>fn:exists($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[@KeyValue="11"])</con5:path>
                  </con5:unaryExpr>
                </con5:xqueryConditionExpr>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="SuppressAllFaxesFlag">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5494689221137924908-23c42e46.13b17add453.-7fad</con5:id>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField)) 
where data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "11"

return

if (data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "11"
and
data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]) = "TRUE")
then "N"
else 
"Y"</con5:xqueryText>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:assign varName="SuppressAllFaxesFlag">
                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5494689221137924908-23c42e46.13b17add453.-7fac</con5:id>
                <con2:expr>
                  <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">"N"</con5:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:default>
          </con2:ifThenElse>
          <con2:replace varName="body" contents-only="true">
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5494689221137924908-23c42e46.13b17add453.-7fab</con5:id>
            <con2:location>
              <con5:xpathText xmlns:con5="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:SuppressAllFaxes</con5:xpathText>
            </con2:location>
            <con2:expr>
              <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$SuppressAllFaxesFlag</con5:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:ifThenElse>
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5494689221137924908-23c42e46.13b17add453.-7fa2</con5:id>
            <con2:case>
              <con2:condition>
                <con5:xqueryConditionExpr xmlns:con5="http://www.bea.com/wli/sb/stages/config">
                  <con5:unaryExpr>
                    <con5:path>fn:exists($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[@KeyValue="12"])</con5:path>
                  </con5:unaryExpr>
                </con5:xqueryConditionExpr>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="SuppressAllSMSFlag">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5494689221137924908-23c42e46.13b17add453.-7fa1</con5:id>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField)) 
where data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "12"

return

if (data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "12"
and
data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]) = "TRUE")
then "N"
else 
"Y"</con5:xqueryText>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:assign varName="SuppressAllSMSFlag">
                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5494689221137924908-23c42e46.13b17add453.-7fa0</con5:id>
                <con2:expr>
                  <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">"N"</con5:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:default>
          </con2:ifThenElse>
          <con2:replace varName="body" contents-only="true">
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5494689221137924908-23c42e46.13b17add453.-7f9f</con5:id>
            <con2:location>
              <con5:xpathText xmlns:con5="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:SuppressAllSMS</con5:xpathText>
            </con2:location>
            <con2:expr>
              <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$SuppressAllSMSFlag</con5:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:ifThenElse>
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5494689221137924908-23c42e46.13b17add453.-7f8e</con5:id>
            <con2:case>
              <con2:condition>
                <con5:xqueryConditionExpr xmlns:con5="http://www.bea.com/wli/sb/stages/config">
                  <con5:unaryExpr>
                    <con5:path>fn:exists($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[@KeyValue="13"])</con5:path>
                  </con5:unaryExpr>
                </con5:xqueryConditionExpr>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="eMailFlightInfoFlag">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-647001423838376665--2691a3a6.13db0bba4a2.-7644</con5:id>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField)) 
where data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "13"

return

if (data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]/@KeyValue) = "13"
and
data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[$var]) = "TRUE")
then "Y"
else 
"N"</con5:xqueryText>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:assign varName="eMailFlightInfoFlag">
                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5494689221137924908-23c42e46.13b17add453.-7f8c</con5:id>
                <con2:expr>
                  <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">"Y"</con5:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:default>
          </con2:ifThenElse>
          <con2:replace varName="body" contents-only="true">
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5494689221137924908-23c42e46.13b17add453.-7f8b</con5:id>
            <con2:location>
              <con5:xpathText xmlns:con5="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:eMailFlightInfo</con5:xpathText>
            </con2:location>
            <con2:expr>
              <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$eMailFlightInfoFlag</con5:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:ifThenElse>
            <con5:comment xmlns:con5="http://www.bea.com/wli/sb/stages/config">Check for Household, if nothing, leave as-is</con5:comment>
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-647001423838376665--2691a3a6.13db0bba4a2.-77fb</con5:id>
            <con2:case>
              <con2:condition>
                <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">fn:exists($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[@KeyValue="HHOLD"])</con5:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="HouseholdSize">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-647001423838376665--2691a3a6.13db0bba4a2.-760c</con5:id>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[@KeyValue= "HHOLD"])</con5:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:replace contents-only="true" varName="body">
                  <con5:comment xmlns:con5="http://www.bea.com/wli/sb/stages/config">Replace the householdsize in the synchronize call</con5:comment>
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-647001423838376665--2691a3a6.13db0bba4a2.-7581</con5:id>
                  <con2:location>
                    <con5:xpathText xmlns:con5="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:AYHouseholdSize</con5:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$HouseholdSize</con5:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
            <con2:default/>
          </con2:ifThenElse>
          <con2:ifThenElse>
            <con5:comment xmlns:con5="http://www.bea.com/wli/sb/stages/config">PreferredLanguage code transformation, if it's existing in insert</con5:comment>
            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-647001423838376665--2691a3a6.13db0bba4a2.-7549</con5:id>
            <con2:case>
              <con2:condition>
                <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">fn:exists($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[@KeyValue="PREFLANG"])</con5:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="PreferredLanguageCode_ISO">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-647001423838376665--2691a3a6.13db0bba4a2.-7511</con5:id>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:CustomFields/com:CustomField[@KeyValue= "PREFLANG"])</con5:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:assign varName="PreferredLanguagedvm">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-647001423838376665--2691a3a6.13db0bba4a2.-74d7</con5:id>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<tns:dvm name="preferredlang-dvm" xmlns:tns="http://xmlns.oracle.com/dvm" 

xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
  <tns:description>Preferred Language ISO to Siebel DVM</tns:description>
  <tns:columns>
    <tns:column name="ISOCode"/>
    <tns:column name="SiebelPreferredLangCode"/>
  </tns:columns>
  <tns:rows>
<tns:row>
 <tns:cell>ZH</tns:cell>
 <tns:cell>CHS</tns:cell>
</tns:row>
<tns:row>
 <tns:cell>DA</tns:cell>
 <tns:cell>DAN</tns:cell>
</tns:row>
<tns:row>
 <tns:cell>DE</tns:cell>
 <tns:cell>DEU</tns:cell>
</tns:row>
<tns:row>
 <tns:cell>EN</tns:cell>
 <tns:cell>ENU</tns:cell>
</tns:row>
<tns:row>
 <tns:cell>FI</tns:cell>
 <tns:cell>FIN</tns:cell>
</tns:row>
<tns:row>
 <tns:cell>FR</tns:cell>
 <tns:cell>FRA</tns:cell>
</tns:row>
<tns:row>
 <tns:cell>IT</tns:cell>
 <tns:cell>ITA</tns:cell>
</tns:row>
<tns:row>
 <tns:cell>JA</tns:cell>
 <tns:cell>JPN</tns:cell>
</tns:row>
<tns:row>
 <tns:cell>KO</tns:cell>
 <tns:cell>KOR</tns:cell>
</tns:row>
<tns:row>
 <tns:cell>SV</tns:cell>
 <tns:cell>SVE</tns:cell>
</tns:row>
<tns:row>
 <tns:cell>SE</tns:cell>
 <tns:cell>SVE</tns:cell>
</tns:row>
<tns:row>
 <tns:cell>NO</tns:cell>
 <tns:cell>NOR</tns:cell>
</tns:row>
<tns:row>
 <tns:cell>PL</tns:cell>
 <tns:cell>POL</tns:cell>
</tns:row>
<tns:row>
 <tns:cell>RU</tns:cell>
 <tns:cell>RUS</tns:cell>
</tns:row>
</tns:rows>
</tns:dvm>]]></con5:xqueryText>
                  </con2:expr>
                </con2:assign>
                <con2:assign varName="PreferredLanguageCode">
                  <con5:comment xmlns:con5="http://www.bea.com/wli/sb/stages/config">Call the dvm function for mapping language from ISO -> Siebel PreferredLanguage picklist</con5:comment>
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-647001423838376665--2691a3a6.13db0bba4a2.-7483</con5:id>
                  <con2:expr>
                    <con5:xqueryTransform xmlns:con5="http://www.bea.com/wli/sb/stages/config">
                      <con5:resource ref="MemberProfileProcessing/transformations/InsertDVM"/>
                      <con5:param name="targetColumnName">
                        <con5:path>"SiebelPreferredLangCode"</con5:path>
                      </con5:param>
                      <con5:param name="dvmTable">
                        <con5:path>$PreferredLanguagedvm</con5:path>
                      </con5:param>
                      <con5:param name="defaultValue">
                        <con5:path>"ENU"</con5:path>
                      </con5:param>
                      <con5:param name="sourceColumnName">
                        <con5:path>"ISOCode"</con5:path>
                      </con5:param>
                      <con5:param name="sourceValue">
                        <con5:path>$PreferredLanguageCode_ISO</con5:path>
                      </con5:param>
                    </con5:xqueryTransform>
                  </con2:expr>
                </con2:assign>
                <con2:replace varName="body" contents-only="true">
                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-647001423838376665--2691a3a6.13db0bba4a2.-74f4</con5:id>
                  <con2:location>
                    <con5:xpathText xmlns:con5="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:PreferredLanguageCode</con5:xpathText>
                  </con2:location>
                  <con2:expr>
                    <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">$PreferredLanguageCode</con5:xqueryText>
                  </con2:expr>
                </con2:replace>
              </con2:actions>
            </con2:case>
            <con2:default/>
          </con2:ifThenElse>
          <con:assign varName="ListofLoyMemberChildrenBirthYear" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con1:id xmlns:con1="http://www.bea.com/wli/sb/stages/config">_ActionId-13657921378182049-3a60c6b6.12a21b49249.-7fd6</con1:id>
            <con:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config"><![CDATA[<ayr:ListOfAyLoyMemberChildrenBirthYear>

{

for $var in (1 to fn:count($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:RelatedTraveler[@Relation="child"]))
return



                    <ayr:AyLoyMemberChildrenBirthYear>
                        <ayr:Id>{$var}</ayr:Id>
                        <ayr:AYChildBirthYear>{fn:year-from-date($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:RelatedTraveler[$var]/@BirthDate)}</ayr:AYChildBirthYear>
                        <ayr:MemberId>{data($body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:LoyaltyMemberId2)}</ayr:MemberId>
                        <ayr:Name>{$var}</ayr:Name>
                        <ayr:Type>Children_Birth_Year</ayr:Type>
                     </ayr:AyLoyMemberChildrenBirthYear>

}
</ayr:ListOfAyLoyMemberChildrenBirthYear>]]></con:xqueryText>
            </con:expr>
          </con:assign>
          <con2:replace varName="body" contents-only="false">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-5261270935375145941-4cb03e3d.12a3114c13c.-7f64</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfAyLoyMemberChildrenBirthYear</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$ListofLoyMemberChildrenBirthYear</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:assign varName="HobbyDVM">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8451311533093584975--6f50587b.12aef9427b6.-7f3b</con4:id>
            <con2:expr>
              <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config"><![CDATA[<tns:dvm name="Hobbies-dvm" xmlns:tns="http://xmlns.oracle.com/dvm" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
  <tns:description>Hobbies DVM</tns:description>
  <tns:columns>
    <tns:column name="HobbyName"/>
    <tns:column name="HobbyID"/>
  </tns:columns>
  <tns:rows>

<tns:row>
	<tns:cell>Museum / Art galleries</tns:cell>
	<tns:cell>MT</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Opera / Concerts / Ballet</tns:cell>
	<tns:cell>OK</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Theater and Musicals</tns:cell>
	<tns:cell>TM</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Popular Music</tns:cell>
	<tns:cell>KM</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Classical Music</tns:cell>
	<tns:cell>MS</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Jazz</tns:cell>
	<tns:cell>JZ</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Food &amp; Wine</tns:cell>
	<tns:cell>RV</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Health and Spa holidays</tns:cell>
	<tns:cell>TK</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Golf</tns:cell>
	<tns:cell>GO</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Tennis</tns:cell>
	<tns:cell>TE</tns:cell>
</tns:row>

<tns:row>
	<tns:cell>Sailing</tns:cell>
	<tns:cell>PU</tns:cell>
</tns:row>

<tns:row>
	<tns:cell>Watersports</tns:cell>
	<tns:cell>VE</tns:cell>
</tns:row>

<tns:row>
	<tns:cell>Diving</tns:cell>
	<tns:cell>SU</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Horse riding / Trotting</tns:cell>
	<tns:cell>RR</tns:cell>
</tns:row>

<tns:row>
	<tns:cell>Cross-country skiing</tns:cell>
	<tns:cell>MU</tns:cell>
</tns:row>

<tns:row>
	<tns:cell>Hunting</tns:cell>
	<tns:cell>ME</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Fishing</tns:cell>
	<tns:cell>KA</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Ice hockey</tns:cell>
	<tns:cell>JK</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Football</tns:cell>
	<tns:cell>JA</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Basketball</tns:cell>
	<tns:cell>KO</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Car and Motor Sports</tns:cell>
	<tns:cell>AU</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Alpine Skiing / Telemark</tns:cell>
	<tns:cell>LA</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Snowboarding</tns:cell>
	<tns:cell>SB</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Design</tns:cell>
	<tns:cell>DE</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Technology &amp; Computers</tns:cell>
	<tns:cell>TC</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Photography</tns:cell>
	<tns:cell>PH</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Nature</tns:cell>
	<tns:cell>NA</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Food &amp; Drink</tns:cell>
	<tns:cell>FOD</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Sport &amp; Exercise</tns:cell>
	<tns:cell>SPE</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Music &amp; Entertainment</tns:cell>
	<tns:cell>MUE</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Beauty &amp; Fashion</tns:cell>
	<tns:cell>BEF</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Home &amp; Decoration</tns:cell>
	<tns:cell>HOD</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Environment &amp; Social Responsib</tns:cell>
	<tns:cell>ENR</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Business life</tns:cell>
	<tns:cell>BUL</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Health &amp; Wellbeing</tns:cell>
	<tns:cell>HEW</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Hotels</tns:cell>
	<tns:cell>HOT</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Car rental</tns:cell>
	<tns:cell>CAR</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>City holidays</tns:cell>
	<tns:cell>CIH</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Beach holidays</tns:cell>
	<tns:cell>BEH</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Spa holidays</tns:cell>
	<tns:cell>SPH</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Active holidays</tns:cell>
	<tns:cell>ACH</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Tour holidays</tns:cell>
	<tns:cell>TOH</tns:cell>
</tns:row>
<tns:row>
	<tns:cell>Cruises</tns:cell>
	<tns:cell>CRU</tns:cell>
</tns:row>
  </tns:rows>
</tns:dvm>]]></con5:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="Hobbies">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8451311533093584975--6f50587b.12aef9427b6.-7f3a</con4:id>
            <con2:expr>
              <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                <con:resource ref="MemberProfileProcessing/transformations/XQ_Hobby"/>
                <con:param name="PrimaryContactID">
                  <con:path>$body/asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:PrimaryContactId/text()</con:path>
                </con:param>
                <con:param name="InsertNewMember">
                  <con:path>$Request/*</con:path>
                </con:param>
                <con:param name="HobbyDVM">
                  <con:path>$HobbyDVM</con:path>
                </con:param>
              </con:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:replace varName="body" contents-only="false">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8451311533093584975--6f50587b.12aef9427b6.-7f48</con4:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfEautoContactHobby</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Hobbies</con:xqueryText>
            </con2:expr>
          </con2:replace>
        </con:actions>
      </con:stage>
      <con:stage name="Synchronizing" errorHandler="_onErrorHandler-979274265589350622--5619026e.14395f0c225.-7fc9" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
        <con:comment>Service Callout to AYLoyMemberPortal.Synchronize. This Service will Synchronize portal values in Siebel Database.</con:comment>
        <con:context>
          <con3:userNsDecl prefix="ayr" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con3:userNsDecl prefix="asi" namespace="http://siebel.com/asi/" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con2:rename varName="body">
            <con4:comment xmlns:con4="http://www.bea.com/wli/sb/stages/config">Changing the namespace from QuerybyExampleFullMember to Synchronise</con4:comment>
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-1987456877628131841--3a2b7d0e.12bf667a2ff.-7fd1</con3:id>
            <con2:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./asi:QuerybyExampleFullMemberResponse</con:xpathText>
            </con2:location>
            <con2:localname>Synchronize</con2:localname>
          </con2:rename>
          <con2:wsCallout>
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-2213640281224819431-30cc04e1.12a3b655063.-7f8c</con3:id>
            <con2:service ref="MemberProfileProcessing/businessservices/AYLoyMemberPortal" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con2:operation>Synchronize</con2:operation>
            <con2:request>
              <con2:body wrapped="true">$body</con2:body>
              <con2:header/>
            </con2:request>
            <con2:response>
              <con2:body wrapped="true">body</con2:body>
              <con2:header/>
            </con2:response>
            <con2:requestTransform>
              <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7df1</con5:id>
                <con4:logLevel>info</con4:logLevel>
                <con4:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                </con4:expr>
                <con4:message>Logging Synchronizing Request</con4:message>
              </con4:log>
              <con2:delete varName="header">
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-2041694110763451302--16168512.131fb1161ef.-7f35</con4:id>
                <con2:location>
                  <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./*</con:xpathText>
                </con2:location>
              </con2:delete>
              <con2:assign varName="SiebelRequest">
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7f09</con4:id>
                <con2:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:requestTransform>
            <con2:responseTransform>
              <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7df0</con5:id>
                <con4:logLevel>debug</con4:logLevel>
                <con4:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                </con4:expr>
                <con4:message>Logging Synchronizing Request To Synchronizing Response</con4:message>
              </con4:log>
              <con2:ifThenElse>
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8963622514322013752-7c9f2332.12a45f93d1a.-7f8c</con4:id>
                <con2:case>
                  <con2:condition>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn:local-name($body/*[1])='Fault'</con:xqueryText>
                  </con2:condition>
                  <con2:actions>
                    <con2:Error>
                      <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-8963622514322013752-7c9f2332.12a45f93d1a.-7f8b</con4:id>
                      <con2:errCode>53</con2:errCode>
                      <con2:message>Error in Synchronizing</con2:message>
                    </con2:Error>
                  </con2:actions>
                </con2:case>
              </con2:ifThenElse>
            </con2:responseTransform>
          </con2:wsCallout>
        </con:actions>
      </con:stage>
      <con3:stage name="Portal To AYLoyMemberInterest">
        <con3:comment>Request Transformation for AYLoyMemberInterest.InsertorUpdateInterests. Will take custom fields as input and will return success.</con3:comment>
        <con3:context>
          <con:userNsDecl prefix="asi" namespace="www.a.com"/>
          <con:userNsDecl prefix="ayr" namespace="www.b.com"/>
          <con:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/"/>
          <con:varNsDecl prefix="com" namespace="http://com.finnair"/>
        </con3:context>
        <con3:actions>
          <con2:assign varName="InsertInterestRequest" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-4692636929491907157--1393041b.12a5f7e7df5.-7f7c</con4:id>
            <con2:expr>
              <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                <con:resource ref="MemberProfileProcessing/transformations/XQ_Req_AYLoyMemberInterestInsert"/>
                <con:param name="InsertNewMember">
                  <con:path>$Request/*</con:path>
                </con:param>
                <con:param name="MID">
                  <con:path>$MemberNumber</con:path>
                </con:param>
              </con:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con:replace varName="body" contents-only="false" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
            <con1:id xmlns:con1="http://www.bea.com/wli/sb/stages/config">_ActionId-4692636929491907157--1393041b.12a5f7e7df5.-7fdf</con1:id>
            <con:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./*</con:xpathText>
            </con:location>
            <con:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$InsertInterestRequest</con:xqueryText>
            </con:expr>
          </con:replace>
        </con3:actions>
      </con3:stage>
      <con3:stage name="Inserting Interests" errorHandler="_onErrorHandler-5919623691570703387-149a5246.1440b6ce256.-6de5">
        <con3:comment>Service Callout to AYLoyMemberInterest.InsertorUpdateInterests. This service will add Interest details for the new Member.</con3:comment>
        <con3:context>
          <con:userNsDecl prefix="ayr" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal"/>
          <con:userNsDecl prefix="asi" namespace="http://siebel.com/asi/"/>
          <con:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/"/>
          <con:varNsDecl prefix="com" namespace="http://com.finnair"/>
        </con3:context>
        <con3:actions>
          <con2:wsCallout>
            <con:id>_ActionId-4692636929491907157--1393041b.12a5f7e7df5.-7fde</con:id>
            <con2:service ref="MemberProfileProcessing/businessservices/AYLoyMemberInterest" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con2:operation>InsertOrUpdateInterest</con2:operation>
            <con2:request>
              <con2:body wrapped="true">$body</con2:body>
              <con2:header/>
            </con2:request>
            <con2:response>
              <con2:body wrapped="true">body</con2:body>
              <con2:header/>
            </con2:response>
            <con2:requestTransform>
              <con4:log xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7def</con5:id>
                <con4:logLevel>info</con4:logLevel>
                <con4:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                </con4:expr>
                <con4:message>Logging InsertOrUpdateInterest Request</con4:message>
              </con4:log>
              <con2:delete varName="header">
                <con:id>_ActionId-2041694110763451302--16168512.131fb1161ef.-7f34</con:id>
                <con2:location>
                  <con:xpathText>./*</con:xpathText>
                </con2:location>
              </con2:delete>
            </con2:requestTransform>
            <con2:responseTransform>
              <con4:log xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7dee</con5:id>
                <con4:logLevel>debug</con4:logLevel>
                <con4:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                </con4:expr>
                <con4:message>Logging InsertOrUpdateInterest Request To InsertOrUpdateInterest Response.</con4:message>
              </con4:log>
              <con2:ifThenElse>
                <con:id>_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7fd2</con:id>
                <con2:case>
                  <con2:condition>
                    <con:xqueryText>fn:local-name($body/*[1])='Fault'</con:xqueryText>
                  </con2:condition>
                  <con2:actions>
                    <con2:Error>
                      <con:id>_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7fd1</con:id>
                      <con2:errCode>0000</con2:errCode>
                      <con2:message>Siebel Backend Error</con2:message>
                    </con2:Error>
                  </con2:actions>
                </con2:case>
              </con2:ifThenElse>
            </con2:responseTransform>
          </con2:wsCallout>
        </con3:actions>
      </con3:stage>
      <con:stage name="Portal To FPlusApp Servlet" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
        <con:comment>Creating URL for FPlusAppServlet.</con:comment>
        <con:context>
          <con3:varNsDecl prefix="ayr" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con3:varNsDecl prefix="asi" namespace="http://siebel.com/asi/" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con1:variable name="Siebel" path="$Siebel">
            <con1:service operation="QuerybyExampleFullMember">
              <con1:business ref="MemberProfileProcessing/businessservices/AYLoyMemberPortal"/>
            </con1:service>
          </con1:variable>
          <con1:variable name="Siebel2" path="$Siebel2">
            <con1:service operation="Synchronize">
              <con1:business ref="MemberProfileRetrieve/businessservices/AYLoyMemberPortal"/>
            </con1:service>
          </con1:variable>
        </con:context>
        <con:actions>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7f1a</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$SiebelRequest/asi:Synchronize/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[ayr:AddressType="Home"]</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="HomeFlag">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7f19</con4:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">"Y"</con:xqueryText>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:assign varName="HomeFlag">
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7f18</con4:id>
                <con2:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">"N"</con:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:default>
          </con2:ifThenElse>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7efa</con4:id>
            <con2:case>
              <con2:condition>
                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$SiebelRequest/asi:Synchronize/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:ListOfContact/ayr:Contact/ayr:ListOfPersonalAddress/ayr:PersonalAddress[ayr:AddressType="Job"]</con:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="JobFlag">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7ef9</con4:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">"Y"</con:xqueryText>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:assign varName="JobFlag">
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7ef8</con4:id>
                <con2:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">"N"</con:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:default>
          </con2:ifThenElse>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7f68</con4:id>
            <con2:case>
              <con2:condition>
                <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                  <con4:compExpr operator="=">
                    <con4:leftPath>data($SuppressSMSPromos)</con4:leftPath>
                    <con4:rightPath>"N"</con4:rightPath>
                  </con4:compExpr>
                </con4:xqueryConditionExpr>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="SuppressSMSPromos">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7f67</con4:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">"Y"</con:xqueryText>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:assign varName="SuppressSMSPromos">
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7f66</con4:id>
                <con2:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">"N"</con:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:default>
          </con2:ifThenElse>
          <con2:ifThenElse>
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7f65</con4:id>
            <con2:case>
              <con2:condition>
                <con4:xqueryConditionExpr xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                  <con4:compExpr operator="=">
                    <con4:leftPath>data($SuppresseMailWeeklyOffers)</con4:leftPath>
                    <con4:rightPath>"N"</con4:rightPath>
                  </con4:compExpr>
                </con4:xqueryConditionExpr>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="SuppresseMailWeeklyOffers">
                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7f64</con4:id>
                  <con2:expr>
                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">"Y"</con:xqueryText>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:assign varName="SuppresseMailWeeklyOffers">
                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7f63</con4:id>
                <con2:expr>
                  <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">"N"</con:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:default>
          </con2:ifThenElse>
          <con2:assign varName="RelatedBirthDate">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-8227967121587516870-3f186feb.12a363afb37.-7fcd</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn:concat(
fn:substring(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/@BirthDate),1,4),

fn:substring(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/@BirthDate),6,2),

fn:substring(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/@BirthDate),9,2)
)</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="BVServletDVM">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-8227967121587516870-3f186feb.12a363afb37.-7fae</con3:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config"><![CDATA[<tns:dvm name="country-dvm" xmlns:tns="http://xmlns.oracle.com/dvm" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" >
  <tns:description>Country DVM</tns:description>
  <tns:columns>
    <tns:column name="Input"/>
    <tns:column name="Output"/>
  </tns:columns>
  <tns:rows>

<tns:row>
<tns:cell>GG</tns:cell>
<tns:cell>-</tns:cell>
</tns:row>

<tns:row>
<tns:cell>NotMentioned</tns:cell>
<tns:cell>FIN</tns:cell>
</tns:row>


<tns:row>
<tns:cell>AW</tns:cell>
<tns:cell>ABW</tns:cell>
</tns:row>

<tns:row>
<tns:cell>AF</tns:cell>
<tns:cell>AFG</tns:cell>
</tns:row>

<tns:row>
<tns:cell>AO</tns:cell>
<tns:cell>AGO</tns:cell>
</tns:row>

<tns:row>
<tns:cell>AI</tns:cell>
<tns:cell>AIA</tns:cell>
</tns:row>

<tns:row>
<tns:cell>AX</tns:cell>
<tns:cell>ALA</tns:cell>
</tns:row>

<tns:row>
<tns:cell>AL</tns:cell>
<tns:cell>ALB</tns:cell>
</tns:row>

<tns:row>
<tns:cell>AD</tns:cell>
<tns:cell>AND</tns:cell>
</tns:row>

<tns:row>
<tns:cell>AN</tns:cell>
<tns:cell>ANT</tns:cell>
</tns:row>

<tns:row>
<tns:cell>AE</tns:cell>
<tns:cell>ARE</tns:cell>
</tns:row>

<tns:row>
<tns:cell>AR</tns:cell>
<tns:cell>ARG</tns:cell>
</tns:row>

<tns:row>
<tns:cell>AM</tns:cell>
<tns:cell>ARM</tns:cell>
</tns:row>

<tns:row>
<tns:cell>AS</tns:cell>
<tns:cell>ASM</tns:cell>
</tns:row>

<tns:row>
<tns:cell>AQ</tns:cell>
<tns:cell>ATA</tns:cell>
</tns:row>

<tns:row>
<tns:cell>TF</tns:cell>
<tns:cell>ATF</tns:cell>
</tns:row>

<tns:row>
<tns:cell>AG</tns:cell>
<tns:cell>ATG</tns:cell>
</tns:row>

<tns:row>
<tns:cell>AU</tns:cell>
<tns:cell>AUS</tns:cell>
</tns:row>

<tns:row>
<tns:cell>AT</tns:cell>
<tns:cell>AUT</tns:cell>
</tns:row>

<tns:row>
<tns:cell>AZ</tns:cell>
<tns:cell>AZE</tns:cell>
</tns:row>

<tns:row>
<tns:cell>BI</tns:cell>
<tns:cell>BDI</tns:cell>
</tns:row>

<tns:row>
<tns:cell>BE</tns:cell>
<tns:cell>BEL</tns:cell>
</tns:row>

<tns:row>
<tns:cell>BJ</tns:cell>
<tns:cell>BEN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>BF</tns:cell>
<tns:cell>BFA</tns:cell>
</tns:row>

<tns:row>
<tns:cell>BD</tns:cell>
<tns:cell>BGD</tns:cell>
</tns:row>

<tns:row>
<tns:cell>BG</tns:cell>
<tns:cell>BGR</tns:cell>
</tns:row>

<tns:row>
<tns:cell>BH</tns:cell>
<tns:cell>BHR</tns:cell>
</tns:row>

<tns:row>
<tns:cell>BS</tns:cell>
<tns:cell>BHS</tns:cell>
</tns:row>

<tns:row>
<tns:cell>BA</tns:cell>
<tns:cell>BIH</tns:cell>
</tns:row>

<tns:row>
<tns:cell>BL</tns:cell>
<tns:cell>BLM</tns:cell>
</tns:row>

<tns:row>
<tns:cell>BY</tns:cell>
<tns:cell>BLR</tns:cell>
</tns:row>

<tns:row>
<tns:cell>BZ</tns:cell>
<tns:cell>BLZ</tns:cell>
</tns:row>

<tns:row>
<tns:cell>BM</tns:cell>
<tns:cell>BMU</tns:cell>
</tns:row>

<tns:row>
<tns:cell>BO</tns:cell>
<tns:cell>BOL</tns:cell>
</tns:row>

<tns:row>
<tns:cell>BR</tns:cell>
<tns:cell>BRA</tns:cell>
</tns:row>

<tns:row>
<tns:cell>BB</tns:cell>
<tns:cell>BRB</tns:cell>
</tns:row>

<tns:row>
<tns:cell>BN</tns:cell>
<tns:cell>BRN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>BT</tns:cell>
<tns:cell>BTN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>BW</tns:cell>
<tns:cell>BWA</tns:cell>
</tns:row>

<tns:row>
<tns:cell>BV</tns:cell>
<tns:cell>BVT</tns:cell>
</tns:row>

<tns:row>
<tns:cell>CF</tns:cell>
<tns:cell>CAF</tns:cell>
</tns:row>

<tns:row>
<tns:cell>CA</tns:cell>
<tns:cell>CAN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>CC</tns:cell>
<tns:cell>CCK</tns:cell>
</tns:row>

<tns:row>
<tns:cell>CH</tns:cell>
<tns:cell>CHE</tns:cell>
</tns:row>

<tns:row>
<tns:cell>CL</tns:cell>
<tns:cell>CHL</tns:cell>
</tns:row>

<tns:row>
<tns:cell>CN</tns:cell>
<tns:cell>CHN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>CI</tns:cell>
<tns:cell>CIV</tns:cell>
</tns:row>

<tns:row>
<tns:cell>CM</tns:cell>
<tns:cell>CMR</tns:cell>
</tns:row>

<tns:row>
<tns:cell>CD</tns:cell>
<tns:cell>COD</tns:cell>
</tns:row>

<tns:row>
<tns:cell>CG</tns:cell>
<tns:cell>COG</tns:cell>
</tns:row>

<tns:row>
<tns:cell>CK</tns:cell>
<tns:cell>COK</tns:cell>
</tns:row>

<tns:row>
<tns:cell>CO</tns:cell>
<tns:cell>COL</tns:cell>
</tns:row>

<tns:row>
<tns:cell>KM</tns:cell>
<tns:cell>COM</tns:cell>
</tns:row>

<tns:row>
<tns:cell>CV</tns:cell>
<tns:cell>CPV</tns:cell>
</tns:row>

<tns:row>
<tns:cell>CR</tns:cell>
<tns:cell>CRI</tns:cell>
</tns:row>

<tns:row>
<tns:cell>CU</tns:cell>
<tns:cell>CUB</tns:cell>
</tns:row>

<tns:row>
<tns:cell>CX</tns:cell>
<tns:cell>CXR</tns:cell>
</tns:row>

<tns:row>
<tns:cell>KY</tns:cell>
<tns:cell>CYM</tns:cell>
</tns:row>

<tns:row>
<tns:cell>CY</tns:cell>
<tns:cell>CYP</tns:cell>
</tns:row>

<tns:row>
<tns:cell>CZ</tns:cell>
<tns:cell>CZE</tns:cell>
</tns:row>

<tns:row>
<tns:cell>DE</tns:cell>
<tns:cell>DEU</tns:cell>
</tns:row>

<tns:row>
<tns:cell>DJ</tns:cell>
<tns:cell>DJI</tns:cell>
</tns:row>

<tns:row>
<tns:cell>DM</tns:cell>
<tns:cell>DMA</tns:cell>
</tns:row>

<tns:row>
<tns:cell>DK</tns:cell>
<tns:cell>DNK</tns:cell>
</tns:row>

<tns:row>
<tns:cell>DO</tns:cell>
<tns:cell>DOM</tns:cell>
</tns:row>

<tns:row>
<tns:cell>DZ</tns:cell>
<tns:cell>DZA</tns:cell>
</tns:row>

<tns:row>
<tns:cell>EC</tns:cell>
<tns:cell>ECU</tns:cell>
</tns:row>

<tns:row>
<tns:cell>EG</tns:cell>
<tns:cell>EGY</tns:cell>
</tns:row>

<tns:row>
<tns:cell>ER</tns:cell>
<tns:cell>ERI</tns:cell>
</tns:row>

<tns:row>
<tns:cell>EH</tns:cell>
<tns:cell>ESH</tns:cell>
</tns:row>

<tns:row>
<tns:cell>ES</tns:cell>
<tns:cell>ESP</tns:cell>
</tns:row>

<tns:row>
<tns:cell>EE</tns:cell>
<tns:cell>EST</tns:cell>
</tns:row>

<tns:row>
<tns:cell>ET</tns:cell>
<tns:cell>ETH</tns:cell>
</tns:row>

<tns:row>
<tns:cell>FI</tns:cell>
<tns:cell>FIN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>FJ</tns:cell>
<tns:cell>FJI</tns:cell>
</tns:row>

<tns:row>
<tns:cell>FK</tns:cell>
<tns:cell>FLK</tns:cell>
</tns:row>

<tns:row>
<tns:cell>FR</tns:cell>
<tns:cell>FRA</tns:cell>
</tns:row>

<tns:row>
<tns:cell>FO</tns:cell>
<tns:cell>FRO</tns:cell>
</tns:row>

<tns:row>
<tns:cell>FM</tns:cell>
<tns:cell>FSM</tns:cell>
</tns:row>

<tns:row>
<tns:cell>GA</tns:cell>
<tns:cell>GAB</tns:cell>
</tns:row>

<tns:row>
<tns:cell>GB</tns:cell>
<tns:cell>GBR</tns:cell>
</tns:row>

<tns:row>
<tns:cell>GE</tns:cell>
<tns:cell>GEO</tns:cell>
</tns:row>

<tns:row>
<tns:cell>GH</tns:cell>
<tns:cell>GHA</tns:cell>
</tns:row>

<tns:row>
<tns:cell>GI</tns:cell>
<tns:cell>GIB</tns:cell>
</tns:row>

<tns:row>
<tns:cell>GN</tns:cell>
<tns:cell>GIN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>GP</tns:cell>
<tns:cell>GLP</tns:cell>
</tns:row>

<tns:row>
<tns:cell>GM</tns:cell>
<tns:cell>GMB</tns:cell>
</tns:row>

<tns:row>
<tns:cell>GW</tns:cell>
<tns:cell>GNB</tns:cell>
</tns:row>

<tns:row>
<tns:cell>GQ</tns:cell>
<tns:cell>GNQ</tns:cell>
</tns:row>

<tns:row>
<tns:cell>GR</tns:cell>
<tns:cell>GRC</tns:cell>
</tns:row>

<tns:row>
<tns:cell>GD</tns:cell>
<tns:cell>GRD</tns:cell>
</tns:row>

<tns:row>
<tns:cell>GL</tns:cell>
<tns:cell>GRL</tns:cell>
</tns:row>

<tns:row>
<tns:cell>GT</tns:cell>
<tns:cell>GTM</tns:cell>
</tns:row>

<tns:row>
<tns:cell>GF</tns:cell>
<tns:cell>GUF</tns:cell>
</tns:row>

<tns:row>
<tns:cell>GU</tns:cell>
<tns:cell>GUM</tns:cell>
</tns:row>

<tns:row>
<tns:cell>GY</tns:cell>
<tns:cell>GUY</tns:cell>
</tns:row>

<tns:row>
<tns:cell>HK</tns:cell>
<tns:cell>HKG</tns:cell>
</tns:row>

<tns:row>
<tns:cell>HM</tns:cell>
<tns:cell>HMD</tns:cell>
</tns:row>

<tns:row>
<tns:cell>HN</tns:cell>
<tns:cell>HND</tns:cell>
</tns:row>

<tns:row>
<tns:cell>HR</tns:cell>
<tns:cell>HRV</tns:cell>
</tns:row>

<tns:row>
<tns:cell>HT</tns:cell>
<tns:cell>HTI</tns:cell>
</tns:row>

<tns:row>
<tns:cell>HU</tns:cell>
<tns:cell>HUN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>ID</tns:cell>
<tns:cell>IDN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>IM</tns:cell>
<tns:cell>IMN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>IN</tns:cell>
<tns:cell>IND</tns:cell>
</tns:row>

<tns:row>
<tns:cell>IO</tns:cell>
<tns:cell>IOT</tns:cell>
</tns:row>

<tns:row>
<tns:cell>IE</tns:cell>
<tns:cell>IRL</tns:cell>
</tns:row>

<tns:row>
<tns:cell>IR</tns:cell>
<tns:cell>IRN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>IQ</tns:cell>
<tns:cell>IRQ</tns:cell>
</tns:row>

<tns:row>
<tns:cell>IS</tns:cell>
<tns:cell>ISL</tns:cell>
</tns:row>

<tns:row>
<tns:cell>IL</tns:cell>
<tns:cell>ISR</tns:cell>
</tns:row>

<tns:row>
<tns:cell>IT</tns:cell>
<tns:cell>ITA</tns:cell>
</tns:row>

<tns:row>
<tns:cell>JM</tns:cell>
<tns:cell>JAM</tns:cell>
</tns:row>

<tns:row>
<tns:cell>JE</tns:cell>
<tns:cell>JEY</tns:cell>
</tns:row>

<tns:row>
<tns:cell>JO</tns:cell>
<tns:cell>JOR</tns:cell>
</tns:row>

<tns:row>
<tns:cell>JP</tns:cell>
<tns:cell>JPN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>KZ</tns:cell>
<tns:cell>KAZ</tns:cell>
</tns:row>

<tns:row>
<tns:cell>KE</tns:cell>
<tns:cell>KEN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>KG</tns:cell>
<tns:cell>KGZ</tns:cell>
</tns:row>

<tns:row>
<tns:cell>KH</tns:cell>
<tns:cell>KHM</tns:cell>
</tns:row>

<tns:row>
<tns:cell>KI</tns:cell>
<tns:cell>KIR</tns:cell>
</tns:row>

<tns:row>
<tns:cell>KN</tns:cell>
<tns:cell>KNA</tns:cell>
</tns:row>

<tns:row>
<tns:cell>KR</tns:cell>
<tns:cell>KOR</tns:cell>
</tns:row>

<tns:row>
<tns:cell>KW</tns:cell>
<tns:cell>KWT</tns:cell>
</tns:row>

<tns:row>
<tns:cell>LA</tns:cell>
<tns:cell>LAO</tns:cell>
</tns:row>

<tns:row>
<tns:cell>LB</tns:cell>
<tns:cell>LBN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>LR</tns:cell>
<tns:cell>LBR</tns:cell>
</tns:row>

<tns:row>
<tns:cell>LY</tns:cell>
<tns:cell>LBY</tns:cell>
</tns:row>

<tns:row>
<tns:cell>LC</tns:cell>
<tns:cell>LCA</tns:cell>
</tns:row>

<tns:row>
<tns:cell>LI</tns:cell>
<tns:cell>LIE</tns:cell>
</tns:row>

<tns:row>
<tns:cell>LK</tns:cell>
<tns:cell>LKA</tns:cell>
</tns:row>

<tns:row>
<tns:cell>LS</tns:cell>
<tns:cell>LSO</tns:cell>
</tns:row>

<tns:row>
<tns:cell>LT</tns:cell>
<tns:cell>LTU</tns:cell>
</tns:row>

<tns:row>
<tns:cell>LU</tns:cell>
<tns:cell>LUX</tns:cell>
</tns:row>

<tns:row>
<tns:cell>LV</tns:cell>
<tns:cell>LVA</tns:cell>
</tns:row>

<tns:row>
<tns:cell>MO</tns:cell>
<tns:cell>MAC</tns:cell>
</tns:row>

<tns:row>
<tns:cell>MF</tns:cell>
<tns:cell>MAF</tns:cell>
</tns:row>

<tns:row>
<tns:cell>MA</tns:cell>
<tns:cell>MAR</tns:cell>
</tns:row>

<tns:row>
<tns:cell>MC</tns:cell>
<tns:cell>MCO</tns:cell>
</tns:row>

<tns:row>
<tns:cell>MD</tns:cell>
<tns:cell>MDA</tns:cell>
</tns:row>

<tns:row>
<tns:cell>MG</tns:cell>
<tns:cell>MDG</tns:cell>
</tns:row>

<tns:row>
<tns:cell>MV</tns:cell>
<tns:cell>MDV</tns:cell>
</tns:row>

<tns:row>
<tns:cell>MX</tns:cell>
<tns:cell>MEX</tns:cell>
</tns:row>

<tns:row>
<tns:cell>MH</tns:cell>
<tns:cell>MHL</tns:cell>
</tns:row>

<tns:row>
<tns:cell>MK</tns:cell>
<tns:cell>MKD</tns:cell>
</tns:row>

<tns:row>
<tns:cell>ML</tns:cell>
<tns:cell>MLI</tns:cell>
</tns:row>

<tns:row>
<tns:cell>MT</tns:cell>
<tns:cell>MLT</tns:cell>
</tns:row>

<tns:row>
<tns:cell>MM</tns:cell>
<tns:cell>MMR</tns:cell>
</tns:row>

<tns:row>
<tns:cell>ME</tns:cell>
<tns:cell>MNE</tns:cell>
</tns:row>

<tns:row>
<tns:cell>MN</tns:cell>
<tns:cell>MNG</tns:cell>
</tns:row>

<tns:row>
<tns:cell>MP</tns:cell>
<tns:cell>MNP</tns:cell>
</tns:row>

<tns:row>
<tns:cell>MZ</tns:cell>
<tns:cell>MOZ</tns:cell>
</tns:row>

<tns:row>
<tns:cell>MR</tns:cell>
<tns:cell>MRT</tns:cell>
</tns:row>

<tns:row>
<tns:cell>MS</tns:cell>
<tns:cell>MSR</tns:cell>
</tns:row>

<tns:row>
<tns:cell>MQ</tns:cell>
<tns:cell>MTQ</tns:cell>
</tns:row>

<tns:row>
<tns:cell>MU</tns:cell>
<tns:cell>MUS</tns:cell>
</tns:row>

<tns:row>
<tns:cell>MW</tns:cell>
<tns:cell>MWI</tns:cell>
</tns:row>

<tns:row>
<tns:cell>MY</tns:cell>
<tns:cell>MYS</tns:cell>
</tns:row>

<tns:row>
<tns:cell>YT</tns:cell>
<tns:cell>MYT</tns:cell>
</tns:row>

<tns:row>
<tns:cell>NA</tns:cell>
<tns:cell>NAM</tns:cell>
</tns:row>

<tns:row>
<tns:cell>NC</tns:cell>
<tns:cell>NCL</tns:cell>
</tns:row>

<tns:row>
<tns:cell>NE</tns:cell>
<tns:cell>NER</tns:cell>
</tns:row>

<tns:row>
<tns:cell>NF</tns:cell>
<tns:cell>NFK</tns:cell>
</tns:row>

<tns:row>
<tns:cell>NG</tns:cell>
<tns:cell>NGA</tns:cell>
</tns:row>

<tns:row>
<tns:cell>NI</tns:cell>
<tns:cell>NIC</tns:cell>
</tns:row>

<tns:row>
<tns:cell>NU</tns:cell>
<tns:cell>NIU</tns:cell>
</tns:row>

<tns:row>
<tns:cell>NL</tns:cell>
<tns:cell>NLD</tns:cell>
</tns:row>

<tns:row>
<tns:cell>NO</tns:cell>
<tns:cell>NOR</tns:cell>
</tns:row>

<tns:row>
<tns:cell>NP</tns:cell>
<tns:cell>NPL</tns:cell>
</tns:row>

<tns:row>
<tns:cell>NR</tns:cell>
<tns:cell>NRU</tns:cell>
</tns:row>

<tns:row>
<tns:cell>NZ</tns:cell>
<tns:cell>NZL</tns:cell>
</tns:row>

<tns:row>
<tns:cell>OM</tns:cell>
<tns:cell>OMN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>PK</tns:cell>
<tns:cell>PAK</tns:cell>
</tns:row>

<tns:row>
<tns:cell>PA</tns:cell>
<tns:cell>PAN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>PN</tns:cell>
<tns:cell>PCN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>PE</tns:cell>
<tns:cell>PER</tns:cell>
</tns:row>

<tns:row>
<tns:cell>PH</tns:cell>
<tns:cell>PHL</tns:cell>
</tns:row>

<tns:row>
<tns:cell>PW</tns:cell>
<tns:cell>PLW</tns:cell>
</tns:row>

<tns:row>
<tns:cell>PG</tns:cell>
<tns:cell>PNG</tns:cell>
</tns:row>

<tns:row>
<tns:cell>PL</tns:cell>
<tns:cell>POL</tns:cell>
</tns:row>

<tns:row>
<tns:cell>PR</tns:cell>
<tns:cell>PRI</tns:cell>
</tns:row>

<tns:row>
<tns:cell>KP</tns:cell>
<tns:cell>PRK</tns:cell>
</tns:row>

<tns:row>
<tns:cell>PT</tns:cell>
<tns:cell>PRT</tns:cell>
</tns:row>

<tns:row>
<tns:cell>PY</tns:cell>
<tns:cell>PRY</tns:cell>
</tns:row>

<tns:row>
<tns:cell>PS</tns:cell>
<tns:cell>PSE</tns:cell>
</tns:row>

<tns:row>
<tns:cell>PF</tns:cell>
<tns:cell>PYF</tns:cell>
</tns:row>

<tns:row>
<tns:cell>QA</tns:cell>
<tns:cell>QAT</tns:cell>
</tns:row>

<tns:row>
<tns:cell>RE</tns:cell>
<tns:cell>REU</tns:cell>
</tns:row>

<tns:row>
<tns:cell>RO</tns:cell>
<tns:cell>ROU</tns:cell>
</tns:row>

<tns:row>
<tns:cell>RU</tns:cell>
<tns:cell>RUS</tns:cell>
</tns:row>

<tns:row>
<tns:cell>RW</tns:cell>
<tns:cell>RWA</tns:cell>
</tns:row>

<tns:row>
<tns:cell>SA</tns:cell>
<tns:cell>SAU</tns:cell>
</tns:row>

<tns:row>
<tns:cell>SD</tns:cell>
<tns:cell>SDN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>SN</tns:cell>
<tns:cell>SEN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>SG</tns:cell>
<tns:cell>SGP</tns:cell>
</tns:row>

<tns:row>
<tns:cell>GS</tns:cell>
<tns:cell>SGS</tns:cell>
</tns:row>

<tns:row>
<tns:cell>SH</tns:cell>
<tns:cell>SHN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>SJ</tns:cell>
<tns:cell>SJM</tns:cell>
</tns:row>

<tns:row>
<tns:cell>SB</tns:cell>
<tns:cell>SLB</tns:cell>
</tns:row>

<tns:row>
<tns:cell>SL</tns:cell>
<tns:cell>SLE</tns:cell>
</tns:row>

<tns:row>
<tns:cell>SV</tns:cell>
<tns:cell>SLV</tns:cell>
</tns:row>

<tns:row>
<tns:cell>SM</tns:cell>
<tns:cell>SMR</tns:cell>
</tns:row>

<tns:row>
<tns:cell>SO</tns:cell>
<tns:cell>SOM</tns:cell>
</tns:row>

<tns:row>
<tns:cell>PM</tns:cell>
<tns:cell>SPM</tns:cell>
</tns:row>

<tns:row>
<tns:cell>RS</tns:cell>
<tns:cell>SRB</tns:cell>
</tns:row>

<tns:row>
<tns:cell>ST</tns:cell>
<tns:cell>STP</tns:cell>
</tns:row>

<tns:row>
<tns:cell>SR</tns:cell>
<tns:cell>SUR</tns:cell>
</tns:row>

<tns:row>
<tns:cell>SE</tns:cell>
<tns:cell>SWE</tns:cell>
</tns:row>

<tns:row>
<tns:cell>SK</tns:cell>
<tns:cell>SVK</tns:cell>
</tns:row>

<tns:row>
<tns:cell>SI</tns:cell>
<tns:cell>SVN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>SZ</tns:cell>
<tns:cell>SWZ</tns:cell>
</tns:row>

<tns:row>
<tns:cell>SC</tns:cell>
<tns:cell>SYC</tns:cell>
</tns:row>

<tns:row>
<tns:cell>SY</tns:cell>
<tns:cell>SYR</tns:cell>
</tns:row>

<tns:row>
<tns:cell>TC</tns:cell>
<tns:cell>TCA</tns:cell>
</tns:row>

<tns:row>
<tns:cell>TD</tns:cell>
<tns:cell>TCD</tns:cell>
</tns:row>

<tns:row>
<tns:cell>TG</tns:cell>
<tns:cell>TGO</tns:cell>
</tns:row>

<tns:row>
<tns:cell>TH</tns:cell>
<tns:cell>THA</tns:cell>
</tns:row>

<tns:row>
<tns:cell>TJ</tns:cell>
<tns:cell>TJK</tns:cell>
</tns:row>

<tns:row>
<tns:cell>TK</tns:cell>
<tns:cell>TKL</tns:cell>
</tns:row>

<tns:row>
<tns:cell>TM</tns:cell>
<tns:cell>TKM</tns:cell>
</tns:row>

<tns:row>
<tns:cell>TL</tns:cell>
<tns:cell>TLS</tns:cell>
</tns:row>

<tns:row>
<tns:cell>-</tns:cell>
<tns:cell>TMP</tns:cell>
</tns:row>

<tns:row>
<tns:cell>TO</tns:cell>
<tns:cell>TON</tns:cell>
</tns:row>

<tns:row>
<tns:cell>TT</tns:cell>
<tns:cell>TTO</tns:cell>
</tns:row>

<tns:row>
<tns:cell>TN</tns:cell>
<tns:cell>TUN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>TR</tns:cell>
<tns:cell>TUR</tns:cell>
</tns:row>

<tns:row>
<tns:cell>TV</tns:cell>
<tns:cell>TUV</tns:cell>
</tns:row>

<tns:row>
<tns:cell>TW</tns:cell>
<tns:cell>TWN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>TZ</tns:cell>
<tns:cell>TZA</tns:cell>
</tns:row>

<tns:row>
<tns:cell>UG</tns:cell>
<tns:cell>UGA</tns:cell>
</tns:row>

<tns:row>
<tns:cell>UA</tns:cell>
<tns:cell>UKR</tns:cell>
</tns:row>

<tns:row>
<tns:cell>UM</tns:cell>
<tns:cell>UMI</tns:cell>
</tns:row>

<tns:row>
<tns:cell>UY</tns:cell>
<tns:cell>URY</tns:cell>
</tns:row>

<tns:row>
<tns:cell>US</tns:cell>
<tns:cell>USA</tns:cell>
</tns:row>

<tns:row>
<tns:cell>UZ</tns:cell>
<tns:cell>UZB</tns:cell>
</tns:row>

<tns:row>
<tns:cell>VA</tns:cell>
<tns:cell>VAT</tns:cell>
</tns:row>

<tns:row>
<tns:cell>VC</tns:cell>
<tns:cell>VCT</tns:cell>
</tns:row>

<tns:row>
<tns:cell>VE</tns:cell>
<tns:cell>VEN</tns:cell>
</tns:row>

<tns:row>
<tns:cell>VG</tns:cell>
<tns:cell>VGB</tns:cell>
</tns:row>

<tns:row>
<tns:cell>VI</tns:cell>
<tns:cell>VIR</tns:cell>
</tns:row>

<tns:row>
<tns:cell>WF</tns:cell>
<tns:cell>WLF</tns:cell>
</tns:row>

<tns:row>
<tns:cell>VN</tns:cell>
<tns:cell>VNM</tns:cell>
</tns:row>

<tns:row>
<tns:cell>WS</tns:cell>
<tns:cell>WSM</tns:cell>
</tns:row>

<tns:row>
<tns:cell>VU</tns:cell>
<tns:cell>VUT</tns:cell>
</tns:row>

<tns:row>
<tns:cell>YE</tns:cell>
<tns:cell>YEM</tns:cell>
</tns:row>

<tns:row>
<tns:cell>ZA</tns:cell>
<tns:cell>ZAF</tns:cell>
</tns:row>

<tns:row>
<tns:cell>ZM</tns:cell>
<tns:cell>ZMB</tns:cell>
</tns:row>

<tns:row>
<tns:cell>ZW</tns:cell>
<tns:cell>ZWE</tns:cell>
</tns:row>


  </tns:rows>
</tns:dvm>]]></con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="NewCountryCodeHome">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7ee6</con3:id>
            <con2:expr>
              <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                <con:resource ref="MemberProfileProcessing/transformations/InsertDVM"/>
                <con:param name="sourceValue">
                  <con:path>if(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[@UseType="13"]/com:CountryName/@Code)) then
data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[@UseType="13"]/com:CountryName/@Code)
else
"NotMentioned"</con:path>
                </con:param>
                <con:param name="sourceColumnName">
                  <con:path>"Input"</con:path>
                </con:param>
                <con:param name="targetColumnName">
                  <con:path>"Output"</con:path>
                </con:param>
                <con:param name="defaultValue">
                  <con:path>"FIN"</con:path>
                </con:param>
                <con:param name="dvmTable">
                  <con:path>$BVServletDVM</con:path>
                </con:param>
              </con:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="NewCountryCodeJob">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7ec3</con3:id>
            <con2:expr>
              <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                <con:resource ref="MemberProfileProcessing/transformations/InsertDVM"/>
                <con:param name="sourceValue">
                  <con:path>if(data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[@UseType="14"]/com:CountryName/@Code)) then
data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[@UseType="14"]/com:CountryName/@Code)
else
"NotMentioned"</con:path>
                </con:param>
                <con:param name="sourceColumnName">
                  <con:path>"Input"</con:path>
                </con:param>
                <con:param name="targetColumnName">
                  <con:path>"Output"</con:path>
                </con:param>
                <con:param name="defaultValue">
                  <con:path>"FIN"</con:path>
                </con:param>
                <con:param name="dvmTable">
                  <con:path>$BVServletDVM</con:path>
                </con:param>
              </con:xqueryTransform>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="S_ID">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6319566959273206081-2ca6820e.12b66208916.-7f61</con4:id>
            <con2:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">for $var in (1 to fn:count($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:RelatedTraveler))
where data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:RelatedTraveler[$var]/@Relation)="guardian"
return

data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:RelatedTraveler[$var]/com:UniqueID/@ID)</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:ifThenElse>
            <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-1009661500401532016--6b424ea8.1416f1ba539.-75ee</con6:id>
            <con2:case>
              <con2:condition>
                <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">fn:exists($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:LanguageSpoken/@Code) and fn:string-length($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:LanguageSpoken/@Code) gt 0</con6:xqueryText>
              </con2:condition>
              <con2:actions>
                <con2:assign varName="languageCode">
                  <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-1009661500401532016--6b424ea8.1416f1ba539.-75b6</con6:id>
                  <con2:expr>
                    <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">fn:upper-case($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:LanguageSpoken/@Code)</con6:xqueryText>
                  </con2:expr>
                </con2:assign>
              </con2:actions>
            </con2:case>
            <con2:default>
              <con2:assign varName="languageCode">
                <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-1009661500401532016--6b424ea8.1416f1ba539.-757e</con6:id>
                <con2:expr>
                  <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">"EN"</con6:xqueryText>
                </con2:expr>
              </con2:assign>
            </con2:default>
          </con2:ifThenElse>
          <con2:assign varName="Details">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-8227967121587516870-3f186feb.12a363afb37.-7fce</con3:id>
            <con2:expr>
              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config"><![CDATA[let $UseType := data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:Address[*]/@UseType)
let $Customer := $Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer

return

<Details>
<Sex>{if (data($Customer/@Gender)= "Male") then "MR" else if (data($Customer/@Gender)= "Female") then"MS" else "MR"}</Sex>
<BirthDate>{$RelatedBirthDate}</BirthDate>
<FirstName>{data($Customer/com:PersonName/com:GivenName)}</FirstName>
<FqtvNum>{$MemberNumber}</FqtvNum>
<FqtvLevel>BASIC</FqtvLevel>
<LastName>{data($Customer/com:PersonName/com:Surname)}</LastName>
<Nationality>FIN</Nationality>
<PreferredMailingAddress>Y</PreferredMailingAddress>
<PreferredLanguage>{$languageCode}</PreferredLanguage>
<Email>{data($Customer/com:Email)}</Email>
<RulesAccepted>Y</RulesAccepted>
<EmailOffers>{data($SuppresseMailWeeklyOffers)}</EmailOffers>
<SmsOffers>{data($SuppressSMSPromos)}</SmsOffers>
<PartnerOffers>{data($ReceivePartnerPromotionFlag)}</PartnerOffers>
<FlightSms>N</FlightSms>
<FlightEmail>N</FlightEmail>
<PreferredMailType>Y</PreferredMailType>
<FpCustTypeCust>BASIC</FpCustTypeCust>
<Format>XML</Format>
<UserId>{$MemberNumber}</UserId>
<Password>{data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:UserID/@PinNumber)}</Password>
<RegisterUser>Y</RegisterUser>
<MiddleName>{data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:PersonName/com:MiddleName)}</MiddleName>
<Title>{data($Request/prof:InsertNewMember//com:AMA_ProfileCreateRQ/com:Profile/com:Customer/com:EmployeeInfo/@EmployeeTitle)}</Title>
<Street>{if (data($HomeFlag) = "Y") then $PersonalStreetAddressHome else ""}</Street>
(: TODO : do we need $PersonalStreetAddressHome2 here? :)
<BusinessStreet>{if (data($JobFlag) = "Y") then $PersonalStreetAddressJob else ""}</BusinessStreet>
(: TODO : do we need $PersonalStreetAddressJob2 and $PersonalStreetAddressJob3 here? :)
<Zip>{data($Customer/com:Address[@UseType="13"]/com:PostalCode)}</Zip>
<BusinessZip>{data($Customer/com:Address[@UseType="14"]/com:PostalCode)}</BusinessZip>
<Country>{if (data($Customer/com:Address[@UseType="13"]/com:CountryName/@Code)) then $NewCountryCodeHome else ""}</Country>
<BusinessCountry>{if (data($Customer/com:Address[@UseType="14"]/com:CountryName/@Code)) then $NewCountryCodeJob else ""}</BusinessCountry>
<PostOffice>{data($Customer/com:Address[@UseType="13"]/com:PostalCode)}</PostOffice>
<City>{data($Customer/com:Address[@UseType="13"]/com:CityName)}</City>
<State>{data($Customer/com:Address[@UseType="13"]/com:StateProv)}</State>
<MobilePhone>{if (data($PhoneNumber)!= "" and fn:starts-with(data($PhoneNumber),"+")) then 
fn:concat("(",fn:substring($PhoneNumber,1,4),")","(",fn:substring($PhoneNumber,5,2),")",fn:substring($PhoneNumber,7)) 
else if(data($PhoneNumber)!= "" and not(fn:starts-with(data($PhoneNumber),"+"))) then
fn:concat("(","+",fn:substring($PhoneNumber,1,3),")","(",fn:substring($PhoneNumber,4,2),")",fn:substring($PhoneNumber,6)) 
else "(+358)(50)12345678" }</MobilePhone>
<SiteLanguage>{$languageCode}</SiteLanguage>
<S_FirstName>FirstName</S_FirstName>
<S_LastName>LastName</S_LastName>
<S_FqtvNum>{$S_ID}</S_FqtvNum>
</Details>]]></con6:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="ServletRequestBody">
            <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-2213640281224819431-30cc04e1.12a3b655063.-7fb3</con3:id>
            <con2:expr>
              <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                <con:resource ref="MemberProfileProcessing/transformations/XQ_FPlusAppServlet"/>
                <con:param name="details">
                  <con:path>$Details</con:path>
                </con:param>
              </con:xqueryTransform>
            </con2:expr>
          </con2:assign>
        </con:actions>
      </con:stage>
    </con3:pipeline>
    <con3:pipeline name="LinkMemberToPromotion Gateway_response" type="response" xmlns:con3="http://www.bea.com/wli/sb/pipeline/config">
      <con2:stage name="Response Transformation" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/pipeline/config">
        <con2:comment>This stage transforms the siebel response.</con2:comment>
        <con2:context>
          <con1:userNsDecl prefix="SOAP-ENV" namespace="http://schemas.xmlsoap.org/soap/envelope/" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl prefix="ayr" namespace="http://www.siebel.com/xml/AYRES%20Enroll%20Promotion" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl prefix="asi" namespace="http://siebel.com/asi/" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con1:variable name="Siebel-Link" path="$Sibel-Link" xmlns:con1="http://www.bea.com/wli/sb/typesystem/config">
            <con1:service operation="InsertOrUpdateMemberPromotion">
              <con1:business ref="MemberProfileProcessing/businessservices/AYRESEnrollPromotion"/>
            </con1:service>
          </con1:variable>
        </con2:context>
        <con2:actions>
          <con4:replace varName="body" contents-only="false" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3525837289851415380-5b4e4341.12a4b35ae38.-7f33</con2:id>
            <con4:location>
              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./*</con:xpathText>
            </con4:location>
            <con4:expr>
              <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                <con:resource ref="MemberProfileProcessing/transformations/XQ_Res_LinkMemberToPromotion"/>
                <con:param name="MemberNumber">
                  <con:path>$MemberNumber</con:path>
                </con:param>
              </con:xqueryTransform>
            </con4:expr>
          </con4:replace>
        </con2:actions>
      </con2:stage>
      <con3:stage name="Response Logging">
        <con:comment xmlns:con="http://www.bea.com/wli/sb/pipeline/config">This will log the outgoing response to portal.</con:comment>
        <con:context xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
          <con1:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
          <con1:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con1="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
          <con1:log xmlns:con1="http://www.bea.com/wli/sb/stages/logging/config">
            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7eb4</con2:id>
            <con1:logLevel>debug</con1:logLevel>
            <con1:expr>
              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
            </con1:expr>
            <con1:message>Final Response Logging</con1:message>
          </con1:log>
        </con:actions>
      </con3:stage>
    </con3:pipeline>
    <con3:pipeline name="UpdateProfile Gateway_response" type="response" xmlns:con3="http://www.bea.com/wli/sb/pipeline/config">
      <con:stage name="Response Transformation" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
        <con:comment>Transforming back to Portal format</con:comment>
        <con:context>
          <con4:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
          <con4:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
        </con:context>
        <con:actions>
          <con2:replace varName="body" contents-only="true">
            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7562460790438419732-7c536000.12a5adf9ada.-7f1d</con4:id>
            <con2:expr>
              <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                <con:resource ref="MemberProfileProcessing/transformations/XQ_Res_UpdateProfile"/>
                <con:param name="MemberNumber">
                  <con:path>$MemberNumber</con:path>
                </con:param>
              </con:xqueryTransform>
            </con2:expr>
          </con2:replace>
        </con:actions>
      </con:stage>
      <con3:stage name="Monitoring">
        <con3:comment/>
        <con3:context>
          <con:varNsDecl prefix="com" namespace="http://com.finnair"/>
          <con:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/"/>
        </con3:context>
        <con3:actions>
          <con4:route xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config">
            <con:id>_ActionId-4449486212243904989-7fb4642e.136100f27e0.-7fe1</con:id>
            <con4:service ref="GoogleAnalytics/businessservice/Monitoring" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con4:operation>monitor</con4:operation>
            <con4:outboundTransform>
              <con2:replace varName="body" contents-only="true">
                <con:id>_ActionId-4449486212243904989-7fb4642e.136100f27e0.-7fe0</con:id>
                <con2:location>
                  <con:xpathText>.</con:xpathText>
                </con2:location>
                <con2:expr>
                  <con:xqueryTransform>
                    <con:resource ref="GoogleAnalytics/transformations/XQ_Req_Monitoring"/>
                    <con:param name="startTimestamp">
                      <con:path>$startTimestamp</con:path>
                    </con:param>
                    <con:param name="inbound">
                      <con:path>$inbound</con:path>
                    </con:param>
                  </con:xqueryTransform>
                </con2:expr>
              </con2:replace>
            </con4:outboundTransform>
          </con4:route>
        </con3:actions>
      </con3:stage>
    </con3:pipeline>
    <con5:pipeline type="error" name="_onErrorHandler-7181538584930003524--5d62a2e8.143de568622.-7710">
      <con5:stage name="Alerting">
        <con5:comment>Error during update member synchronize call</con5:comment>
        <con5:context/>
        <con5:actions>
          <con4:alert>
            <con:id>_ActionId-7181538584930003524--5d62a2e8.143de568622.-76a2</con:id>
            <con4:destination ref="Common/alerts/DefaultAlerts"/>
            <con4:description>Update member failed</con4:description>
            <con4:severity>warning</con4:severity>
            <con4:payload>
              <con:xsltTransform>
                <con:resource ref="partnerServices/Partners_common/transformations/PrettyPrint"/>
                <con:input>&lt;alertContent>{$MemberNumber}
{$SiebelRequest}
{$fault}
&lt;/alertContent></con:input>
              </con:xsltTransform>
            </con4:payload>
          </con4:alert>
          <con3:log>
            <con:id>_ActionId-7181538584930003524--5d62a2e8.143de568622.-7685</con:id>
            <con3:logLevel>error</con3:logLevel>
            <con3:expr>
              <con:xqueryText>$body</con:xqueryText>
            </con3:expr>
            <con3:message>Error updating member in Synchronize callout.</con3:message>
          </con3:log>
        </con5:actions>
      </con5:stage>
    </con5:pipeline>
    <con5:pipeline type="error" name="_onErrorHandler-7181538584930003524--5d62a2e8.143de568622.-7665">
      <con5:stage name="Alerting">
        <con5:comment>Error during update member synchronize interests call</con5:comment>
        <con5:context/>
        <con5:actions>
          <con4:alert>
            <con:id>_ActionId-7181538584930003524--5d62a2e8.143de568622.-75da</con:id>
            <con4:destination ref="Common/alerts/DefaultAlerts"/>
            <con4:description>Update member interests failed</con4:description>
            <con4:severity>warning</con4:severity>
            <con4:payload>
              <con:xsltTransform>
                <con:resource ref="partnerServices/Partners_common/transformations/PrettyPrint"/>
                <con:input>&lt;alertContent>{$MemberNumber}
{$SiebelRequest}
{$fault}
&lt;/alertContent></con:input>
              </con:xsltTransform>
            </con4:payload>
          </con4:alert>
          <con3:log>
            <con:id>_ActionId-7181538584930003524--5d62a2e8.143de568622.-75bd</con:id>
            <con3:logLevel>error</con3:logLevel>
            <con3:expr>
              <con:xqueryText>$body</con:xqueryText>
            </con3:expr>
            <con3:message>Error updating member in Synchronize interests callout.</con3:message>
          </con3:log>
        </con5:actions>
      </con5:stage>
    </con5:pipeline>
    <con5:pipeline type="error" name="_onErrorHandler-7869801579869266419--6be39981.1419c604389.-7d62">
      <con5:stage name="Set error code">
        <con5:context/>
        <con5:actions>
          <con2:assign varName="errorCode">
            <con:id>_ActionId-7869801579869266419--6be39981.1419c604389.-7cf4</con:id>
            <con2:expr>
              <con:xqueryText>"500"</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="errorMessage">
            <con:id>_ActionId-7869801579869266419--6be39981.1419c604389.-7cd7</con:id>
            <con2:expr>
              <con:xqueryText>"System error during update marketing flags"</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con:resume>
            <con:id>_ActionId-7869801579869266419--6be39981.1419c604389.-7cba</con:id>
          </con:resume>
        </con5:actions>
      </con5:stage>
    </con5:pipeline>
    <con5:pipeline type="request" name="AMAOTAPAS12.2_request">
      <con5:stage name="GetVersionFromRequestAndEnrollmentChannel">
        <con5:context/>
        <con5:actions>
          <con2:assign varName="Version">
            <con:id>_ActionId-241346713932786510--3026e696.1411c0b110c.-7fb3</con:id>
            <con2:expr>
              <con:xqueryText>if ($body//@Version[1]) then $body//@Version[1] else '10.2'</con:xqueryText>
            </con2:expr>
          </con2:assign>
          <con2:assign varName="enrollmentChannel">
            <con:id>_ActionId-3440993053935231252-4b609105.14d291683c7.-74cb</con:id>
            <con2:expr>
              <con:xqueryText>let $headers := $inbound/ctx:transport/ctx:request/tp:headers

let $header1 := data($headers/*:enrollmentChannel[1])
let $header2 := data($headers/tp:user-header[@name = 'enrollmentChannel'][1]/@value)

return
if (exists($header1) and "" != $header1) then
	$header1
else if (exists($header2) and "" != $header2) then
	$header2
else (: default :)
	"Web"</con:xqueryText>
            </con2:expr>
          </con2:assign>
        </con5:actions>
      </con5:stage>
    </con5:pipeline>
    <con5:pipeline type="error" name="_onErrorHandler-979274265589350622--5619026e.14395f0c225.-7fc9">
      <con5:stage name="Set account as deleted">
        <con5:context>
          <con:userNsDecl namespace="http://siebel.com/asi/" prefix="asi"/>
          <con:userNsDecl namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal" prefix="ayr"/>
        </con5:context>
        <con5:actions>
          <con4:alert>
            <con:id>_ActionId-7181538584930003524--5d62a2e8.143de568622.-7764</con:id>
            <con4:destination ref="Common/alerts/DefaultAlerts"/>
            <con4:description>Insert new member failed</con4:description>
            <con4:severity>warning</con4:severity>
            <con4:payload>
              <con:xsltTransform>
                <con:resource ref="partnerServices/Partners_common/transformations/PrettyPrint"/>
                <con:input>&lt;alertContent>{$MemberNumber}
{$SiebelRequest}
{$fault}
&lt;/alertContent></con:input>
              </con:xsltTransform>
            </con4:payload>
          </con4:alert>
          <con3:log>
            <con:id>_ActionId-7181538584930003524--5d62a2e8.143de568622.-7683</con:id>
            <con3:logLevel>error</con3:logLevel>
            <con3:expr>
              <con:xqueryText>$body</con:xqueryText>
            </con3:expr>
            <con3:message>Error in Synchronize callout, deleting inserted user.</con3:message>
          </con3:log>
          <con2:replace varName="querybyExampleFullMemberResponse" contents-only="true">
            <con:id>_ActionId-979274265589350622--5619026e.14395f0c225.-7e7c</con:id>
            <con2:location>
              <con:xpathText>./asi:QuerybyExampleFullMemberResponse/SiebelMessage/ayr:ListOfAyresMemberInformationLongPortal/ayr:LoyMember/ayr:Status</con:xpathText>
            </con2:location>
            <con2:expr>
              <con:xqueryText>"Deleted"</con:xqueryText>
            </con2:expr>
          </con2:replace>
          <con2:rename varName="querybyExampleFullMemberResponse">
            <con:id>_ActionId-979274265589350622--5619026e.14395f0c225.-7eec</con:id>
            <con2:location>
              <con:xpathText>./asi:QuerybyExampleFullMemberResponse</con:xpathText>
            </con2:location>
            <con2:localname>Synchronize</con2:localname>
          </con2:rename>
          <con2:wsCallout>
            <con:id>_ActionId-979274265589350622--5619026e.14395f0c225.-7ecf</con:id>
            <con2:service xsi:type="ref:BusinessServiceRef" ref="MemberProfileProcessing/businessservices/AYLoyMemberPortal" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
            <con2:operation>Synchronize</con2:operation>
            <con2:request>
              <con2:body wrapped="true">$querybyExampleFullMemberResponse</con2:body>
            </con2:request>
            <con2:response>
              <con2:body wrapped="true">synchronizeResponse</con2:body>
            </con2:response>
            <con2:requestTransform/>
            <con2:responseTransform/>
          </con2:wsCallout>
        </con5:actions>
      </con5:stage>
    </con5:pipeline>
    <con5:pipeline type="error" name="_onErrorHandler-5919623691570703387-149a5246.1440b6ce256.-6de5">
      <con5:stage name="Insert interests error handler statge">
        <con5:comment>raise alert and continue</con5:comment>
        <con5:context/>
        <con5:actions>
          <con3:log>
            <con:id>_ActionId-5919623691570703387-149a5246.1440b6ce256.-6d77</con:id>
            <con3:logLevel>error</con3:logLevel>
            <con3:expr>
              <con:xqueryText>$body</con:xqueryText>
            </con3:expr>
            <con3:message>Error in inserting interests.</con3:message>
          </con3:log>
          <con4:alert>
            <con:id>_ActionId-5919623691570703387-149a5246.1440b6ce256.-6d3f</con:id>
            <con4:destination ref="Common/alerts/DefaultAlerts"/>
            <con4:description>Insert new member interests failed</con4:description>
            <con4:severity>warning</con4:severity>
            <con4:payload>
              <con:xsltTransform>
                <con:resource ref="partnerServices/Partners_common/transformations/PrettyPrint"/>
                <con:input>&lt;alertContent>{$MemberNumber}
{$body}
{$fault}
&lt;/alertContent></con:input>
              </con:xsltTransform>
            </con4:payload>
          </con4:alert>
          <con:resume>
            <con:id>_ActionId-5919623691570703387-149a5246.1440b6ce256.-6d22</con:id>
          </con:resume>
        </con5:actions>
      </con5:stage>
    </con5:pipeline>
    <con:flow xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
      <con:pipeline-node name="AMAOTAPAS12.2">
        <con:comment>FCP-1096: Quick fix to support 12.2 version</con:comment>
        <con:request>AMAOTAPAS12.2_request</con:request>
        <con:response>AMAOTAPAS12.2_response</con:response>
      </con:pipeline-node>
      <con:branch-node type="operation" name="MemberProfileProcessing Gateway">
        <con:comment>Gateway to decide the Operation selection</con:comment>
        <con:branch-table>
          <con:branch name="InsertNewMember">
            <con:operator>equals</con:operator>
            <con:value>InsertNewMember</con:value>
            <con:flow>
              <con:pipeline-node name="InsertNewMember Gateway">
                <con:comment/>
                <con:request>InsertNewMember Gateway_request</con:request>
                <con:response>InsertNewMember Gateway_response</con:response>
              </con:pipeline-node>
              <con:route-node name="Online DB">
                <con:comment>It will be online DB call (FPlusApp Servlet)to feed the database with new member's values.</con:comment>
                <con:context>
                  <con4:userNsDecl prefix="ayr" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
                  <con4:userNsDecl prefix="asi" namespace="http://siebel.com/asi/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
                  <con5:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
                  <con5:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                  <con3:route xmlns:con3="http://www.bea.com/wli/sb/stages/routing/config">
                    <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-2213640281224819431-30cc04e1.12a3b655063.-7f88</con4:id>
                    <con3:service ref="MemberProfileProcessing/businessservices/AuthenticationInfoProcessingV2.0FplusAppAdapter" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                    <con3:outboundTransform>
                      <con2:replace varName="body" contents-only="false">
                        <con6:comment xmlns:con6="http://www.bea.com/wli/sb/stages/config">Actual content</con6:comment>
                        <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-357969425817101733-77e4d4d0.14dbe6c0957.-7fc2</con6:id>
                        <con2:location>
                          <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./*</con:xpathText>
                        </con2:location>
                        <con2:expr>
                          <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$ServletRequestBody</con:xqueryText>
                        </con2:expr>
                      </con2:replace>
                      <con4:log xmlns:con3="http://www.bea.com/wli/sb/pipeline/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                        <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-5851458848362856916--7562d388.14e20d83a37.-7cec</con6:id>
                        <con4:logLevel>info</con4:logLevel>
                        <con4:expr>
                          <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">replace($body, '&amp;amp;Password=.*?&amp;amp;RegisterUser=', '&amp;amp;RegisterUser=')</con6:xqueryText>
                        </con4:expr>
                        <con4:message>Logging FPlusAppServlet Request</con4:message>
                      </con4:log>
                      <con2:assign varName="OnlineDB_Request">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5835879807058512110--391911e9.135cce7a3e6.-7fd3</con4:id>
                        <con2:expr>
                          <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                        </con2:expr>
                      </con2:assign>
                      <con2:transport-headers copy-all="false">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-7974903912807021182-de84514.12c342c8883.-7df8</con4:id>
                        <con2:header-set>outbound-request</con2:header-set>
                        <con2:header name="Content-Type" value="expression">
                          <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">"application/x-www-form-urlencoded"</con4:xqueryText>
                        </con2:header>
                      </con2:transport-headers>
                    </con3:outboundTransform>
                    <con3:responseTransform>
                      <con4:log xmlns:con3="http://www.bea.com/wli/sb/pipeline/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7dec</con5:id>
                        <con4:logLevel>debug</con4:logLevel>
                        <con4:expr>
                          <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                        </con4:expr>
                        <con4:message>Logging FPlusAppServlet Response of First call</con4:message>
                      </con4:log>
                      <con2:assign varName="Online_Response">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5835879807058512110--391911e9.135cce7a3e6.-7fcb</con4:id>
                        <con2:expr>
                          <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                        </con2:expr>
                      </con2:assign>
                      <con2:ifThenElse>
                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6765379205593579413-7643eb28.136812aae71.-7d63</con5:id>
                        <con2:case>
                          <con2:condition>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">(data($body/FPApplRS/Error/@value) != "" and data($body/FPApplRS/Error/@value) != "103")</con:xqueryText>
                          </con2:condition>
                          <con2:actions>
                            <con4:alert>
                              <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6765379205593579413-7643eb28.136812aae71.-7d61</con5:id>
                              <con4:destination ref="Common/alerts/DefaultAlerts"/>
                              <con4:description>FPlusAppServlet Response of First call failed</con4:description>
                              <con4:severity>normal</con4:severity>
                              <con4:payload>
                                <con6:xsltTransform xmlns:con6="http://www.bea.com/wli/sb/stages/config">
                                  <con6:resource ref="partnerServices/Partners_common/transformations/PrettyPrint"/>
                                  <con6:input>&lt;alertContent>{$MemberNumber}
{$OnlineDB_Request}
{$Online_Response}
&lt;/alertContent></con6:input>
                                </con6:xsltTransform>
                              </con4:payload>
                            </con4:alert>
                            <con2:Error>
                              <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6765379205593579413-7643eb28.136812aae71.-7d60</con5:id>
                              <con2:errCode>503</con2:errCode>
                              <con2:message>FplussAppServlet error</con2:message>
                            </con2:Error>
                          </con2:actions>
                        </con2:case>
                        <con2:default>
                          <con2:replace varName="body" contents-only="false">
                            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6765379205593579413-7643eb28.136812aae71.-7d5f</con5:id>
                            <con2:location>
                              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./*</con:xpathText>
                            </con2:location>
                            <con2:expr>
                              <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                                <con:resource ref="MemberProfileProcessing/transformations/XQ_Res_InsertNewMember"/>
                                <con:param name="MemberNumber">
                                  <con:path>$MemberNumber</con:path>
                                </con:param>
                              </con:xqueryTransform>
                            </con2:expr>
                          </con2:replace>
                        </con2:default>
                      </con2:ifThenElse>
                      <con2:ifThenElse>
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-2873641054946293496-680bf8b5.12b28ddc85a.-7f96</con4:id>
                        <con2:case>
                          <con2:condition>
                            <con:xqueryConditionExpr xmlns:con="http://www.bea.com/wli/sb/stages/config">
                              <con:boolExpr operator="and">
                                <con:compExpr operator="!=">
                                  <con:leftPath>data($body/FPApplRS/Error/@value)</con:leftPath>
                                  <con:rightPath>""</con:rightPath>
                                </con:compExpr>
                                <con:compExpr operator="!=">
                                  <con:leftPath>data($body/FPApplRS/Error/@value)</con:leftPath>
                                  <con:rightPath>"103"</con:rightPath>
                                </con:compExpr>
                              </con:boolExpr>
                            </con:xqueryConditionExpr>
                          </con2:condition>
                          <con2:actions>
                            <con2:assign varName="Request">
                              <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5835879807058512110--391911e9.135cce7a3e6.-7fd2</con4:id>
                              <con2:expr>
                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$OnlineDB_Request</con:xqueryText>
                              </con2:expr>
                            </con2:assign>
                            <con2:wsCallout>
                              <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5835879807058512110--391911e9.135cce7a3e6.-7fd1</con4:id>
                              <con2:service ref="MemberProfileProcessing/businessservices/FPlusAppServlet" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                              <con2:request>
                                <con2:payload wrapped="true">$Request</con2:payload>
                              </con2:request>
                              <con2:response>
                                <con2:payload wrapped="true">body</con2:payload>
                              </con2:response>
                              <con2:requestTransform>
                                <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5835879807058512110--391911e9.135cce7a3e6.-7fd0</con5:id>
                                  <con4:logLevel>debug</con4:logLevel>
                                  <con4:expr>
                                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$Request</con:xqueryText>
                                  </con4:expr>
                                  <con4:message>Logging FPlusAppServlet Request for Retry Call</con4:message>
                                </con4:log>
                                <con2:transport-headers copy-all="false">
                                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5835879807058512110--391911e9.135cce7a3e6.-7fcf</con4:id>
                                  <con2:header-set>outbound-request</con2:header-set>
                                  <con2:header name="Content-Type" value="expression">
                                    <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">"application/x-www-form-urlencoded"</con4:xqueryText>
                                  </con2:header>
                                </con2:transport-headers>
                              </con2:requestTransform>
                              <con2:responseTransform>
                                <con4:log xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5835879807058512110--391911e9.135cce7a3e6.-7fce</con5:id>
                                  <con4:logLevel>debug</con4:logLevel>
                                  <con4:expr>
                                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                                  </con4:expr>
                                  <con4:message>Logging FPlusAppServlet Response for Retry Call</con4:message>
                                </con4:log>
                                <con2:ifThenElse>
                                  <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-5835879807058512110--391911e9.135cce7a3e6.-7fcd</con4:id>
                                  <con2:case>
                                    <con2:condition>
                                      <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">(data($body/FPApplRS/Error/@value) != "" and data($body/FPApplRS/Error/@value) != "103")</con:xqueryText>
                                    </con2:condition>
                                    <con2:actions>
                                      <con4:alert>
                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6765379205593579413-7643eb28.136812aae71.-7e00</con5:id>
                                        <con4:destination ref="Common/alerts/CriticalAlerts"/>
                                        <con4:description>Retry call to OnlineDB Failed</con4:description>
                                        <con4:severity>critical</con4:severity>
                                        <con4:payload>
                                          <con6:xsltTransform xmlns:con6="http://www.bea.com/wli/sb/stages/config">
                                            <con6:resource ref="partnerServices/Partners_common/transformations/PrettyPrint"/>
                                            <con6:input>&lt;alertContent>{$MemberNumber}
{$Request}
{$body}
&lt;/alertContent></con6:input>
                                          </con6:xsltTransform>
                                        </con4:payload>
                                      </con4:alert>
                                      <con2:Error>
                                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-6765379205593579413-7643eb28.136812aae71.-7dff</con5:id>
                                        <con2:errCode>503</con2:errCode>
                                        <con2:message>FplussAppServlet error</con2:message>
                                      </con2:Error>
                                    </con2:actions>
                                  </con2:case>
                                  <con2:default>
                                    <con2:replace varName="body" contents-only="false">
                                      <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6765379205593579413-7643eb28.136812aae71.-7dfe</con4:id>
                                      <con2:location>
                                        <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./*</con:xpathText>
                                      </con2:location>
                                      <con2:expr>
                                        <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                                          <con:resource ref="MemberProfileProcessing/transformations/XQ_Res_InsertNewMember_FPlus"/>
                                          <con:param name="MemberNumber">
                                            <con:path>$MemberNumber</con:path>
                                          </con:param>
                                        </con:xqueryTransform>
                                      </con2:expr>
                                    </con2:replace>
                                  </con2:default>
                                </con2:ifThenElse>
                              </con2:responseTransform>
                            </con2:wsCallout>
                          </con2:actions>
                        </con2:case>
                      </con2:ifThenElse>
                    </con3:responseTransform>
                  </con3:route>
                </con:actions>
              </con:route-node>
            </con:flow>
          </con:branch>
          <con:branch name="UpdateProfile">
            <con:operator>equals</con:operator>
            <con:value>UpdateProfile</con:value>
            <con:flow>
              <con:pipeline-node name="UpdateProfile Gateway">
                <con:comment/>
                <con:request>UpdateProfile Gateway_request</con:request>
                <con:response>UpdateProfile Gateway_response</con:response>
              </con:pipeline-node>
              <con:route-node name="BV Servlet">
                <con:comment>This will route to BVServlet</con:comment>
                <con:context>
                  <con4:userNsDecl prefix="ayr" namespace="http://www.siebel.com/xml/AYRES%20Member%20Information%20–%20Long%20Portal" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
                  <con4:userNsDecl prefix="asi" namespace="http://siebel.com/asi/" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
                  <con4:userNsDecl prefix="loy" namespace="http://www.siebel.com/xml/LOYMember" xmlns:con4="http://www.bea.com/wli/sb/stages/config"/>
                  <con5:userNsDecl prefix="ay" namespace="http://www.siebel.com/xml/AY%20LOY%20Member%20Int" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
                  <con5:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
                  <con5:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
                </con:context>
                <con:actions>
                  <con4:routingTable xmlns:con4="http://www.bea.com/wli/sb/stages/routing/config">
                    <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5886473718478157716-1f1f0af9.12b4238040e.-7fde</con5:id>
                    <con4:expression>
                      <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">data($Request/prof:UpdateProfile/AMA_UpdateRQ/com:AMA_UpdateRQ/com:Position/com:Root/com:Profile/com:UserID/@PinNumber)</con:xqueryText>
                    </con4:expression>
                    <con4:case>
                      <con4:operator>not equal to</con4:operator>
                      <con4:value>""</con4:value>
                      <con4:route>
                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-5886473718478157716-1f1f0af9.12b4238040e.-7fdf</con5:id>
                        <con4:service ref="MemberProfileProcessing/businessservices/AuthenticationInfoProcessingV2.0BVUpdateServletAdapter" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con4:outboundTransform>
                          <con3:log>
                            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7fda</con5:id>
                            <con3:logLevel>info</con3:logLevel>
                            <con3:expr>
                              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                            </con3:expr>
                            <con3:message>Logging BVServlet Request</con3:message>
                          </con3:log>
                          <con2:replace varName="body" contents-only="false">
                            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-7974903912807021182-de84514.12c342c8883.-7d18</con5:id>
                            <con2:location>
                              <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./*</con:xpathText>
                            </con2:location>
                            <con2:expr>
                              <con:xqueryTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                                <con:resource ref="MemberProfileProcessing/transformations/XQ_BVServlet"/>
                                <con:param name="Command">
                                  <con:path>"Normal"</con:path>
                                </con:param>
                                <con:param name="SiteLanguage">
                                  <con:path>$SiteLanguage</con:path>
                                </con:param>
                                <con:param name="Password">
                                  <con:path>$PinNumber</con:path>
                                </con:param>
                                <con:param name="UserId">
                                  <con:path>$UserID</con:path>
                                </con:param>
                                <con:param name="ApplicationId">
                                  <con:path>"5"</con:path>
                                </con:param>
                              </con:xqueryTransform>
                            </con2:expr>
                          </con2:replace>
                          <con2:transport-headers copy-all="false">
                            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-7974903912807021182-de84514.12c342c8883.-7d17</con5:id>
                            <con2:header-set>outbound-request</con2:header-set>
                            <con2:header name="Content-Type" value="expression">
                              <con5:xqueryText xmlns:con5="http://www.bea.com/wli/sb/stages/config">"application/x-www-form-urlencoded"</con5:xqueryText>
                            </con2:header>
                          </con2:transport-headers>
                          <con2:assign varName="Request">
                            <con6:id xmlns:con6="http://www.bea.com/wli/sb/stages/config">_ActionId-7181538584930003524--5d62a2e8.143de568622.-7581</con6:id>
                            <con2:expr>
                              <con6:xqueryText xmlns:con6="http://www.bea.com/wli/sb/stages/config">$body</con6:xqueryText>
                            </con2:expr>
                          </con2:assign>
                        </con4:outboundTransform>
                        <con4:responseTransform>
                          <con3:log>
                            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-3088428499322823816--741b9455.12c065e4cd6.-7fd9</con5:id>
                            <con3:logLevel>debug</con3:logLevel>
                            <con3:expr>
                              <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                            </con3:expr>
                            <con3:message>Logging BVServlet Response</con3:message>
                          </con3:log>
                          <con2:ifThenElse>
                            <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-530140766071300154-77102151.137fe661869.-7fee</con5:id>
                            <con2:case>
                              <con2:condition>
                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn:local-name($body/*[1])='Fault'</con:xqueryText>
                              </con2:condition>
                              <con2:actions>
                                <con4:alert xmlns:con3="http://www.bea.com/wli/sb/pipeline/config" xmlns:con4="http://www.bea.com/wli/sb/stages/alert/config">
                                  <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-530140766071300154-77102151.137fe661869.-7fed</con5:id>
                                  <con4:destination ref="Common/alerts/CriticalAlerts"/>
                                  <con4:description>FPlusApp call failed in UpdateProfile</con4:description>
                                  <con4:severity>critical</con4:severity>
                                  <con4:payload>
                                    <con6:xsltTransform xmlns:con6="http://www.bea.com/wli/sb/stages/config">
                                      <con6:resource ref="partnerServices/Partners_common/transformations/PrettyPrint"/>
                                      <con6:input>&lt;alertContent>{$MemberNumber}
{$Request}
{$body}
&lt;/alertContent></con6:input>
                                    </con6:xsltTransform>
                                  </con4:payload>
                                </con4:alert>
                              </con2:actions>
                            </con2:case>
                          </con2:ifThenElse>
                        </con4:responseTransform>
                      </con4:route>
                    </con4:case>
                  </con4:routingTable>
                </con:actions>
              </con:route-node>
            </con:flow>
          </con:branch>
          <con:branch name="LinkMemberToPromotion">
            <con:operator>equals</con:operator>
            <con:value>LinkMemberToPromotion</con:value>
            <con:flow>
              <con:pipeline-node name="LinkMemberToPromotion Gateway">
                <con:comment/>
                <con:request>LinkMemberToPromotion Gateway_request</con:request>
                <con:response>LinkMemberToPromotion Gateway_response</con:response>
              </con:pipeline-node>
              <con2:route-node name="Inserting or Updating Member Promotion" xmlns:con2="http://www.bea.com/wli/sb/pipeline/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                <con2:comment>Route to AYRES Enroll Promotion. InsertOrUpdateMemberPromotion</con2:comment>
                <con2:context>
                  <con3:varNsDecl prefix="ayr" namespace="http://www.siebel.com/xml/AYRES%20Enroll%20Promotion" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
                  <con3:varNsDecl prefix="asi" namespace="http://siebel.com/asi/" xmlns:con3="http://www.bea.com/wli/sb/stages/config"/>
                  <con5:varNsDecl prefix="com" namespace="http://com.finnair" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
                  <con5:varNsDecl prefix="prof" namespace="http://com.finnair/profileProcessing/" xmlns:con5="http://www.bea.com/wli/sb/stages/config"/>
                  <con3:variable name="Siebel" path="$Siebel" xmlns:con3="http://www.bea.com/wli/sb/typesystem/config">
                    <con3:service operation="InsertOrUpdateMemberPromotion">
                      <con3:business ref="MemberProfileProcessing/businessservices/AYRESEnrollPromotion"/>
                    </con3:service>
                  </con3:variable>
                </con2:context>
                <con2:actions>
                  <con1:route xmlns:con1="http://www.bea.com/wli/sb/stages/routing/config">
                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-3525837289851415380-5b4e4341.12a4b35ae38.-7f32</con2:id>
                    <con1:service ref="MemberProfileProcessing/businessservices/AYRESEnrollPromotion" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                    <con1:operation>InsertOrUpdateMemberPromotion</con1:operation>
                    <con1:outboundTransform>
                      <con3:log>
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7de0</con4:id>
                        <con3:logLevel>info</con3:logLevel>
                        <con3:expr>
                          <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                        </con3:expr>
                        <con3:message>Logging InsertOrUpdateMemberPromotion Request.</con3:message>
                      </con3:log>
                      <con4:delete varName="header" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config">
                        <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-2041694110763451302--16168512.131fb1161ef.-7f30</con5:id>
                        <con4:location>
                          <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./*</con:xpathText>
                        </con4:location>
                      </con4:delete>
                      <con6:assign varName="Request" xmlns:con6="http://www.bea.com/wli/sb/stages/transform/config">
                        <con7:id xmlns:con7="http://www.bea.com/wli/sb/stages/config">_ActionId-7181538584930003524--5d62a2e8.143de568622.-759e</con7:id>
                        <con6:expr>
                          <con7:xqueryText xmlns:con7="http://www.bea.com/wli/sb/stages/config">$body</con7:xqueryText>
                        </con6:expr>
                      </con6:assign>
                    </con1:outboundTransform>
                    <con1:responseTransform>
                      <con3:log>
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-6429171721278014610--688439f3.12a9d44fe2c.-7ddf</con4:id>
                        <con3:logLevel>debug</con3:logLevel>
                        <con3:expr>
                          <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                        </con3:expr>
                        <con3:message>Logging InsertOrUpdateMemberPromotion Request InsertOrUpdateMemberPromotion Response.</con3:message>
                      </con3:log>
                      <con3:ifThenElse xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3525837289851415380-5b4e4341.12a4b35ae38.-7f17</con4:id>
                        <con3:case>
                          <con3:condition>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn:local-name($body/*[1])='Fault'</con:xqueryText>
                          </con3:condition>
                          <con3:actions>
                            <con4:alert>
                              <con5:id xmlns:con5="http://www.bea.com/wli/sb/stages/config">_ActionId-530140766071300154-77102151.137fe661869.-7fd0</con5:id>
                              <con4:destination ref="Common/alerts/DefaultAlerts"/>
                              <con4:description>LinkMemberToPromotion failed</con4:description>
                              <con4:severity>normal</con4:severity>
                              <con4:payload>
                                <con6:xsltTransform xmlns:con6="http://www.bea.com/wli/sb/stages/config">
                                  <con6:resource ref="partnerServices/Partners_common/transformations/PrettyPrint"/>
                                  <con6:input>&lt;alertContent>{$MemberNumber}
{$Request}
{$body}
&lt;/alertContent></con6:input>
                                </con6:xsltTransform>
                              </con4:payload>
                            </con4:alert>
                            <con3:Error>
                              <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-3525837289851415380-5b4e4341.12a4b35ae38.-7f16</con4:id>
                              <con3:errCode>125</con3:errCode>
                              <con3:message>Siebel Backend Error</con3:message>
                            </con3:Error>
                          </con3:actions>
                        </con3:case>
                      </con3:ifThenElse>
                    </con1:responseTransform>
                  </con1:route>
                </con2:actions>
              </con2:route-node>
            </con:flow>
          </con:branch>
          <con:branch name="MarketingCommunicationsOptOut">
            <con:operator>equals</con:operator>
            <con:value/>
            <con:flow>
              <con:pipeline-node name="Opt-out Gateway">
                <con:request>Opt-out Gateway_request</con:request>
                <con:response>Opt-out Gateway_response</con:response>
              </con:pipeline-node>
            </con:flow>
          </con:branch>
          <con:default-branch>
            <con:flow/>
          </con:default-branch>
        </con:branch-table>
      </con:branch-node>
    </con:flow>
  </ser:router>
  <ser:alertRules/>
</xml-fragment>